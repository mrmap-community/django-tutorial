<!DOCTYPE html>
<html lang="de">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="Docutils 0.18.1: http://docutils.sourceforge.net/" name="generator"/>
  <title>
   GeoDjango Tutorial 0.1 Dokumentation
  </title>
  <link href="_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="_static/main.css" rel="stylesheet" type="text/css"/>
  <script src="_static/jquery.js">
  </script>
  <script src="_static/_sphinx_javascript_frameworks_compat.js">
  </script>
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js">
  </script>
  <script src="_static/doctools.js">
  </script>
  <script src="_static/sphinx_highlight.js">
  </script>
  <script src="_static/translations.js">
  </script>
  <link href="genindex.html" rel="index" title="Stichwortverzeichnis"/>
  <link href="search.html" rel="search" title="Suche"/>
 </head>
 <body>
  <article class="dont-break" id="cover">
   <div class="container">
    <!-- Logo -->
    <div class="logo">
     <p>
     </p>
    </div>
    <!-- Cover middle -->
    <div class="cover-middle">
     <div class="title">
      <h1 class="title-cover">
       GeoDjango Tutorial
      </h1>
      <p class="subtitle-cover">
       Version
      </p>
      <span class="meta">
      </span>
     </div>
     <!--
      <div class="client-logo">
        <img src="../data/logo_.png" alt="Logotipo">
      </div>
      -->
    </div>
    <!-- Footer -->
    <div class="cover-footer">
     <p>
     </p>
    </div>
   </div>
  </article>
  <div aria-label="main navigation" class="sphinxsidebar" role="navigation">
   <div class="sphinxsidebarwrapper">
    <div>
     <h3>
      <a href="#">
       Inhaltsverzeichnis
      </a>
     </h3>
     <p class="caption" role="heading">
      <span class="caption-text">
       Einf&uuml;hrung
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#einfuhrung">
        Einf&uuml;hrung
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#weitere-informationen">
        Weitere Informationen
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#beispielimplementierungen">
        Beispielimplementierungen
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#beispiel-hosting-bw-komm-one-wfs-abgabe-bplan-in-rasterform">
          Beispiel Hosting BW Komm.ONE - WFS Abgabe BPlan in Rasterform
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#netgis-mannheim">
          Netgis Mannheim
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#leitfaden">
        Leitf&auml;den
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Vorarbeiten
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#installation-der-python-umgebung">
        Installation der Python Umgebung
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#benotigte-software">
          Ben&ouml;tigte Software
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#los-geht-s-am-terminal">
          Los geht&rsquo;s am Terminal
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#vscode-einrichten-uber-oberflache">
          VSCODE einrichten &uuml;ber Oberfl&auml;che
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#weitere-infos">
          Weitere Infos
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#django-projekt-initialisieren-standard-terminal-oder-vscode-terminal">
        Django Projekt initialisieren (Standard-Terminal oder VSCODE-Terminal)
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#frontend-testen">
        Frontend testen
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Rahmen f&uuml;r Anwendung
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#erste-schritte">
        Erste Schritte
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#startseite-anpassen-einfache-functionbasedview">
          Startseite anpassen (einfache FunctionBasedView)
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#ausprobieren-der-admin-oberflache-und-der-startseite">
          Ausprobieren der Admin Oberfl&auml;che und der Startseite
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#aktivieren-der-debugtoolbar">
          Aktivieren der Debugtoolbar
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#erstellung-erster-versionen-der-templates">
        Erstellung erster Versionen der Templates
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#basis-template-xplanung-light-templates-xplanung-light-layout-html">
          Basis Template xplanung_light/templates/xplanung_light/layout.html
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#anpassung-der-views">
          Anpassung der views
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#template-fur-home-xplanung-light-templates-xplanung-light-home-html">
          Template f&uuml;r home - xplanung_light/templates/xplanung_light/home.html
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#template-fur-about-xplanung-light-templates-xplanung-light-about-html">
          Template f&uuml;r about - xplanung_light/templates/xplanung_light/about.html
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#nutzung-von-standardfunktionen-des-auth-packages-fur-anmeldung-und-registrierung">
        Nutzung von Standardfunktionen des auth packages f&uuml;r Anmeldung und Registrierung
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#anpassung-der-pfade-in-xplanung-light-urls-py">
          Anpassung der Pfade in xplanung_light/urls.py
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#html-templates">
          HTML-Templates
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#formular-fur-registrierung">
          Formular f&uuml;r Registrierung
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#anpassung-der-views">
          Anpassung der views
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#stylesheets-optimieren">
          Stylesheets optimieren
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#was-wir-bisher-haben">
          Was wir bisher haben
         </a>
        </li>
       </ul>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Responsive Design
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#integration-von-bootstrap5">
        Integration von bootstrap5
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Datenmodelle
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#vorbereitung">
        Vorbereitung
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#historie">
          Historie
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#spatial-data">
          Spatial Data
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#organisationsmodell">
        Organisationsmodell
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#einleitung">
          Einleitung
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#modelldefinition">
          Modelldefinition
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#datenimport">
          Datenimport
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#planmodell">
        Planmodell
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#einleitung">
          Einleitung
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#modelldefinition">
          Modelldefinition
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#verwaltungsviews">
          Verwaltungsviews
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#erfassung-eines-bplans-im-admin-backend">
          Erfassung eines BPlans im Admin-Backend
         </a>
        </li>
       </ul>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Optimieren der Views
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#geometrie-editor">
        Geometrie Editor
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#aktivieren-des-leaflet-clients-in-den-views">
          Aktivieren des Leaflet-Clients in den Views
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#erfassung-eines-bplans-im-frontend">
          Erfassung eines BPlans im Frontend
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#tabellenanzeige">
        Tabellenanzeige
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#anpassung-templates">
        Anpassung Templates
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#liste-der-plane-im-frontend">
        Liste der Pl&auml;ne im Frontend
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Leaflet Konfiguration
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#zentrale-konfiguration">
        Zentrale Konfiguration
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#wms-layer-hinzufugen">
        WMS Layer hinzuf&uuml;gen
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#darstellung-wms-in-client">
        Darstellung WMS in Client
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Export XPlanung
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#xplanung-gml-export">
        XPlanung GML Export
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#export-xml-view">
          Export XML View
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#url-fur-export">
          URL f&uuml;r Export
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#link-in-table-view">
          Link in Table View
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#xml-template">
          XML Template
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#neue-spalte-fur-export-in-tabelle">
          Neue Spalte f&uuml;r Export in Tabelle
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#xml-export">
          XML Export
         </a>
        </li>
       </ul>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Kartenansicht und Filter
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#kartenansicht">
        Kartenansicht
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#konfiguration">
          Konfiguration
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#kartenanzeige-im-client">
          Kartenanzeige im Client
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#suche">
        Suche
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#installation-django-filter">
          Installation django-filter
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#erstellen-einer-filter-klasse">
          Erstellen einer Filter Klasse
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#anpassen-des-views">
          Anpassen des Views
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#konfiguration-der-filterfunktionen-im-template">
          Konfiguration der Filterfunktionen im template
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#darstellung-der-filter">
          Darstellung der Filter
         </a>
        </li>
       </ul>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Ergebnis
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#zusammenfassung">
        Zusammenfassung
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#metadatenexport">
        Metadatenexport
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#neuer-endpunkt">
          Neuer Endpunkt
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#anpassung-des-views">
          Anpassung des Views
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#erstellen-des-xml-templates">
          Erstellen des XML-Templates
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#anpassung-der-tabelle">
          Anpassung der Tabelle
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#ergebnis-des-iso-metadaten-exports">
        Ergebnis des ISO-Metadaten Exports
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#neue-spalte-fur-export-in-tabelle">
          Neue Spalte f&uuml;r Export in Tabelle
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#iso19139-export">
          ISO19139 Export
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#todos">
        TODOs
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Addons
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#zusatzliche-funktionen">
        Zus&auml;tzliche Funktionen
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#import-von-xplan-gml-files">
          Import von XPlan-GML Files
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#integration-mapserver">
          Integration Mapserver
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#anzeige-der-getcapabilities-urls">
          Anzeige der GetCapabilities URLs
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#anzeige-des-links-zu-den-publizierenden-organisationen">
          Anzeige des Links zu den Publizierenden Organisationen
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#sortieren-der-bplane-nach-letzte-anderung-desc">
          Sortieren der BPl&auml;ne nach letzte &Auml;nderung desc
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#screenshots">
          Screenshots
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
   </div>
  </div>
  <div class="document">
   <div class="documentwrapper">
    <div class="bodywrapper">
     <div class="body" role="main">
      <section id="geodjango-tutorial">
       <h1>
        GeoDjango Tutorial
        <a class="headerlink" href="#geodjango-tutorial" title="Permalink to this heading">
         
        </a>
       </h1>
       <div class="toctree-wrapper compound">
        <span id="document-introduction">
        </span>
        <section id="einfuhrung">
         <h2>
          Einf&uuml;hrung
          <a class="headerlink" href="#einfuhrung" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Das Tutorial soll an einem konkreten Beispiel zeigen, wie man mit Django in relativ kurzer Zeit eine einfache Anwendung zur Verwaltung von Geodaten erstellen kann. Als Beispiel werden hier kommunale Bauleitpl&auml;ne genommen.
         </p>
         <p>
          Die Anwendung verf&uuml;gt &uuml;ber folgende Funktionen/Eigenschaften:
         </p>
         <ul class="simple">
          <li>
           <p>
            Nutzung der Django-Standardbenutzerverwaltung f&uuml;r Registrierung und Authentifizierung
           </p>
          </li>
          <li>
           <p>
            Import der rheinland-pf&auml;lzischen Gebietsk&ouml;rperschaften mit deren geometrischen Abgrenzungen
           </p>
          </li>
          <li>
           <p>
            Historisierung der Gebietsk&ouml;rperschaften
           </p>
          </li>
          <li>
           <p>
            Erstellen, Editieren, L&ouml;schen von Bebauungspl&auml;nen mit Referenzen auf die Gebietsk&ouml;rperschaften
           </p>
          </li>
          <li>
           <p>
            Editieren multipolygonaler Abgrenzungen von Geltungsbereichen der Bebauungspl&auml;ne
           </p>
          </li>
          <li>
           <p>
            Layout mit bootstrap5 optimiert (responsive)
           </p>
          </li>
          <li>
           <p>
            Export von konformen XPlan-GML Dateien
           </p>
          </li>
         </ul>
         <p>
          Verwendete Django packages:
         </p>
         <ul class="simple">
          <li>
           <p>
            django-bootstrap5
           </p>
          </li>
          <li>
           <p>
            django-simple-history
           </p>
          </li>
          <li>
           <p>
            django-leaflet
           </p>
          </li>
          <li>
           <p>
            django-tables2
           </p>
          </li>
          <li>
           <p>
            django-debug-toolbar
           </p>
          </li>
          <li>
           <p>
            django-filter
           </p>
          </li>
          <li>
           <p>
            django-crispy-forms
           </p>
          </li>
          <li>
           <p>
            crispy-bootstrap5
           </p>
          </li>
         </ul>
         <p>
          Weitere python libs:
         </p>
         <ul class="simple">
          <li>
           <p>
            requests
           </p>
          </li>
          <li>
           <p>
            openpyxl
           </p>
          </li>
          <li>
           <p>
            mappyfile
           </p>
          </li>
          <li>
           <p>
            mapscript==7.6.0
           </p>
          </li>
         </ul>
        </section>
        <section id="weitere-informationen">
         <h2>
          Weitere Informationen
          <a class="headerlink" href="#weitere-informationen" title="Permalink to this heading">
           
          </a>
         </h2>
         <ul class="simple">
          <li>
           <p>
            <a class="reference external" href="https://www.djangoproject.com/">
             django
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://xleitstelle.de/releases/objektartenkatalog_6_0">
             xplanung
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.statistik.rlp.de/publikationen/verzeichnisse-und-adressarien">
             Gebietsk&ouml;rperschaften RLP
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.geoportal.rlp.de/mediawiki/images/c/c7/Leitfaden_Bereitstellung_komm_Plaene.pdf">
             Leitfaden kommunale Pl&auml;ne GDI-RP
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://gitlab.opencode.de/xleitstelle/xplanung/testdaten">
             Testdaten xleitstelle
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://gitlab.opencode.de/diplanung/ozgxplanung/-/tree/xplanbox-7.1.3/xplan-tests/xplan-tests-resources/src/main/resources/de/latlon/xplan/xplan60?ref_type=tags">
             Beispiel Dateien XPlanung 6.0
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://github.com/kreis-viersen/xplan-reader/">
             QGIS XPlan-Reader
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://github.com/kreis-viersen/xplan-umring">
             QGIS XPlan-Umring
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.xplanungsplattform.de/xplan-validator/">
             Validator - alt
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://xleitstelle.de/validator">
             Validator - neu
            </a>
           </p>
          </li>
         </ul>
        </section>
        <section id="beispielimplementierungen">
         <h2>
          Beispielimplementierungen
          <a class="headerlink" href="#beispielimplementierungen" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="beispiel-hosting-bw-komm-one-wfs-abgabe-bplan-in-rasterform">
          <h3>
           Beispiel Hosting BW
           <a class="reference external" href="https://www.komm.one/wer-wir-sind">
            Komm.ONE
           </a>
           - WFS Abgabe BPlan in Rasterform
           <a class="headerlink" href="#beispiel-hosting-bw-komm-one-wfs-abgabe-bplan-in-rasterform" title="Permalink to this heading">
            
           </a>
          </h3>
          <table class="docutils align-default">
           <thead>
            <tr class="row-odd">
             <th class="head">
              <p>
               Link
              </p>
             </th>
             <th class="head">
              <p>
               Operation
              </p>
             </th>
             <th class="head">
              <p>
               Erl&auml;uterung
              </p>
             </th>
            </tr>
           </thead>
           <tbody>
            <tr class="row-even">
             <td>
              <p>
               <a class="reference external" href="https://geodienste.komm.one/ows/services/org.641.1b95f33f-e4f3-4898-bcba-8319409933fc_wfs/org.641.db827e93-33f7-4b4e-97ce-9772690d4b6b?SERVICE=WFS&amp;amp;Request=GetCapabilities">
                Eigenschaftsabfrage
               </a>
              </p>
             </td>
             <td>
              <p>
               GetCapabilities
              </p>
             </td>
             <td>
              <p>
               keine
              </p>
             </td>
            </tr>
            <tr class="row-odd">
             <td>
              <p>
               <a class="reference external" href="https://geodienste.komm.one/ows/services/org.641.1b95f33f-e4f3-4898-bcba-8319409933fc_wfs/org.641.db827e93-33f7-4b4e-97ce-9772690d4b6b?VERSION=2.0.0&amp;amp;SERVICE=WFS&amp;amp;typename=BP_Plan&amp;amp;Request=GetFeature">
                BP_Plan
               </a>
              </p>
             </td>
             <td>
              <p>
               GetFeature
              </p>
             </td>
             <td>
              <p>
               keine
              </p>
             </td>
            </tr>
            <tr class="row-even">
             <td>
              <p>
               <a class="reference external" href="https://geodienste.komm.one/ows/services/org.641.1b95f33f-e4f3-4898-bcba-8319409933fc_wfs/org.641.db827e93-33f7-4b4e-97ce-9772690d4b6b?VERSION=2.0.0&amp;amp;SERVICE=WFS&amp;amp;typename=XP_Rasterdarstellung&amp;amp;Request=GetFeature">
                XP_Rasterdarstellung
               </a>
              </p>
             </td>
             <td>
              <p>
               GetFeature
              </p>
             </td>
             <td>
              <p>
               keine
              </p>
             </td>
            </tr>
            <tr class="row-odd">
             <td>
              <p>
               <a class="reference external" href="https://geodienste.komm.one/ows/services/org.641.1b95f33f-e4f3-4898-bcba-8319409933fc_wfs/org.641.db827e93-33f7-4b4e-97ce-9772690d4b6b?SERVICE=WFS&amp;amp;VERSION=2.0.0&amp;amp;typename=BP_Bereich&amp;amp;Request=GetFeature">
                BP_Bereich
               </a>
              </p>
             </td>
             <td>
              <p>
               GetFeature
              </p>
             </td>
             <td>
              <p>
               keine
              </p>
             </td>
            </tr>
           </tbody>
          </table>
         </section>
         <section id="netgis-mannheim">
          <h3>
           Netgis Mannheim
           <a class="headerlink" href="#netgis-mannheim" title="Permalink to this heading">
            
           </a>
          </h3>
          <ul class="simple">
           <li>
            <p>
             <a class="reference external" href="https://service.gis-mannheim.de/mannheim/mod_plan_bw/">
              &Uuml;bersicht
             </a>
            </p>
           </li>
           <li>
            <p>
             <a class="reference external" href="https://service.gis-mannheim.de/mannheim/mod_plan_bw/get_xplan_gml.php?gmlid=GML_ef9a23ca-9613-d9b0-ac3e-2ff516bee276">
              Einzelner Plan
             </a>
            </p>
           </li>
          </ul>
         </section>
        </section>
        <section id="leitfaden">
         <h2>
          Leitf&auml;den
          <a class="headerlink" href="#leitfaden" title="Permalink to this heading">
           
          </a>
         </h2>
         <ul class="simple">
          <li>
           <p>
            <a class="reference external" href="https://www.stmb.bayern.de/assets/stmi/miniwebs/digitale_planung/xplanung_by_leitfaden_a4_pre.pdf">
             Bayern 10/2024
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.geoportal-bw.de/documents/d/guest/leitfaden_bauleitplan_v3-1">
             Baden-W&uuml;rttemberg 12/2022
            </a>
           </p>
           <ul>
            <li>
             <p>
              <a class="reference external" href="https://www.geoportal-bw.de/documents/d/guest/anlage1_v3_1_221215">
               Anlage
              </a>
             </p>
            </li>
           </ul>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://lbv.brandenburg.de/download/Raumbeobachtung/Pflichtenheft_2022.pdf">
             Brandenburg 05/2022
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.geoportal.rlp.de/mediawiki/images/c/c7/Leitfaden_Bereitstellung_komm_Plaene.pdf">
             Rheinland-Pfalz 10/2017
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://mid.sachsen-anhalt.de/fileadmin/Bibliothek/Politik_und_Verwaltung/MLV/MID/Ministerium/Publikationen/XPlanung-Leitfaden-Sachsen-Anhalt.pdf">
             Sachsen-Anhalt 03/2024
            </a>
           </p>
          </li>
         </ul>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-installation">
        </span>
        <section id="installation-der-python-umgebung">
         <h2>
          Installation der Python Umgebung
          <a class="headerlink" href="#installation-der-python-umgebung" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="benotigte-software">
          <h3>
           Ben&ouml;tigte Software
           <a class="headerlink" href="#benotigte-software" title="Permalink to this heading">
            
           </a>
          </h3>
          <ol class="arabic simple">
           <li>
            <p>
             Debian 11
            </p>
           </li>
           <li>
            <p>
             VSCODE
            </p>
           </li>
           <li>
            <p>
             Virtuelle python Umgebung
            </p>
           </li>
           <li>
            <p>
             Internetzugang
            </p>
           </li>
          </ol>
         </section>
         <section id="los-geht-s-am-terminal">
          <h3>
           Los geht&rsquo;s am Terminal
           <a class="headerlink" href="#los-geht-s-am-terminal" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Verzeichnis anlegen
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>mkdir<span class="w"> </span>komserv2
</pre>
           </div>
          </div>
          <p>
           Ins Verzeichnis wechseln
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span><span class="nb">cd</span><span class="w"> </span>komserv2
</pre>
           </div>
          </div>
          <p>
           Virtuelle python-Umgebung anlegen
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
</pre>
           </div>
          </div>
          <p>
           Virtualle Umgebung aktivieren
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
</pre>
           </div>
          </div>
          <p>
           Paketmanager pip aktualisieren
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip
</pre>
           </div>
          </div>
          <p>
           Django installieren
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django
</pre>
           </div>
          </div>
          <p>
           Installieren der Bibliotheken f&uuml;r spatialite
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>apt<span class="w"> </span>install<span class="w"> </span>binutils<span class="w"> </span>libproj-dev<span class="w"> </span>gdal-bin<span class="w"> </span>spatialite-bin<span class="w"> </span>libsqlite3-mod-spatialite
</pre>
           </div>
          </div>
          <p>
           VSCODE im Verzeichnis starten
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>code<span class="w"> </span>.
</pre>
           </div>
          </div>
         </section>
         <section id="vscode-einrichten-uber-oberflache">
          <h3>
           VSCODE einrichten &uuml;ber Oberfl&auml;che
           <a class="headerlink" href="#vscode-einrichten-uber-oberflache" title="Permalink to this heading">
            
           </a>
          </h3>
          <ol class="arabic simple">
           <li>
            <p>
             Python Umgebung w&auml;hlen
            </p>
           </li>
           <li>
            <p>
             Debugger konfigurieren - launch.json Datei in .vscode Ordner
            </p>
           </li>
          </ol>
          <div class="highlight-json notranslate">
           <div class="highlight">
            <pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Python Debugger: Django"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"debugpy"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">"runserver"</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">"django"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"autoStartBrowser"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"program"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/manage.py"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre>
           </div>
          </div>
          <ol class="arabic simple" start="3">
           <li>
            <p>
             Restart VSCODE - manchmal notwendig, um launch.json einlesen zu lassen
            </p>
           </li>
          </ol>
         </section>
         <section id="weitere-infos">
          <h3>
           Weitere Infos
           <a class="headerlink" href="#weitere-infos" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           https://code.visualstudio.com/docs/python/tutorial-django
          </p>
         </section>
        </section>
        <span id="document-initialize_project">
        </span>
        <section id="django-projekt-initialisieren-standard-terminal-oder-vscode-terminal">
         <h2>
          Django Projekt initialisieren (Standard-Terminal oder VSCODE-Terminal)
          <a class="headerlink" href="#django-projekt-initialisieren-standard-terminal-oder-vscode-terminal" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Im Arbeitsverzeichnis komserv2 - venv aktiviert!
Django Boilerplate Code anlegen
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>django-admin<span class="w"> </span>startproject<span class="w"> </span>komserv<span class="w"> </span>.
</pre>
          </div>
         </div>
         <p>
          Erste App anlegen
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python<span class="w"> </span>manage.py<span class="w"> </span>startapp<span class="w"> </span>xplanung_light
</pre>
          </div>
         </div>
         <p>
          Datenbankschema erstellen und automatisch initiale SQLITE DB anlegen
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</pre>
          </div>
         </div>
         <p>
          Starten des Django-Servers auf lokalem Port 8000
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python<span class="w"> </span>manage.py<span class="w"> </span>runserver
</pre>
          </div>
         </div>
        </section>
        <section id="frontend-testen">
         <h2>
          Frontend testen
          <a class="headerlink" href="#frontend-testen" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          <a class="reference external" href="http://127.0.0.1:8000">
           http://127.0.0.1:8000
          </a>
         </p>
         <a class="bg-primary reference internal image-reference" href="_images/initial_django_project.png">
          <img alt="Liste der publizierenden Orgas" class="bg-primary align-center" src="_images/initial_django_project.png" style="width: 800px;"/>
         </a>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-first_steps">
        </span>
        <section id="erste-schritte">
         <h2>
          Erste Schritte
          <a class="headerlink" href="#erste-schritte" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="startseite-anpassen-einfache-functionbasedview">
          <h3>
           Startseite anpassen (einfache FunctionBasedView)
           <a class="headerlink" href="#startseite-anpassen-einfache-functionbasedview" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">"Hello, XPlanung!"</span><span class="p">)</span>
</pre>
           </div>
          </div>
          <p>
           urls.py erstellen: xplanung_light/urls.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"home"</span><span class="p">),</span>
<span class="p">]</span>
</pre>
           </div>
          </div>
          <p>
           Anpassung der Projekt urls.py: komserv/urls.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">"xplanung_light.urls"</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)</span>
<span class="p">]</span>
</pre>
           </div>
          </div>
          <p>
           App xplanung_light zur Konfiguration in komserv/settings.py hinzuf&uuml;gen
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="c1"># Application definition</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1">#...</span>
    <span class="s1">'xplanung_light'</span><span class="p">,</span>
  <span class="c1">#...</span>
<span class="p">]</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           Erstellung der Verzeichnisse f&uuml;r staticfiles und templates - pwd: komserv2/xplanung_light/
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>mkdir<span class="w"> </span>templates
<span class="nb">cd</span><span class="w"> </span>templates
mkdir<span class="w"> </span>xplanung_light
<span class="nb">cd</span><span class="w"> </span>..
mkdir<span class="w"> </span>static
<span class="nb">cd</span><span class="w"> </span>static
mkdir<span class="w"> </span>xplanung_light
<span class="nb">cd</span><span class="w"> </span>..
</pre>
           </div>
          </div>
          <p>
           Erstellung eines minimalen stylesheets: xplanung_light/static/xplanung_light/site.css
          </p>
          <div class="highlight-css notranslate">
           <div class="highlight">
            <pre><span></span><span class="p">.</span><span class="nc">message</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">blue</span><span class="p">;</span>
<span class="p">}</span>
</pre>
           </div>
          </div>
          <p>
           Anlegen der Konfiguration f&uuml;r die Ablage der static files in komserv/settings.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'static_collected'</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           Kopieren der static files in die vorgesehenen Ordner
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>collectstatic
</pre>
           </div>
          </div>
          <p>
           Ausgabe
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span><span class="m">126</span><span class="w"> </span>static<span class="w"> </span>files<span class="w"> </span>copied<span class="w"> </span>to<span class="w"> </span><span class="s1">'XXX/komserv2/static_collected'</span>.
</pre>
           </div>
          </div>
          <p>
           Superuser anlegen
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>createsuperuser<span class="w"> </span>--username<span class="o">=</span>admin<span class="w"> </span>--email<span class="o">=</span>admin@example.com
</pre>
           </div>
          </div>
         </section>
         <section id="ausprobieren-der-admin-oberflache-und-der-startseite">
          <h3>
           Ausprobieren der Admin Oberfl&auml;che und der Startseite
           <a class="headerlink" href="#ausprobieren-der-admin-oberflache-und-der-startseite" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           dev-Server beenden (je nach Umgebung) und neu starten - jetzt am besten in VSCODE &uuml;ber F5 - Run-&gt;Start Debugging
          </p>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/admin/">
            http://127.0.0.1:8000/admin/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/initial_django_admin.png">
           <img alt="Liste der publizierenden Orgas" class="bg-primary align-center" src="_images/initial_django_admin.png" style="width: 800px;"/>
          </a>
         </section>
         <section id="aktivieren-der-debugtoolbar">
          <h3>
           Aktivieren der Debugtoolbar
           <a class="headerlink" href="#aktivieren-der-debugtoolbar" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           <a class="reference external" href="https://django-debug-toolbar.readthedocs.io">
            django-debug-toolbar
           </a>
          </p>
          <p>
           Installation des Pakets
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-debug-toolbar
</pre>
           </div>
          </div>
          <p>
           Anpassen der Konfiguration
          </p>
          <p>
           komserv/settings.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="c1"># Application definition</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1">#...</span>
    <span class="s1">'debug_toolbar'</span><span class="p">,</span>
  <span class="c1">#...</span>
<span class="p">]</span>
<span class="c1">#...</span>
<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">#...</span>
    <span class="s1">'debug_toolbar.middleware.DebugToolbarMiddleware'</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1">#...</span>
<span class="n">INTERNAL_IPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s2">"127.0.0.1"</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre>
           </div>
          </div>
          <p>
           Erweiterung der URLs
          </p>
          <p>
           komserv/urls.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.staticfiles.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">staticfiles_urlpatterns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">debug_toolbar.toolbar</span><span class="w"> </span><span class="kn">import</span> <span class="n">debug_toolbar_urls</span>
<span class="c1">#...</span>
<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">staticfiles_urlpatterns</span><span class="p">()</span> <span class="o">+</span> <span class="n">debug_toolbar_urls</span><span class="p">()</span>
</pre>
           </div>
          </div>
          <p>
           Mit Debug Toolbar
          </p>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/admin/">
            http://127.0.0.1:8000/admin/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/initial_django_admin_debug.png">
           <img alt="Liste der publizierenden Orgas" class="bg-primary align-center" src="_images/initial_django_admin_debug.png" style="width: 800px;"/>
          </a>
         </section>
        </section>
        <span id="document-first_templates">
        </span>
        <section id="erstellung-erster-versionen-der-templates">
         <h2>
          Erstellung erster Versionen der Templates
          <a class="headerlink" href="#erstellung-erster-versionen-der-templates" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="basis-template-xplanung-light-templates-xplanung-light-layout-html">
          <h3>
           Basis Template xplanung_light/templates/xplanung_light/layout.html
           <a class="headerlink" href="#basis-template-xplanung-light-templates-xplanung-light-layout-html" title="Permalink to this heading">
            
           </a>
          </h3>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset="utf-8"/&gt;</span>
<span class="x">    &lt;meta name="description" content="Author: Armin Retterath, XPlanung, Django, Formular, Easy, kostenfrei, Open Source"/&gt;</span>
<span class="x">    &lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">&lt;/title&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>
<span class="x">    &lt;link rel="stylesheet" type="text/css" href="</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">'xplanung_light/site.css'</span> <span class="cp">%}</span><span class="x">"/&gt;</span>
<span class="x">    </span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;div class="navbar"&gt;</span>
<span class="x">        &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="x">" class="navbar-brand"&gt;XPlanung light&lt;/a&gt;</span>
<span class="x">        &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'about'</span> <span class="cp">%}</span><span class="x">" class="navbar-item"&gt;&Uuml;ber&lt;/a&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">            &lt;p&gt;</span>
<span class="x">                Angemeldeter Benutzer: </span><span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span><span class="x"> &lt;br&gt;</span>
<span class="x">                &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'logout'</span> <span class="cp">%}</span><span class="x">" class="navbar-item"&gt;Abmelden&lt;/a&gt;</span>
<span class="x">            &lt;/p&gt;</span>
<span class="x">            &lt;p&gt;&lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'admin:index'</span> <span class="cp">%}</span><span class="x">" &gt;Admin Backend&lt;/a&gt;&lt;/p&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">            &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="x">" class="navbar-item"&gt;Anmelden&lt;/a&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">    &lt;div class="body-content"&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="x">        &lt;hr/&gt;</span>
<span class="x">        &lt;footer&gt;</span>
<span class="x">            &lt;p&gt;&amp;copy; 2025&lt;/p&gt;</span>
<span class="x">            &lt;p&gt;Letzte &Auml;nderung: 2025-04-04 11:40 Initiales Anlegen&lt;/p&gt;</span>
<span class="x">        &lt;/footer&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre>
           </div>
          </div>
         </section>
         <section id="anpassung-der-views">
          <h3>
           Anpassung der views
           <a class="headerlink" href="#anpassung-der-views" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Function based views f&uuml;r home und about Seiten - xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>

<span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">"xplanung_light/home.html"</span><span class="p">)</span>
    
<span class="k">def</span><span class="w"> </span><span class="nf">about</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">"xplanung_light/about.html"</span><span class="p">)</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           url f&uuml;r about zu xplanung_light/urls.py hinzuf&uuml;gen
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="n">path</span><span class="p">(</span><span class="s2">"about/"</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">about</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"about"</span><span class="p">),</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="template-fur-home-xplanung-light-templates-xplanung-light-home-html">
          <h3>
           Template f&uuml;r home - xplanung_light/templates/xplanung_light/home.html
           <a class="headerlink" href="#template-fur-home-xplanung-light-templates-xplanung-light-home-html" title="Permalink to this heading">
            
           </a>
          </h3>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">Home</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Einfache Webanwendung zur Verwaltung kommunaler Pl&auml;ne gem&auml;&szlig; dem aktuellen Standard &lt;a href="https://xleitstelle.de/xplanung" target="_blank"&gt;XPlanung&lt;/a&gt;&lt;/p&gt;</span>
<span class="x">&lt;p&gt;Der Betreiber &uuml;bernimmt keinerlei Verantwortung f&uuml;r die Funktionsf&auml;higkeit und Zuverl&auml;ssigkeit der Anwendung. Es handelt sich nur um ein &lt;b&gt;Proof of Concept&lt;/b&gt;. Solange die Anwendung online ist, kann und darf sie von jedermann kostenfrei verwendet werden. F&uuml;r die Sicherheit der Daten wird ebenfalls keine Verantwortung &uuml;bernommen. Nutzer sollten nur ihre eigenen Daten sehen und editieren k&ouml;nnen. Das Projekt dient als Test zur Pr&uuml;fung von Funktionen des zugrundeliegenden Webframeworks &lt;a href="https://www.djangoproject.com/" target="_blank"&gt;Django&lt;/a&gt; und wurde innerhalb weniger Tage unter Nutzung von &lt;a href="https://docs.djangoproject.com/en/5.0/topics/class-based-views/generic-display/" target="_blank"&gt;class-based generic views&lt;/a&gt; umgesetzt ;-) .&lt;/p&gt;</span>
<span class="x">&lt;h4&gt;Funktionen&lt;/h4&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="x">    &lt;li&gt;...&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;...&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
<span class="x">&lt;h4&gt;Technische Informationen&lt;/h4&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="x">    &lt;li&gt;&lt;a href="#" target="_blank"&gt;Projekt auf GitHub&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;&lt;a href="#" target="_blank"&gt;Github Repo der ...&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;&lt;a href="#" target="_blank"&gt;Standard&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
<span class="x">&lt;h4&gt;Validatoren&lt;/h4&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="x">    &lt;li&gt;&lt;a href="#" target="_blank"&gt;...&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
           </div>
          </div>
         </section>
         <section id="template-fur-about-xplanung-light-templates-xplanung-light-about-html">
          <h3>
           Template f&uuml;r about - xplanung_light/templates/xplanung_light/about.html
           <a class="headerlink" href="#template-fur-about-xplanung-light-templates-xplanung-light-about-html" title="Permalink to this heading">
            
           </a>
          </h3>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">&Uuml;ber</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Anwendung zur einfachen Verwaltung von kommunalen Pl&auml;nen, konform zum deutschen Standard &lt;b&gt;XPlanung&lt;/b&gt;.&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
           </div>
          </div>
         </section>
        </section>
        <span id="document-add_login_register">
        </span>
        <section id="nutzung-von-standardfunktionen-des-auth-packages-fur-anmeldung-und-registrierung">
         <h2>
          Nutzung von Standardfunktionen des auth packages f&uuml;r Anmeldung und Registrierung
          <a class="headerlink" href="#nutzung-von-standardfunktionen-des-auth-packages-fur-anmeldung-und-registrierung" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="anpassung-der-pfade-in-xplanung-light-urls-py">
          <h3>
           Anpassung der Pfade in xplanung_light/urls.py
           <a class="headerlink" href="#anpassung-der-pfade-in-xplanung-light-urls-py" title="Permalink to this heading">
            
           </a>
          </h3>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
<span class="c1">#...</span>
<span class="n">path</span><span class="p">(</span><span class="s2">"accounts/login/"</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">next_page</span><span class="o">=</span><span class="s2">"home"</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"login"</span><span class="p">),</span>
<span class="n">path</span><span class="p">(</span><span class="s2">"accounts/logout/"</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LogoutView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">next_page</span><span class="o">=</span><span class="s2">"home"</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'logout'</span><span class="p">),</span>
<span class="c1"># https://dev.to/donesrom/how-to-set-up-django-built-in-registration-in-2023-41hg</span>
<span class="n">path</span><span class="p">(</span><span class="s2">"register/"</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"register"</span><span class="p">),</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="html-templates">
          <h3>
           HTML-Templates
           <a class="headerlink" href="#html-templates" title="Permalink to this heading">
            
           </a>
          </h3>
          <section id="erstellen-eines-verzeichnisses-fur-registrierungstemplates">
           <h4>
            Erstellen eines Verzeichnisses f&uuml;r Registrierungstemplates
            <a class="headerlink" href="#erstellen-eines-verzeichnisses-fur-registrierungstemplates" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            Erstellung des Verzeichnisses f&uuml;r registration - pwd: komserv2/xplanung_light/templates/
           </p>
           <div class="highlight-shell notranslate">
            <div class="highlight">
             <pre><span></span>mkdir<span class="w"> </span>xplanung_light/templates/registration
</pre>
            </div>
           </div>
          </section>
          <section id="templates">
           <h4>
            Templates
            <a class="headerlink" href="#templates" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            xplanung_light/templates/registration/login.html
           </p>
           <div class="highlight-jinja notranslate">
            <div class="highlight">
             <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"../xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.errors</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Your username and password didn't match. Please try again.&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">next</span> <span class="cp">%}</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">    &lt;p&gt;Your account doesn't have access to this page. To proceed,</span>
<span class="x">    please login with an account that has access.&lt;/p&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">    &lt;p&gt;Please login to see this page.&lt;/p&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">&lt;form method="post" action="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="x">"&gt;</span>
<span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">&lt;table&gt;</span>
<span class="x">&lt;tr&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.username.label_tag</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.username</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">&lt;/tr&gt;</span>
<span class="x">&lt;tr&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.password.label_tag</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.password</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">&lt;/tr&gt;</span>
<span class="x">&lt;/table&gt;</span>
<span class="x">&lt;input type="submit" value="Einloggen"&gt;</span>
<span class="x">&lt;input type="hidden" name="next" value="</span><span class="cp">{{</span> <span class="nv">next</span> <span class="cp">}}</span><span class="x">"&gt;</span>
<span class="x">&lt;/form&gt;</span>
<span class="x">&lt;p&gt;Noch keinen Zugang? &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'register'</span> <span class="cp">%}</span><span class="x">" class="navbar-item"&gt;Hier Registrieren&lt;/a&gt;&lt;/p&gt;</span>
<span class="c">{# Assumes you set up the password_reset view in your URLconf #}</span>
<span class="c">{# &lt;p&gt;&lt;a href="{% url 'password_reset' %}"&gt;Lost password?&lt;/a&gt;&lt;/p&gt; #}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
            </div>
           </div>
           <p>
            xplanung_light/templates/registration/register.html
           </p>
           <div class="highlight-jinja notranslate">
            <div class="highlight">
             <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"../xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;h2&gt;Registrieren&lt;/h2&gt;</span>
<span class="x">    &lt;form method="post"&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span><span class="nv">form.as_p</span><span class="cp">}}</span>
<span class="x">        &lt;button type="submit"&gt;Registrieren&lt;/button&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
            </div>
           </div>
          </section>
         </section>
         <section id="formular-fur-registrierung">
          <h3>
           Formular f&uuml;r Registrierung
           <a class="headerlink" href="#formular-fur-registrierung" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/forms.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django</span><span class="w"> </span><span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RegistrationForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'username'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">,</span> <span class="s1">'password1'</span><span class="p">,</span> <span class="s1">'password2'</span><span class="p">]</span>
</pre>
           </div>
          </div>
         </section>
         <section id="anpassung-der-views">
          <h3>
           Anpassung der views
           <a class="headerlink" href="#anpassung-der-views" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">RegistrationForm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">login</span>
<span class="c1">#...</span>
<span class="c1"># https://dev.to/balt1794/registration-page-using-usercreationform-django-part-1-21j7</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s1">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">RegistrationForm</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">RegistrationForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">'home'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'form is invalid'</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'registration/register.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre>
           </div>
          </div>
         </section>
         <section id="stylesheets-optimieren">
          <h3>
           Stylesheets optimieren
           <a class="headerlink" href="#stylesheets-optimieren" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/static/xplanung_light/site.css
          </p>
          <div class="highlight-css notranslate">
           <div class="highlight">
            <pre><span></span><span class="c">/* ... */</span>
<span class="p">.</span><span class="nc">navbar</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">lightslategray</span><span class="p">;</span>
<span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">em</span><span class="p">;</span>
<span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">'Trebuchet MS'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Lucida Sans Unicode'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Lucida Grande'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Lucida Sans'</span><span class="p">,</span><span class="w"> </span><span class="n">Arial</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">navbar</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">inherit</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">navbar-brand</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2</span><span class="kt">em</span><span class="p">;</span>
<span class="w">    </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">navbar-item</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">font-variant</span><span class="p">:</span><span class="w"> </span><span class="kc">small-caps</span><span class="p">;</span>
<span class="w">    </span><span class="k">margin-left</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">body-content</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="s1">'Segoe UI'</span><span class="p">,</span><span class="w"> </span><span class="n">Tahoma</span><span class="p">,</span><span class="w"> </span><span class="n">Geneva</span><span class="p">,</span><span class="w"> </span><span class="n">Verdana</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
</pre>
           </div>
          </div>
         </section>
         <section id="was-wir-bisher-haben">
          <h3>
           Was wir bisher haben
           <a class="headerlink" href="#was-wir-bisher-haben" title="Permalink to this heading">
            
           </a>
          </h3>
          <ol class="arabic simple">
           <li>
            <p>
             Nutzung von Templates
            </p>
           </li>
           <li>
            <p>
             Einfache function based views
            </p>
           </li>
           <li>
            <p>
             Anwendnung von css
            </p>
           </li>
           <li>
            <p>
             Formulare
            </p>
           </li>
           <li>
            <p>
             Registrierung
            </p>
           </li>
           <li>
            <p>
             Authentifizierung
            </p>
           </li>
          </ol>
          <p>
           Dokumentation auf xplanung_light/templates/xplanung_light/home.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;!-- ... --&gt;</span>
<span class="x">&lt;h4&gt;Funktionen&lt;/h4&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="x">    &lt;li&gt;Homepage&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;Authentifizierung gegen Datenbank&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;Registrierung&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;Admin-Backend&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;...&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
<span class="x">&lt;!-- ... --&gt;</span>
</pre>
           </div>
          </div>
          <p>
           Aussehen nach Anmeldung des admin im Frontend
          </p>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/">
            http://127.0.0.1:8000/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/standardfunktionen_1.png">
           <img alt="Standardfunktionen" class="bg-primary align-center" src="_images/standardfunktionen_1.png" style="width: 800px;"/>
          </a>
         </section>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-make_nicer">
        </span>
        <section id="integration-von-bootstrap5">
         <h2>
          Integration von bootstrap5
          <a class="headerlink" href="#integration-von-bootstrap5" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          <a class="reference external" href="https://django-bootstrap5.readthedocs.io/en/latest/">
           <strong>
            django-bootstrap5
           </strong>
          </a>
         </p>
         <p>
          Installation per pip
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-bootstrap5
</pre>
          </div>
         </div>
         <p>
          Aktvieren in komserv/settings.py
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1">#...</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s1">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s1">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s1">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s1">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s1">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s1">'xplanung_light'</span><span class="p">,</span>
    <span class="c1">#...</span>
    <span class="s1">'django_bootstrap5'</span><span class="p">,</span>
    <span class="c1">#...</span>
<span class="p">]</span>
<span class="c1">#...</span>
</pre>
          </div>
         </div>
         <p>
          Anpassen des Basis-Templates xplanung_light/templates/xplanung_light/layout.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="c">{# Load the tag library #}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">django_bootstrap5</span> <span class="cp">%}</span>

<span class="c">{# Load CSS and JavaScript #}</span>
<span class="cp">{%</span> <span class="k">bootstrap_css</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">bootstrap_javascript</span> <span class="cp">%}</span>

<span class="c">{# Display django.contrib.messages as Bootstrap alerts #}</span>
<span class="cp">{%</span> <span class="k">bootstrap_messages</span> <span class="cp">%}</span>
<span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset="utf-8"/&gt;</span>
<span class="x">    &lt;meta name="description" content="Author: Armin Retterath, XPlanung, Django, Formular, Easy, kostenfrei, Open Source"/&gt;</span>
<span class="x">    &lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">&lt;/title&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>
<span class="x">    &lt;link rel="stylesheet" type="text/css" href="</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">'xplanung_light/site.css'</span> <span class="cp">%}</span><span class="x">"/&gt;    </span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;!-- https://getbootstrap.com/docs/5.0/components/navbar/ --&gt;</span>
<span class="x">    &lt;nav class="navbar navbar-expand-lg navbar-dark bg-dark"&gt;</span>
<span class="x">        &lt;div class="container-fluid"&gt;</span>
<span class="x">          &lt;a class="navbar-brand" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="x">"&gt;XPlanung light&lt;/a&gt;</span>
<span class="x">          &lt;button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation"&gt;</span>
<span class="x">            &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;</span>
<span class="x">          &lt;/button&gt;</span>
<span class="x">          &lt;div class="collapse navbar-collapse" id="navbarTogglerDemo01"&gt;</span>
<span class="x">            &lt;ul class="navbar-nav me-auto mb-2 mb-lg-0"&gt;</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'about'</span> <span class="cp">%}</span><span class="x">"&gt;&Uuml;ber&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                  &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'admin:index'</span> <span class="cp">%}</span><span class="x">"&gt;Admin Backend&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">            &lt;/ul&gt;</span>
<span class="x">            &lt;div class="d-flex"&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">                &lt;p&gt;</span>
<span class="x">                    Angemeldeter Benutzer: </span><span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span><span class="x"> &lt;br&gt;</span>
<span class="x">                    &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'logout'</span> <span class="cp">%}</span><span class="x">"&gt;Abmelden&lt;/a&gt;</span>
<span class="x">                &lt;/p&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">                &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="x">"&gt;Anmelden&lt;/a&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">          &lt;/div&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/nav&gt;</span>
<span class="x">    &lt;div class="body-content"&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="x">        &lt;hr/&gt;</span>
<span class="x">        &lt;footer&gt;</span>
<span class="x">            &lt;p&gt;&amp;copy; 2025&lt;/p&gt;</span>
<span class="x">            &lt;p&gt;Letzte &Auml;nderung: 2025-04-07 14:22 Bootstrap 5 Integration&lt;/p&gt;</span>
<span class="x">        &lt;/footer&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre>
          </div>
         </div>
         <p>
          xplanung_light/templates/registration/register.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"../xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">django_bootstrap5</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">bootstrap_css</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">bootstrap_javascript</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;h2&gt;Registrieren&lt;/h2&gt;</span>
<span class="x">    &lt;form method="post"&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">bootstrap_form</span> <span class="nv">form</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">bootstrap_button</span> <span class="nv">button_type</span><span class="o">=</span><span class="s2">"submit"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"Registrieren"</span> <span class="cp">%}</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
          </div>
         </div>
         <p>
          Frontend mit bootstrap5
         </p>
         <p>
          <a class="reference external" href="http://127.0.0.1:8000/">
           http://127.0.0.1:8000/
          </a>
         </p>
         <a class="bg-primary reference internal image-reference" href="_images/bootstrap_startseite.png">
          <img alt="Frontend mit bootstrap5" class="bg-primary align-center" src="_images/bootstrap_startseite.png" style="width: 800px;"/>
         </a>
         <p>
          Registrierungsformular mit bootstrap5
         </p>
         <p>
          <a class="reference external" href="http://127.0.0.1:8000/register/">
           http://127.0.0.1:8000/register/
          </a>
         </p>
         <a class="bg-primary reference internal image-reference" href="_images/bootstrap_registrierungsformular.png">
          <img alt="Registrierungsformular mit bootstrap5" class="bg-primary align-center" src="_images/bootstrap_registrierungsformular.png" style="width: 800px;"/>
         </a>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-model_prerequisites">
        </span>
        <section id="vorbereitung">
         <h2>
          Vorbereitung
          <a class="headerlink" href="#vorbereitung" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Neben der Verwaltung r&auml;umlicher Daten, wie z.B. den Zust&auml;ndigkeitsbereichen von Verwaltungen
und Geltungsbereichen von Pl&auml;nen beinhaltet das Modell organisatorische Zust&auml;ndigkeiten, die
einem zeitlichen Wandel unterliegen. Organisationsstrukturen k&ouml;nnne sich im Lauf von mehreren Jahren
&auml;ndern und daher ist es sinnvoll diese zu historisieren.
Man kann sich ein eigenes Historienkonzept &uuml;berlegen, oder man nutzt ein vorhandenes Package.
In diesem Fall wird
          <a class="reference external" href="https://django-simple-history.readthedocs.io/en/latest/">
           <strong>
            django-simple-history
           </strong>
          </a>
          genutzt.
         </p>
         <section id="historie">
          <h3>
           Historie
           <a class="headerlink" href="#historie" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Installation des packages
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-simple-history
</pre>
           </div>
          </div>
          <p>
           Aktivierung in komserv/settings.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">'simple_history'</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1">#...</span>
<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">'simple_history.middleware.HistoryRequestMiddleware'</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           Migration des Datenmodells
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python3<span class="w"> </span>manage.py<span class="w"> </span>migrate
</pre>
           </div>
          </div>
         </section>
         <section id="spatial-data">
          <h3>
           Spatial Data
           <a class="headerlink" href="#spatial-data" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Da GeoDjango verwendet werden soll, m&uuml;ssen wir zun&auml;chst die Datenbank von SQLITE auf SPATIALITE &auml;ndern.
Hierzu reicht eine Anpassung in der globalen Konfigurationsdatei.
          </p>
          <p>
           Aktivierung in komserv/settings.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">#'ENGINE': 'django.db.backends.sqlite3',</span>
        <span class="s1">'ENGINE'</span><span class="p">:</span> <span class="s1">'django.contrib.gis.db.backends.spatialite'</span><span class="p">,</span>
        <span class="s1">'NAME'</span><span class="p">:</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'db.sqlite3'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
           </div>
          </div>
          <p>
           Damit sind die Vorbreitungen auch schon abgeschlossen. Jetzt folgt die Definition der ben&ouml;tigten Datenmodelle.
          </p>
         </section>
        </section>
        <span id="document-organization_model">
        </span>
        <section id="organisationsmodell">
         <h2>
          Organisationsmodell
          <a class="headerlink" href="#organisationsmodell" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="einleitung">
          <h3>
           Einleitung
           <a class="headerlink" href="#einleitung" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Das initiale Modell f&uuml;r verantwortliche Organisationen soll die Gebietsk&ouml;rperschaften des Landes abbilden. Diese sind grunds&auml;tzlich hierarchisch geliedert und verf&uuml;gen &uuml;ber bundesweit einheitlich definierte Schl&uuml;ssel (AGS). Verantwortlich f&uuml;r die Bereitstellung der Struktur der Gebietsk&ouml;rperschaften ist in Rheinland-Pfalz das Statistische Landesamt. Dieses publiziert das s.g.
           <a class="reference external" href="https://www.statistik.rlp.de/fileadmin/statistik.rlp.de/Dokumente_und_Bilder/3_Produkte/3_Verzeichnisse/A1132_202201_ur_G.pdf">
            <strong>
             Amtliche Verzeichnis der Gemeinden und Gemeindeteile
            </strong>
           </a>
           in Form einer PDF-Datei. Leider l&auml;sst sich das nicht ohne weiteres automatisiert verarbeiten, es gibt jedoch auch ein
           <a class="reference external" href="https://www.statistik.rlp.de/fileadmin/statistik.rlp.de/Dokumente_und_Bilder/3_Produkte/3_Verzeichnisse/Kommunalverwaltungen_01.01_2025.xlsm">
            <strong>
             Verzeichnis der Kommunalverwaltungen, Oberb&uuml;rgermeister, Landr&auml;te und B&uuml;rgermeister
            </strong>
           </a>
           . Dieses wird als xslm Mappe publiziert und enth&auml;lt &uuml;ber verschiedene Tabellen verteilt die f&uuml;r unseren Zweck ben&ouml;tigte information.
          </p>
          <p>
           Wir ben&ouml;tigen sowohl Kontaktinformationen, als auch Adressen und Zust&auml;ndigkeitsbereiche. Die Zust&auml;ndigkeitsbereiche werden vom Landesamt f&uuml;r Vermessung und Geobasisinformation &uuml;ber eine OGC-WFS Schnittstelle publiziert und enthalten auch die jeweiligen einheitlichen AGS. Damit lassen sie sich automatisiert mit den Organisationen verkn&uuml;pfen.
Um das Modell nicht unn&ouml;tig kompliziwert zu machen, speichern wir alle Informationen zun&auml;chst in einem einfachen flachen Modell.
In Django werden Modelle pro App in einer Datei models.py abgelegt. In unserem Fall also xplanung_light/models.py. Da die Modelle python-Klassen sind, l&auml;sst sich vieles &uuml;ber Vererbung umsetzen. Wir definieren dazu einfach eine simple Klasse GenericMetadata, die zun&auml;chst einfach eine automatisch generierte UUID beinhaltet, die die davon abgeleiteteten Klassen erben.
Die Integration von django-simple-history ist sehr einfach und erfolgt durch das Attribut
           <strong>
            history = HistoricalRecords()
           </strong>
           .
          </p>
         </section>
         <section id="modelldefinition">
          <h3>
           Modelldefinition
           <a class="headerlink" href="#modelldefinition" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/models.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">simple_history.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">HistoricalRecords</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="c1"># generic meta model</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GenericMetadata</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">generic_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UUIDField</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">)</span>
    <span class="c1">#created = models.DateTimeField(null=True)</span>
    <span class="c1">#changed = models.DateTimeField(null=True)</span>
    <span class="c1">#deleted = models.DateTimeField(null=True)</span>
    <span class="c1">#active = models.BooleanField(default=True)</span>
    <span class="c1">#owned_by_user = models.ForeignKey(User, on_delete=models.CASCADE, null=True)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

<span class="w">    </span><span class="sd">"""def save(self, *args, **kwargs):</span>
<span class="sd">        self.owned_by_user= self.request.user</span>
<span class="sd">        super().save(*args, **kwargs)"""</span>


<span class="c1"># administrative organizations</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AdministrativeOrganization</span><span class="p">(</span><span class="n">GenericMetadata</span><span class="p">):</span>

    <span class="n">COUNTY</span> <span class="o">=</span> <span class="s2">"KR"</span>
    <span class="n">COUNTY_FREE_CITY</span> <span class="o">=</span> <span class="s2">"KFS"</span>
    <span class="n">COM_ASS</span> <span class="o">=</span> <span class="s2">"VG"</span>
    <span class="n">COM_ASS_FREE_COM</span> <span class="o">=</span> <span class="s2">"VFG"</span>
    <span class="n">COM</span> <span class="o">=</span> <span class="s2">"GE"</span>
    <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">"UK"</span>

    <span class="n">ADMIN_CLASS_CHOICES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">COUNTY</span><span class="p">,</span>  <span class="s2">"Landkreis"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">COUNTY_FREE_CITY</span><span class="p">,</span> <span class="s2">"Kreisfreie Stadt"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">COM_ASS</span><span class="p">,</span> <span class="s2">"Verbandsgemeinde"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">COM_ASS_FREE_COM</span><span class="p">,</span> <span class="s2">"Verbandsfreie Gemeinde"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">COM</span><span class="p">,</span> <span class="s2">"Gemeinde/Stadt"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">UNKNOWN</span><span class="p">,</span> <span class="s2">"unbekannt"</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">ls</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Landesschl&uuml;ssel'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Eindeutiger zweistelliger Schl&uuml;ssel f&uuml;r das Bundesland - RLP: 07'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'07'</span><span class="p">)</span>
    <span class="n">ks</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Kreisschl&uuml;ssel'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Eindeutiger dreistelliger Schl&uuml;ssel f&uuml;r den Landkreis'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'000'</span><span class="p">)</span>
    <span class="n">vs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Gemeindeverbandsschl&uuml;ssel'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Eindeutiger zweistelliger Schl&uuml;ssel f&uuml;r den Gemeindeverband'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'00'</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Gemeindeschl&uuml;ssel'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Eindeutiger dreistelliger Schl&uuml;ssel f&uuml;r die Gemeinde'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'000'</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Name der Gebietsk&ouml;rperschaft'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Offizieller Name der Gebietsk&ouml;rperschaft - z.B. Rhein-Lahn-Kreis'</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">ADMIN_CLASS_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'UK'</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Typ der Gebietsk&ouml;rperschaft'</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">address_street</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Stra&szlig;e mit Hausnummer'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Stra&szlig;e und Hausnummer'</span><span class="p">)</span>
    <span class="n">address_postcode</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Postleitzahl'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Postleitzahl'</span><span class="p">)</span>
    
    <span class="n">address_city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Stadt'</span><span class="p">)</span>
    <span class="n">address_phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Telefon'</span><span class="p">)</span>
    <span class="n">address_facsimile</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Fax'</span><span class="p">)</span>
    <span class="n">address_email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'EMail'</span><span class="p">)</span>
    <span class="n">address_homepage</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Homepage'</span><span class="p">)</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GeometryField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Gebiet'</span><span class="p">)</span>
    <span class="n">history</span> <span class="o">=</span> <span class="n">HistoricalRecords</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Returns a string representation of a administrative unit."""</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">' '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">'"</span>
</pre>
           </div>
          </div>
          <p>
           Migration
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python3<span class="w"> </span>manage.py<span class="w"> </span>migrate
</pre>
           </div>
          </div>
         </section>
         <section id="datenimport">
          <h3>
           Datenimport
           <a class="headerlink" href="#datenimport" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Da die ben&ouml;tigten Daten f&uuml;r die Organisationen als xslm und in Form von Webservices bereitstehen, ben&ouml;tigen wir zwei weitere python-Bibliotheken.
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>openpyxl
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>requests
</pre>
           </div>
          </div>
          <p>
           Wir laden die xslm Datei zun&auml;chst h&auml;ndisch herunter und legen sie in unser Arbeitsverzeichnis.
          </p>
          <p>
           <a class="reference external" href="https://www.statistik.rlp.de/fileadmin/statistik.rlp.de/Dokumente_und_Bilder/3_Produkte/3_Verzeichnisse/Kommunalverwaltungen_01.01_2025.xlsm">
            Verzeichnis der Kommunalverwaltungen, Oberb&uuml;rgermeister, Landr&auml;te und B&uuml;rgermeister
           </a>
          </p>
          <p>
           Die Funktionen f&uuml;r den Import speichern wir in xplanung_light/views.py. Hier ist wichtig, dass die Proxy-Einstellungen in der Datei angepasst werden. F&uuml;r produktive Zwecke ist es besser, die Proxy-Konfiguration in der zentralen Konfigurationsdatei abzulegen und zu importieren. Hierzu sp&auml;ter mehr.
          </p>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdministrativeOrganization</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.geos</span><span class="w"> </span><span class="kn">import</span> <span class="n">GEOSGeometry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openpyxl</span><span class="w"> </span><span class="kn">import</span> <span class="n">Workbook</span><span class="p">,</span> <span class="n">load_workbook</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="c1">#...</span>

<span class="n">PROXIES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'http_proxy'</span><span class="p">:</span> <span class="s1">'http://xxx:8080'</span><span class="p">,</span>
    <span class="s1">'https_proxy'</span><span class="p">:</span> <span class="s1">'http://xxx:8080'</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_geometry</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">ags</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span><span class="s1">'KR'</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span><span class="s1">'KFS'</span><span class="p">:</span>
        <span class="n">base_uri</span> <span class="o">=</span> <span class="s2">"https://www.geoportal.rlp.de/spatial-objects/314/collections/vermkv:landkreise_rlp"</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'f'</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span> <span class="s1">'kreissch'</span><span class="p">:</span> <span class="n">ags</span><span class="p">[:</span><span class="mi">3</span><span class="p">]}</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span><span class="s1">'VG'</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span><span class="s1">'VFG'</span><span class="p">:</span>
        <span class="n">base_uri</span> <span class="o">=</span> <span class="s2">"https://www.geoportal.rlp.de/spatial-objects/314/collections/vermkv:verbandsgemeinde_rlp"</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'f'</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span> <span class="s1">'vgnr'</span><span class="p">:</span> <span class="n">ags</span><span class="p">[:</span><span class="mi">5</span><span class="p">]}</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">'GE'</span><span class="p">:</span>
        <span class="n">base_uri</span> <span class="o">=</span> <span class="s2">"https://www.geoportal.rlp.de/spatial-objects/314/collections/vermkv:gemeinde_rlp"</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'f'</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span> <span class="s1">'ags'</span><span class="p">:</span> <span class="s2">"*7"</span> <span class="o">+</span> <span class="n">ags</span><span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">base_uri</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">PROXIES</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">base_uri</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">param_dict</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> 
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'features'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'geometry'</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">import_organisations</span><span class="p">():</span>
    <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="s1">'Kommunalverwaltungen_01.01_2025.xlsm'</span><span class="p">)</span>
    <span class="c1"># nuts-1 - bundeslandebene</span>
    <span class="c1"># nuts-2 - regierungsbezirke</span>
    <span class="c1"># nuts-3 - landkreisebene</span>
    <span class="c1"># lau-1 - verbandsgemeindeebene</span>
    <span class="c1"># lau-2 - gemeideebene</span>

    <span class="n">table_all_admin_units</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">table_nuts_3_1</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">table_nuts_3_2</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">table_lau_1_1</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">table_lau_1_2</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
    <span class="c1"># table_lau_2 = wb.worksheets[10]</span>

    <span class="n">count_landkreise</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_kreisfreie_staedte</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_verbandsgemeinden</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_verbandsfreie_gemeinden</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_gemeinden</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># read landkreisebene</span>
    <span class="n">landkreisebene</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_nuts_3_1</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">landkreis</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'KR'</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'street'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'postcode'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'city'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'phone'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'facsimile'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'homepage'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"https://"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
                <span class="n">landkreisebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">landkreis</span>
                <span class="n">count_landkreise</span> <span class="o">=</span> <span class="n">count_landkreise</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>           
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_nuts_3_2</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kreisfreie_stadt</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'KFS'</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'street'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'postcode'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'city'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'phone'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'facsimile'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'homepage'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"https://"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
                <span class="n">landkreisebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">kreisfreie_stadt</span>
                <span class="n">count_kreisfreie_staedte</span> <span class="o">=</span> <span class="n">count_kreisfreie_staedte</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c1"># read verbandsgemeindeebene</span>
    <span class="n">verbandsgemeindeebene</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_lau_1_1</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vg</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'VG'</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'street'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'postcode'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'city'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'phone'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'facsimile'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'homepage'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"https://"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
                <span class="n">verbandsgemeindeebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">vg</span>
                <span class="n">count_verbandsgemeinden</span> <span class="o">=</span> <span class="n">count_verbandsgemeinden</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_lau_1_2</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vg</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'VFG'</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'street'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'postcode'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'city'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'phone'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'facsimile'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'homepage'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"https://"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
                <span class="n">verbandsgemeindeebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">vg</span>
                <span class="n">count_verbandsfreie_gemeinden</span> <span class="o">=</span> <span class="n">count_verbandsfreie_gemeinden</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c1">#print(json.dumps(landkreise))</span>
    <span class="n">all_admin_units</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_all_admin_units</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">admin_unit</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'name'</span><span class="p">])</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'plz'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'GE'</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'00'</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'000'</span><span class="p">:</span>
                    <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">landkreisebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s1">'type'</span><span class="p">]</span>
                    <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="n">landkreisebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s1">'address'</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'00'</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'000'</span><span class="p">:</span>
                    <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbandsgemeindeebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s1">'type'</span><span class="p">]</span>
                    <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbandsgemeindeebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s1">'address'</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'geometry'</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_geometry</span><span class="p">(</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">all_admin_units</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">admin_unit</span>   
                <span class="c1">#save object to database</span>
                <span class="n">obj</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">AdministrativeOrganization</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update_or_create</span><span class="p">(</span>
                    <span class="n">ks</span><span class="o">=</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">],</span>
                    <span class="n">vs</span><span class="o">=</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">],</span>
                    <span class="n">gs</span><span class="o">=</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">],</span>
                    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">"ks"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">],</span>
                        <span class="s2">"vs"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">],</span>
                        <span class="s2">"gs"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">],</span>
                        <span class="s2">"name"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">],</span>
                        <span class="s2">"geometry"</span><span class="p">:</span> <span class="n">GEOSGeometry</span><span class="p">(</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'geometry'</span><span class="p">])</span>
                    <span class="p">},</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                administration = AdministrativeOrganization()</span>
<span class="sd">                administration.ks = admin_unit['kr']</span>
<span class="sd">                administration.vs = admin_unit['vg']</span>
<span class="sd">                administration.gs = admin_unit['ge']</span>
<span class="sd">                administration.name = admin_unit['name']</span>
<span class="sd">                administration.type = admin_unit['type']</span>
<span class="sd">                administration.geometry = GEOSGeometry(admin_unit['geometry'])</span>
<span class="sd">                administration.save()</span>
<span class="sd">                """</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Landkreise:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count_landkreise</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Kreisfreie St&auml;dte:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count_kreisfreie_staedte</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Verbandsgemeinden:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count_verbandsgemeinden</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Verbandsfreie Gemeinden:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count_verbandsfreie_gemeinden</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre>
           </div>
          </div>
          <p>
           Der initiale Import wird einfach von der shell gestartet. Wir nutzen hier die Django shell, &uuml;ber die man direkten Zugriff auf die Funktionen im Projekt erh&auml;lt.
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>shell
</pre>
           </div>
          </div>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">import_organisations</span>
<span class="n">import_organisations</span><span class="p">()</span>
</pre>
           </div>
          </div>
         </section>
        </section>
        <span id="document-plan_model">
        </span>
        <section id="planmodell">
         <h2>
          Planmodell
          <a class="headerlink" href="#planmodell" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="einleitung">
          <h3>
           Einleitung
           <a class="headerlink" href="#einleitung" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Das Modell zur Verwaltung von kommunalen Pl&auml;nen orientiert sich am deutschen Standard
           <a class="reference external" href="https://xleitstelle.de/xplanung">
            <strong>
             XPlanung
            </strong>
           </a>
           und am
           <a class="reference external" href="https://www.geoportal.rlp.de/metadata/Leitfaden_kommunale_Plaene_GDI_RP.pdf">
            <strong>
             Leitfaden f&uuml;r die Bereitstellung kommunaler Pl&auml;ne und Satzungen im Rahmen der Geodateninfrastruktur Rheinland-Pfalz (GDI-RP)
            </strong>
           </a>
           . Dieser Leitfaden wurde ab 2008 auf Basis von XPlanung 2.0 entwickelt. Neben den Vorgaben des Datenaustauschstandards wurden dabei auch Anforderungen aus der kommunalen Praxis &uuml;bernommen und eine standardisierte Bereitstellung vorgegeben. Der Standard wurde mit den kommunalen Spitzenverb&auml;nden des Landes abgestimmt und wird vom Lenkungsausschuss f&uuml;r Geodateninfrastruktur Rheinland-Pfalz herausgegeben.
          </p>
          <p>
           In einer ersten Version des Modells wird nur eine minimale Zahl von Attributen definiert. F&uuml;r den proof of concept (POC)  ist das zun&auml;chst ausreichend. Das abstrakte Grundmodell hei&szlig;t XPlan und vererbt seine Attribute auf das konkrete Modell BPlan. Der Geltungsbereich ist als Geometry-Field modelliert und kann damit auch Multipolygone aufnehmen.
          </p>
         </section>
         <section id="modelldefinition">
          <h3>
           Modelldefinition
           <a class="headerlink" href="#modelldefinition" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/models.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="sd">"""</span>
<span class="sd">https://xleitstelle.de/releases/objektartenkatalog_6_0</span>
<span class="sd">"""</span>
<span class="k">class</span><span class="w"> </span><span class="nc">XPlan</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Name des Plans'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Offizieller Name des raumbezogenen Plans'</span><span class="p">)</span>
    <span class="c1">#nummer [0..1]</span>
    <span class="n">nummer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">"Nummer des Plans."</span><span class="p">)</span>
    <span class="c1">#internalId [0..1]</span>
    <span class="c1">#beschreibung [0..1]</span>
    <span class="c1">#kommentar [0..1]</span>
    <span class="c1">#technHerstellDatum [0..1], Date</span>
    <span class="c1">#genehmigungsDatum [0..1], Date</span>
    <span class="c1">#untergangsDatum [0..1], Date</span>
    <span class="c1">#aendertPlan [0..*], XP_VerbundenerPlan</span>
    <span class="c1">#wurdeGeaendertVonPlan [0..*], XP_VerbundenerPlan</span>
    <span class="c1">#aendertPlanBereich [0..*], Referenz, Testphase</span>
    <span class="c1">#wurdeGeaendertVonPlanBereich [0..*], Referenz, Testphase</span>
    <span class="c1">#erstellungsMassstab [0..1], Integer</span>
    <span class="c1">#bezugshoehe [0..1], Length</span>
    <span class="c1">#hoehenbezug [0..1]</span>
    <span class="c1">#technischerPlanersteller, [0..1]</span>
    <span class="c1">#raeumlicherGeltungsbereich [1], GM_Object</span>
    <span class="n">geltungsbereich</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GeometryField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Grenze des r&auml;umlichen Geltungsbereiches des Plans.'</span><span class="p">)</span>
    <span class="c1">#verfahrensMerkmale [0..*], XP_VerfahrensMerkmal</span>
    <span class="c1">#hatGenerAttribut [0..*], XP_GenerAttribut</span>
    <span class="c1">#externeReferenz, [0..*], XP_SpezExterneReferenz</span>
    <span class="c1">#texte [0..*], XP_TextAbschnitt</span>
    <span class="c1">#begruendungsTexte [0..*], XP_BegruendungAbschnitt</span>
    <span class="n">history</span> <span class="o">=</span> <span class="n">HistoricalRecords</span><span class="p">(</span><span class="n">inherit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BPlan</span><span class="p">(</span><span class="n">XPlan</span><span class="p">):</span>

    <span class="n">BPLAN</span> <span class="o">=</span> <span class="s2">"1000"</span>
    <span class="n">EINFACHERBPLAN</span> <span class="o">=</span> <span class="s2">"10000"</span>
    <span class="n">QUALIFIZIERTERBPLAN</span> <span class="o">=</span> <span class="s2">"10001"</span>
    <span class="n">BEBAUUNGSPLANZURWOHNRAUMVERSORGUNG</span> <span class="o">=</span> <span class="s2">"10002"</span>
    <span class="n">VORHABENBEZOGENERBPLAN</span> <span class="o">=</span> <span class="s2">"3000"</span>
    <span class="n">VORHABENUNDERSCHLIESSUNGSPLAN</span> <span class="o">=</span> <span class="s2">"3100"</span>
    <span class="n">INNENBEREICHSSATZUNG</span> <span class="o">=</span> <span class="s2">"4000"</span>
    <span class="n">KLARSTELLUNGSSATZUNG</span> <span class="o">=</span> <span class="s2">"40000"</span>
    <span class="n">ENTWICKLUNGSSATZUNG</span> <span class="o">=</span> <span class="s2">"40001"</span>
    <span class="n">ERGAENZUNGSSATZUNG</span> <span class="o">=</span> <span class="s2">"40002"</span>
    <span class="n">AUSSENBEREICHSSATZUNG</span> <span class="o">=</span> <span class="s2">"5000"</span>
    <span class="n">OERTLICHEBAUVORSCHRIFT</span> <span class="o">=</span> <span class="s2">"7000"</span>
    <span class="n">SONSTIGES</span> <span class="o">=</span> <span class="s2">"9999"</span>

    <span class="n">BPLAN_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">BPLAN</span><span class="p">,</span>  <span class="s2">"BPlan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">EINFACHERBPLAN</span><span class="p">,</span> <span class="s2">"EinfacherBPlan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">QUALIFIZIERTERBPLAN</span><span class="p">,</span> <span class="s2">"QualifizierterBPlan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">BEBAUUNGSPLANZURWOHNRAUMVERSORGUNG</span><span class="p">,</span> <span class="s2">"BebauungsplanZurWohnraumversorgung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">VORHABENBEZOGENERBPLAN</span><span class="p">,</span> <span class="s2">"VorhabenbezogenerBPlan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">VORHABENUNDERSCHLIESSUNGSPLAN</span><span class="p">,</span> <span class="s2">"VorhabenUndErschliessungsplan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">INNENBEREICHSSATZUNG</span><span class="p">,</span> <span class="s2">"InnenbereichsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">KLARSTELLUNGSSATZUNG</span><span class="p">,</span> <span class="s2">"KlarstellungsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ENTWICKLUNGSSATZUNG</span><span class="p">,</span> <span class="s2">"EntwicklungsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ERGAENZUNGSSATZUNG</span><span class="p">,</span> <span class="s2">"ErgaenzungsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">AUSSENBEREICHSSATZUNG</span><span class="p">,</span> <span class="s2">"AussenbereichsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">OERTLICHEBAUVORSCHRIFT</span><span class="p">,</span> <span class="s2">"OertlicheBauvorschrift"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SONSTIGES</span><span class="p">,</span> <span class="s2">"Sonstiges"</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="c1">#gemeinde [1], XP_Gemeinde</span>
    <span class="n">gemeinde</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">AdministrativeOrganization</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">)</span>
    <span class="c1">#planaufstellendeGemeinde [0..*], XP_Gemeinde</span>
    <span class="c1">#plangeber [0..*], XP_Plangeber</span>
    <span class="c1">#planArt [1..*], BP_PlanArt</span>
    <span class="n">planart</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">BPLAN_TYPE_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'1000'</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Typ des vorliegenden Bebauungsplans.'</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
	<span class="c1">#sonstPlanArt [0..1], BP_SonstPlanArt</span>
    <span class="c1">#rechtsstand [0..1], BP_Rechtsstand</span>
    <span class="c1">#status [0..1], BP_Status</span>
    <span class="c1">#aenderungenBisDatum [0..1], Date</span>
    <span class="c1">#aufstellungsbeschlussDatum [0..1], Date</span>
    <span class="c1">#veraenderungssperre [0..1], BP_VeraenderungssperreDaten</span>
    <span class="c1">#auslegungsStartDatum [0..*], Date</span>
    <span class="c1">#auslegungsEndDatum [0..*], Date</span>
    <span class="c1">#traegerbeteiligungsStartDatum [0..*], Date</span>
    <span class="c1">#traegerbeteiligungsEndDatum [0..*], Date</span>
    <span class="c1">#satzungsbeschlussDatum [0..1], Date</span>
    <span class="c1">#rechtsverordnungsDatum [0..1], Date</span>
    <span class="c1">#inkrafttretensDatum [0..1], Date</span>
    <span class="c1">#ausfertigungsDatum [0..1], Date</span>
    <span class="c1">#staedtebaulicherVertrag [0..1], Boolean</span>
    <span class="c1">#erschliessungsVertrag [0..1], Boolean</span>
    <span class="c1">#durchfuehrungsVertrag [0..1], Boolean</span>
    <span class="c1">#gruenordnungsplan [0..1], Boolean</span>
    <span class="c1">#versionBauNVO [0..1], XP_GesetzlicheGrundlage</span>
    <span class="c1">#versionBauGB [0..1], XP_GesetzlicheGrundlage</span>
    <span class="c1">#versionSonstRechtsgrundlage [0..*], XP_GesetzlicheGrundlage</span>
    <span class="c1">#bereich [0..*], BP_Bereich</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Returns a string representation of a BPlan."""</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">planart</span><span class="si">}</span><span class="s2">': '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">'"</span>
</pre>
           </div>
          </div>
         </section>
         <section id="verwaltungsviews">
          <h3>
           Verwaltungsviews
           <a class="headerlink" href="#verwaltungsviews" title="Permalink to this heading">
            
           </a>
          </h3>
          <section id="vorarbeiten">
           <h4>
            Vorarbeiten
            <a class="headerlink" href="#vorarbeiten" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            Um eine komfortable Verwaltung von Geometrien zu erm&ouml;glichen, bietet es sich an das Django Leaflet package (
            <a class="reference external" href="https://django-leaflet.readthedocs.io/en/latest/">
             <strong>
              django-leaflet
             </strong>
            </a>
            ) einzusetzen. Standardm&auml;&szlig;ig ist bei django noch eine &auml;lterer OpenLayers-Client (2.13) integriert.
           </p>
           <p>
            Installation des packages
           </p>
           <div class="highlight-shell notranslate">
            <div class="highlight">
             <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-leaflet
</pre>
            </div>
           </div>
           <p>
            Aktivieren des packages in komserv/settings.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#...</span>
    <span class="s1">'leaflet'</span><span class="p">,</span>
<span class="c1">#...</span>
</pre>
            </div>
           </div>
           <p>
            Ersatz des OpenLayer Client im Admin backend  - xplanung_light/admin.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">leaflet.admin</span><span class="w"> </span><span class="kn">import</span> <span class="n">LeafletGeoAdmin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlan</span>
<span class="c1">#...</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">BPlan</span><span class="p">,</span> <span class="n">LeafletGeoAdmin</span><span class="p">)</span>
<span class="c1">#...</span>
</pre>
            </div>
           </div>
          </section>
          <section id="urls">
           <h4>
            Urls
            <a class="headerlink" href="#urls" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            xplanung_light/urls.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlanCreateView</span><span class="p">,</span> <span class="n">BPlanUpdateView</span><span class="p">,</span> <span class="n">BPlanDeleteView</span><span class="p">,</span> <span class="n">BPlanListView</span>
<span class="c1">#...</span>
    <span class="c1"># urls for bplan</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/"</span><span class="p">,</span> <span class="n">BPlanListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-list"</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/create/"</span><span class="p">,</span> <span class="n">BPlanCreateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-create"</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/&lt;int:pk&gt;/update/"</span><span class="p">,</span> <span class="n">BPlanUpdateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-update"</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/&lt;int:pk&gt;/delete/"</span><span class="p">,</span> <span class="n">BPlanDeleteView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-delete"</span><span class="p">),</span>
<span class="p">]</span>
</pre>
            </div>
           </div>
          </section>
          <section id="views">
           <h4>
            Views
            <a class="headerlink" href="#views" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            Nutzung von einfachen ClassBasedGenericViews
           </p>
           <p>
            xplanung_light/views.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views.generic</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">ListView</span><span class="p">,</span> <span class="n">CreateView</span><span class="p">,</span> <span class="n">UpdateView</span><span class="p">,</span> <span class="n">DeleteView</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdministrativeOrganization</span><span class="p">,</span> <span class="n">BPlan</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse_lazy</span>
<span class="c1">#...</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BPlanCreateView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"nummer"</span><span class="p">,</span> <span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">]</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 


<span class="k">class</span><span class="w"> </span><span class="nc">BPlanUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"nummer"</span><span class="p">,</span> <span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">]</span> 
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 


<span class="k">class</span><span class="w"> </span><span class="nc">BPlanDeleteView</span><span class="p">(</span><span class="n">DeleteView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BPlanListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 
</pre>
            </div>
           </div>
          </section>
          <section id="templates">
           <h4>
            Templates
            <a class="headerlink" href="#templates" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            xplanung_light/templates/xplanung_light/*
           </p>
           <section id="list">
            <h5>
             List
             <a class="headerlink" href="#list" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             xplanung_light/templates/xplanung_light/bplan_list.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Liste der Bebauungspl&auml;ne</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Treffer: </span><span class="cp">{{</span> <span class="nv">object_list.count</span> <span class="cp">}}</span><span class="x"> Bebauungspl&auml;ne&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
             </div>
            </div>
           </section>
           <section id="confirm-delete">
            <h5>
             Confirm Delete
             <a class="headerlink" href="#confirm-delete" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             xplanung_light/templates/xplanung_light/bplan_confirm_delete.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="x">&lt;form method="post"&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">    &lt;p&gt;Wollen sie das Objekt wirklich l&ouml;schen? "</span><span class="cp">{{</span> <span class="nv">object</span> <span class="cp">}}</span><span class="x">"?&lt;/p&gt;</span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">form</span> <span class="cp">}}</span>
<span class="x">    &lt;input type="submit" value="Best&auml;tigung"&gt;</span>
<span class="x">&lt;/form&gt;</span>
</pre>
             </div>
            </div>
           </section>
           <section id="create">
            <h5>
             Create
             <a class="headerlink" href="#create" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             xplanung_light/templates/xplanung_light/bplan_form.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Bebauungsplan anlegen</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;form method="post"&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
<span class="x">        &lt;input type="submit" value="Save"&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
             </div>
            </div>
           </section>
           <section id="update">
            <h5>
             Update
             <a class="headerlink" href="#update" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             xplanung_light/templates/xplanung_light/bplan_form_update.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Bebauungsplan editieren</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;form method="post"&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
<span class="x">        &lt;input type="submit" value="Aktualisieren"&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
             </div>
            </div>
           </section>
          </section>
         </section>
         <section id="erfassung-eines-bplans-im-admin-backend">
          <h3>
           Erfassung eines BPlans im Admin-Backend
           <a class="headerlink" href="#erfassung-eines-bplans-im-admin-backend" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/admin/xplanung_light/bplan/add/">
            http://127.0.0.1:8000/admin/xplanung_light/bplan/add/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/bplan_editor_in_admin.png">
           <img alt="Erfassung eines BPlans im Admin-Backend" class="bg-primary align-center" src="_images/bplan_editor_in_admin.png" style="width: 800px;"/>
          </a>
         </section>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-optimize_views">
        </span>
        <section id="geometrie-editor">
         <h2>
          Geometrie Editor
          <a class="headerlink" href="#geometrie-editor" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="aktivieren-des-leaflet-clients-in-den-views">
          <h3>
           Aktivieren des Leaflet-Clients in den Views
           <a class="headerlink" href="#aktivieren-des-leaflet-clients-in-den-views" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Leaflet Integration im Basis-Template xplanung_light/templates/xplanung_light/layout.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="c">{# ... #}</span>
<span class="c">{# load leaflet specific parts #}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">leaflet_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">leaflet_css</span> <span class="nv">plugins</span><span class="o">=</span><span class="s2">"ALL"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">leaflet_js</span> <span class="nv">plugins</span><span class="o">=</span><span class="s2">"ALL"</span> <span class="cp">%}</span>
<span class="c">{# ... #}</span>
</pre>
           </div>
          </div>
          <p>
           Anpassung der BPlanCreateView und BPlanUpdateView in xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">leaflet.forms.widgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">LeafletWidget</span>
<span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanCreateView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"nummer"</span><span class="p">,</span> <span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">]</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 

    <span class="k">def</span><span class="w"> </span><span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">form_class</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'gemeinde'</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'gemeinde'</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s2">"pk"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'geltungsbereich'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">LeafletWidget</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'geom_type'</span><span class="p">:</span> <span class="s1">'MultiPolygon'</span><span class="p">,</span> <span class="s1">'map_height'</span><span class="p">:</span> <span class="s1">'500px'</span><span class="p">,</span> <span class="s1">'map_width'</span><span class="p">:</span> <span class="s1">'50%'</span><span class="p">,</span><span class="s1">'MINIMAP'</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
	<span class="k">return</span> <span class="n">form</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BPlanUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"nummer"</span><span class="p">,</span> <span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">]</span> 
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 

    <span class="k">def</span><span class="w"> </span><span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">form_class</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'gemeinde'</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'gemeinde'</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s2">"pk"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'geltungsbereich'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">LeafletWidget</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'geom_type'</span><span class="p">:</span> <span class="s1">'MultiPolygon'</span><span class="p">,</span> <span class="s1">'map_height'</span><span class="p">:</span> <span class="s1">'500px'</span><span class="p">,</span> <span class="s1">'map_width'</span><span class="p">:</span> <span class="s1">'50%'</span><span class="p">,</span><span class="s1">'MINIMAP'</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">form</span>
</pre>
           </div>
          </div>
         </section>
         <section id="erfassung-eines-bplans-im-frontend">
          <h3>
           Erfassung eines BPlans im Frontend
           <a class="headerlink" href="#erfassung-eines-bplans-im-frontend" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/bplan/create/">
            http://127.0.0.1:8000/bplan/create/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/bplan_create_view_leaflet.png">
           <img alt="Erfassung eines BPlans im Frontend" class="bg-primary align-center" src="_images/bplan_create_view_leaflet.png" style="width: 800px;"/>
          </a>
         </section>
        </section>
        <section id="tabellenanzeige">
         <h2>
          Tabellenanzeige
          <a class="headerlink" href="#tabellenanzeige" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Um mit geringem Aufwand eine einfach zu pflegende Tabellenanzeige zu erhalten, bietet sich das package
          <a class="reference external" href="https://django-tables2.readthedocs.io/en/latest/">
           <strong>
            django-tables2
           </strong>
          </a>
          an.
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-tables2
</pre>
          </div>
         </div>
         <p>
          Package zu komserv/settings.py hinzuf&uuml;gen
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1">#...</span>
    <span class="s1">'django_tables2'</span><span class="p">,</span>
<span class="c1">#...</span>
</pre>
          </div>
         </div>
         <p>
          Erstellen einer Python-Datei f&uuml;r das Management von Tabellen
         </p>
         <p>
          xplanung_light/tables.py
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tables</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlan</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">A</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BPlanTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
    <span class="c1">#download = tables.LinkColumn('gedis-document-pdf', text='Download', args=[A('pk')], \</span>
    <span class="c1">#                     orderable=False, empty_values=())</span>
    <span class="n">edit</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-update'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'Bearbeiten'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">delete</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-delete'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'L&ouml;schen'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    geojson = Column(</span>
<span class="sd">        accessor=A('geojson'),</span>
<span class="sd">        orderable=False,</span>
<span class="sd">        # ...</span>
<span class="sd">    )</span>
<span class="sd">    """</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s2">"django_tables2/bootstrap5.html"</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"edit"</span><span class="p">,</span> <span class="s2">"delete"</span><span class="p">)</span>
</pre>
          </div>
         </div>
         <p>
          Anpassung der Klasse BPlanListView in xplanung_light/views.py - Integration des Tabellenmoduls
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="kn">import</span> <span class="n">SingleTableView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.tables</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlanTable</span>
<span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanListView</span><span class="p">(</span><span class="n">SingleTableView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">table_class</span> <span class="o">=</span> <span class="n">BPlanTable</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 
</pre>
          </div>
         </div>
        </section>
        <section id="anpassung-templates">
         <h2>
          Anpassung Templates
          <a class="headerlink" href="#anpassung-templates" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Anpassung der Liste - Hinzuf&uuml;gen eines Create Buttons - xplanung_light/templates/xplanung_light/bplan_list.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="c">{# .... #}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">render_table</span> <span class="nv">from</span> <span class="nv">django_tables2</span> <span class="cp">%}</span>
<span class="x">&lt;!-- add boostrap form css --&gt;</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">django_bootstrap5</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;&lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-create'</span> <span class="cp">%}</span><span class="x">"&gt;BPlan anlegen&lt;/a&gt;&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">render_table</span> <span class="nv">table</span> <span class="cp">%}</span>
<span class="c">{# .... #}</span>
</pre>
          </div>
         </div>
         <p>
          Men&uuml;eintrag f&uuml;r Bebauungspl&auml;ne hinzuf&uuml;gen - xplanung_light/templates/xplanung_light/layout.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="c">{# .... #}</span>
<span class="x">&lt;ul class="navbar-nav me-auto mb-2 mb-lg-0"&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-list'</span> <span class="cp">%}</span><span class="x">"&gt;Bebauungspl&auml;ne&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="c">{# .... #}</span>
</pre>
          </div>
         </div>
         <p>
          Datenmodelle migrieren
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python3<span class="w"> </span>manage.py<span class="w"> </span>migrate
</pre>
          </div>
         </div>
        </section>
        <section id="liste-der-plane-im-frontend">
         <h2>
          Liste der Pl&auml;ne im Frontend
          <a class="headerlink" href="#liste-der-plane-im-frontend" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          <a class="reference external" href="http://127.0.0.1:8000/bplan/">
           http://127.0.0.1:8000/bplan/
          </a>
         </p>
         <a class="bg-primary reference internal image-reference" href="_images/bplan_list_tables2.png">
          <img alt="Liste der Pl&auml;ne im Frontend" class="bg-primary align-center" src="_images/bplan_list_tables2.png" style="width: 800px;"/>
         </a>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-leaflet_conf">
        </span>
        <section id="zentrale-konfiguration">
         <h2>
          Zentrale Konfiguration
          <a class="headerlink" href="#zentrale-konfiguration" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          komserv/settings.py
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1">#...</span>
<span class="n">LEAFLET_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># conf here</span>
    <span class="s1">'SPATIAL_EXTENT'</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">49.0</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mi">52</span><span class="p">),</span>
    <span class="s1">'DEFAULT_CENTER'</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span>
    <span class="s1">'DEFAULT_ZOOM'</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="s1">'MIN_ZOOM'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">'MAX_ZOOM'</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">'DEFAULT_PRECISION'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1">#...</span>
</pre>
          </div>
         </div>
        </section>
        <section id="wms-layer-hinzufugen">
         <h2>
          WMS Layer hinzuf&uuml;gen
          <a class="headerlink" href="#wms-layer-hinzufugen" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Muss im im jeweiligen Template erfolgen, da die zentrale Leaflet Konfiguration nur zus&auml;tzliche Tiled Layer erlaubt.
Siehe auch
          <a class="reference external" href="https://stackoverflow.com/questions/66938889/how-to-add-leaflet-extensions-marker-basemap-geocoder-to-django-leaflet">
           https://stackoverflow.com/questions/66938889/how-to-add-leaflet-extensions-marker-basemap-geocoder-to-django-leaflet
          </a>
         </p>
         <p>
          xplanung_light/templates/xplanung_light/bplan_form.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Bebauungsplan anlegen</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;script type="text/javascript"&gt;</span>
<span class="x">    window.addEventListener("map:init", function(e) {</span>
<span class="x">            var detail = e.detail;</span>
<span class="x">            var map = detail.map;</span>
<span class="x">            /* Transparent overlay layers */</span>
<span class="x">            var wmsLayer = L.tileLayer.wms('https://geo5.service24.rlp.de/wms/liegenschaften_rp.fcgi?', {</span>
<span class="x">                layers: 'Flurstueck',</span>
<span class="x">                format: 'image/png',</span>
<span class="x">                maxZoom: 20,</span>
<span class="x">                transparent: true,</span>
<span class="x">            }).addTo(map);</span>
<span class="x">            // and many more</span>
<span class="x">        }, false</span>
<span class="x">    ); //end of window.addEventListener</span>
<span class="x">&lt;/script&gt;</span>
<span class="x">    &lt;form method="post" class="geocoding-form"&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
<span class="x">        &lt;input type="submit" value="Speichern"&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
          </div>
         </div>
         <p>
          xplanung_light/templates/xplanung_light/bplan_form_update.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Bebauungsplan editieren</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;script type="text/javascript"&gt;</span>
<span class="x">    window.addEventListener("map:init", function(e) {</span>
<span class="x">            var detail = e.detail;</span>
<span class="x">            var map = detail.map;</span>
<span class="x">            /* Transparent overlay layers */</span>
<span class="x">            var wmsLayer = L.tileLayer.wms('https://geo5.service24.rlp.de/wms/liegenschaften_rp.fcgi?', {</span>
<span class="x">                layers: 'Flurstueck',</span>
<span class="x">                format: 'image/png',</span>
<span class="x">                maxZoom: 20,</span>
<span class="x">                transparent: true,</span>
<span class="x">            }).addTo(map);</span>
<span class="x">            // and many more</span>
<span class="x">        }, false</span>
<span class="x">    ); //end of window.addEventListener</span>
<span class="x">&lt;/script&gt;</span>
<span class="x">    &lt;form method="post" class="geocoding-form"&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
<span class="x">        &lt;input type="submit" value="Aktualisieren"&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
          </div>
         </div>
        </section>
        <section id="darstellung-wms-in-client">
         <h2>
          Darstellung WMS in Client
          <a class="headerlink" href="#darstellung-wms-in-client" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          <a class="reference external" href="http://127.0.0.1:8000/admin/xplanung_light/bplan/add/">
           http://127.0.0.1:8000/admin/xplanung_light/bplan/add/
          </a>
         </p>
         <a class="bg-primary reference internal image-reference" href="_images/leaflet_wms_view.png">
          <img alt="Darstellung WMS in Client" class="bg-primary align-center" src="_images/leaflet_wms_view.png" style="width: 800px;"/>
         </a>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-export_xml_1">
        </span>
        <section id="xplanung-gml-export">
         <h2>
          XPlanung GML Export
          <a class="headerlink" href="#xplanung-gml-export" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          F&uuml;r den interoperablen Datenaustausch m&uuml;ssen die Bebauungsplaninformationen in XPlan-GML exportiert werden k&ouml;nnen.
In Django lassen sich hierf&uuml;r einfache XML-Templates verwenden. Diese werden zur Laufzeit mit den Daten aus der DB gef&uuml;llt.
Das Prinzip ist das gleiche wie bei den HTML-Templates.
         </p>
         <section id="export-xml-view">
          <h3>
           Export XML View
           <a class="headerlink" href="#export-xml-view" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           F&uuml;r den Export brauchen wir einen View. Da immer nur ein einzelner Bebauungsplan exportiert wird, kann man als Grundlage den Standard Detail View nutzen.
          </p>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views.generic</span><span class="w"> </span><span class="kn">import</span> <span class="n">DetailView</span>
<span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           Dieser vererbt seine Struktur an den neuen Export View. F&uuml;r ein konformes XPlan-GML sind einige Vorarbeiten n&ouml;tig. Wir brauchen die Geometrien
f&uuml;r den r&auml;umlichen Geltungsbereich im EPSG:25832 und im Format GML3. Das kann man relativ einfach mit einer Erweiterung
des querysets mit einer annotation l&ouml;sen. Zus&auml;tzlich zu den Polygonen brauchen wir noch den Extent der Geometrien. Dieser l&auml;&szlig;t sich aktuell nicht &uuml;ber eine annotation abfragen, sondern muss zur Laufzeit berechnet werden. Dazu nutzen wir die &uuml;ber Geodjango zur Verf&uuml;gung stehende GDAL Implementierung. Da wir auch das GML3 noch &auml;ndern m&uuml;ssen (Erg&auml;nzungen von gml_id Attributen), brauchen wir noch die etree-Bibliothek zum Parsen und Schreiben von XML.
          </p>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.db.models.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsGML</span><span class="p">,</span> <span class="n">Transform</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.gdal</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoordTransform</span><span class="p">,</span> <span class="n">SpatialReference</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.gdal</span><span class="w"> </span><span class="kn">import</span> <span class="n">OGRGeometry</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xml.etree.ElementTree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ET</span>
<span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanDetailXmlRasterView</span><span class="p">(</span><span class="n">BPlanDetailView</span><span class="p">):</span>  

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Erweiterung der auszulesenden Objekte um eine transformierte Geomtrie im Format GML 3</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">geltungsbereich_gml_25832</span><span class="o">=</span><span class="n">AsGML</span><span class="p">(</span><span class="n">Transform</span><span class="p">(</span><span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="mi">25832</span><span class="p">),</span> <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">queryset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Um einen XPlanung-konformen Auszug zu bekommen, werden gml_id(s) verwendet.</span>
        <span class="c1"># Es handelt sich um uuids, die noch das Prefix "GML_" bekommen. Grunds&auml;tzlich sollten die </span>
        <span class="c1"># aus den Daten in der DB stammen und dort vergeben werden. </span>
        <span class="c1"># Im ersten Schritt synthetisieren wir sie einfach ;-)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'auszug_uuid'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'bplan_uuid'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="c1"># Irgendwie gibt es keine django model function um direkt den Extent der Geometrie zu erhalten. Daher nutzen wir hier gdal</span>
        <span class="c1"># und Transformieren die Daten erneut im RAM</span>
        <span class="c1"># Definition der Transformation (Daten sind immer in WGS 84 - 4326)</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">CoordTransform</span><span class="p">(</span><span class="n">SpatialReference</span><span class="p">(</span><span class="mi">4326</span><span class="p">,</span> <span class="n">srs_type</span><span class="o">=</span><span class="s1">'epsg'</span><span class="p">),</span> <span class="n">SpatialReference</span><span class="p">(</span><span class="mi">25832</span><span class="p">,</span> <span class="n">srs_type</span><span class="o">=</span><span class="s1">'epsg'</span><span class="p">))</span>
        <span class="c1"># OGRGeoemtry Objekt erstellen</span>
        <span class="n">ogr_geom</span> <span class="o">=</span> <span class="n">OGRGeometry</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">'bplan'</span><span class="p">]</span><span class="o">.</span><span class="n">geltungsbereich</span><span class="p">),</span> <span class="n">srs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
        <span class="c1"># Transformation nach EPSG:25832</span>
        <span class="n">ogr_geom</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
        <span class="c1"># Speichern des Extents in den Context</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'extent'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ogr_geom</span><span class="o">.</span><span class="n">extent</span>
        <span class="c1"># Ausgabe der GML Variante zu Testzwecken </span>
        <span class="c1"># print(context['bplan'].geltungsbereich_gml_25832)</span>
        <span class="c1"># Da die GML Daten nicht alle Attribute beinhalten, die XPlanung fordert, m&uuml;ssen wir sie anpassen, bzw. umschreiben</span>
        <span class="c1"># Hierzu nutzen wir etree</span>
        <span class="n">ET</span><span class="o">.</span><span class="n">register_namespace</span><span class="p">(</span><span class="s1">'gml'</span><span class="p">,</span><span class="s1">'http://www.opengis.net/gml/3.2'</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">"&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;snippet xmlns:gml='http://www.opengis.net/gml/3.2'&gt;"</span> <span class="o">+</span> <span class="n">context</span><span class="p">[</span><span class="s1">'bplan'</span><span class="p">]</span><span class="o">.</span><span class="n">geltungsbereich_gml_25832</span> <span class="o">+</span> <span class="s2">"&lt;/snippet&gt;"</span><span class="p">)</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'gml'</span><span class="p">:</span> <span class="s1">'http://www.opengis.net/gml/3.2'</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># print("&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;snippet xmlns:gml='http://www.opengis.net/gml/3.2'&gt;" + context['bplan'].geltungsbereich_gml_25832 + "&lt;/snippet&gt;")</span>
        <span class="c1"># Test ob ein Polygon zur&uuml;ck kommt - damit w&auml;re nur ein einziges Polygon im geometry Field</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">'gml:Polygon'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
        <span class="c1"># print(len(polygons))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print("Kein Polygon auf oberer Ebene gefunden - es sind wahrscheinlich mehrere!")</span>
            <span class="n">multi_polygon_element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'gml:MultiSurface'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
            <span class="n">uuid_multisurface</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
            <span class="n">multi_polygon_element</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"gml:id"</span><span class="p">,</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_multisurface</span><span class="p">))</span>
            <span class="c1"># F&uuml;ge gml_id Attribute hinzu - besser diese als Hash aus den Geometrien zu rechnen, oder in Zukunft generic_ids der Bereiche zu verwenden </span>
            <span class="n">polygons</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">'gml:MultiSurface/gml:surfaceMember/gml:Polygon'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
                <span class="n">uuid_polygon</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
                <span class="n">polygon</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"gml:id"</span><span class="p">,</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_polygon</span><span class="p">))</span>
            <span class="n">context</span><span class="p">[</span><span class="s1">'multisurface_geometry_25832'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">multi_polygon_element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"xml"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">polygon_element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'gml:Polygon'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
            <span class="c1">#polygon_element.set("xmlns:gml", "http://www.opengis.net/gml/3.2")   </span>
            <span class="n">uuid_polygon</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
            <span class="n">polygon_element</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"gml:id"</span><span class="p">,</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_polygon</span><span class="p">))</span>
            <span class="c1"># Ausgabe der Geometrie in ein XML-Snippet - erweitert um den MultiSurface/surfaceMember Rahmen</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">polygon_element</span><span class="p">)</span> 
            <span class="n">context</span><span class="p">[</span><span class="s1">'multisurface_geometry_25832'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'&lt;gml:MultiSurface srsName="EPSG:25832"&gt;&lt;gml:surfaceMember&gt;'</span> <span class="o">+</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">polygon_element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"xml"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'&lt;/gml:surfaceMember&gt;&lt;/gml:MultiSurface&gt;'</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="w">    </span><span class="sd">""""</span>
<span class="sd">    def get_object(self):</span>
<span class="sd">        single_object = super().get_object(self.get_queryset())</span>
<span class="sd">        # print(single_object.geltungsbereich)</span>
<span class="sd">        # print(single_object.geltungsbereich_gml_25832)</span>
<span class="sd">        return single_object</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">'Content-type'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"application/xml"</span>  <span class="c1"># set header</span>
        <span class="k">return</span> <span class="n">response</span>
</pre>
           </div>
          </div>
         </section>
         <section id="url-fur-export">
          <h3>
           URL f&uuml;r Export
           <a class="headerlink" href="#url-fur-export" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Um die Export Funktion nutzen zu k&ouml;nnen, brauchen wir noch einen neuen Endpunkt.
          </p>
          <p>
           xplanung_light/urls.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlanCreateView</span><span class="p">,</span> <span class="n">BPlanUpdateView</span><span class="p">,</span> <span class="n">BPlanDeleteView</span><span class="p">,</span> <span class="n">BPlanListView</span><span class="p">,</span> <span class="n">BPlanDetailXmlRasterView</span>
<span class="c1">#...</span>
 <span class="c1"># export xplanung gml</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/&lt;int:pk&gt;/xplan/"</span><span class="p">,</span> <span class="n">BPlanDetailXmlRasterView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s2">"xplanung_light/bplan_template_xplanung_raster_6.xml"</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-export-xplan-raster-6"</span><span class="p">),</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="link-in-table-view">
          <h3>
           Link in Table View
           <a class="headerlink" href="#link-in-table-view" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Den Link auf den Endpunkt &uuml;bernehmen wir in die Bebauungsplantabelle
          </p>
          <p>
           xplanung_light/tables.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
    <span class="c1">#download = tables.LinkColumn('gedis-document-pdf', text='Download', args=[A('pk')], \</span>
    <span class="c1">#                     orderable=False, empty_values=())</span>
    <span class="n">xplan_gml</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-export-xplan-raster-6'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'Exportieren'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">edit</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-update'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'Bearbeiten'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">delete</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-delete'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'L&ouml;schen'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    geojson = Column(</span>
<span class="sd">        accessor=A('geojson'),</span>
<span class="sd">        orderable=False,</span>
<span class="sd">        # ...</span>
<span class="sd">    )</span>
<span class="sd">    """</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s2">"django_tables2/bootstrap5.html"</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">,</span> <span class="s2">"xplan_gml"</span><span class="p">,</span> <span class="s2">"edit"</span><span class="p">,</span> <span class="s2">"delete"</span><span class="p">)</span>
</pre>
           </div>
          </div>
         </section>
         <section id="xml-template">
          <h3>
           XML Template
           <a class="headerlink" href="#xml-template" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Fehlt nur noch das Template ;-)
          </p>
          <p>
           komserv2/xplanung_light/templates/xplanung_light/bplan_template_xplanung_raster_6.xml
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;</span>
<span class="x">&lt;xplan:XPlanAuszug xmlns:xplan="http://www.xplanung.de/xplangml/6/0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.xplanung.de/xplangml/6/0 http://repository.gdi-de.org/schemas/de.xleitstelle.xplanung/6.0/XPlanung-Operationen.xsd" gml:id="</span><span class="cp">{{</span> <span class="nv">auszug_uuid</span> <span class="cp">}}</span><span class="x">"&gt;</span>
<span class="x">  &lt;gml:boundedBy&gt;</span>
<span class="x">    &lt;gml:Envelope srsName="EPSG:25832"&gt;</span>
<span class="x">      &lt;gml:lowerCorner&gt;567015.8040 5937951.7580&lt;/gml:lowerCorner&gt;</span>
<span class="x">      &lt;gml:upperCorner&gt;567582.8240 5938562.2710&lt;/gml:upperCorner&gt;</span>
<span class="x">    &lt;/gml:Envelope&gt;</span>
<span class="x">  &lt;/gml:boundedBy&gt;</span>
<span class="x">  &lt;gml:featureMember&gt;</span>
<span class="x">    &lt;xplan:BP_Plan gml:id="</span><span class="cp">{{</span> <span class="nv">bplan_uuid</span> <span class="cp">}}</span><span class="x">"&gt;</span>
<span class="x">      &lt;gml:boundedBy&gt;</span>
<span class="x">        &lt;gml:Envelope srsName="EPSG:25832"&gt;</span>
<span class="x">          &lt;gml:lowerCorner&gt;</span><span class="cp">{{</span> <span class="nv">extent.0</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">extent.1</span> <span class="cp">}}</span><span class="x">&lt;/gml:lowerCorner&gt;</span>
<span class="x">          &lt;gml:upperCorner&gt;</span><span class="cp">{{</span> <span class="nv">extent.2</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">extent.3</span> <span class="cp">}}</span><span class="x">&lt;/gml:upperCorner&gt;</span>
<span class="x">        &lt;/gml:Envelope&gt;</span>
<span class="x">      &lt;/gml:boundedBy&gt;</span>
<span class="x">      &lt;xplan:name&gt;</span><span class="cp">{{</span> <span class="nv">bplan.name</span> <span class="cp">}}</span><span class="x">&lt;/xplan:name&gt;</span>
<span class="x">      &lt;xplan:erstellungsMassstab&gt;1000&lt;/xplan:erstellungsMassstab&gt;</span>
<span class="x">      &lt;xplan:raeumlicherGeltungsbereich&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">autoescape</span> <span class="nv">off</span> <span class="cp">%}</span>
<span class="x">            </span><span class="cp">{{</span> <span class="nv">multisurface_geometry_25832</span> <span class="cp">}}</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span>
<span class="x">      &lt;/xplan:raeumlicherGeltungsbereich&gt;</span>
<span class="x">      &lt;xplan:gemeinde&gt;</span>
<span class="x">        &lt;xplan:XP_Gemeinde&gt;</span>
<span class="x">          &lt;xplan:ags&gt;</span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.ls</span> <span class="cp">}}{{</span> <span class="nv">bplan.gemeinde.ks</span> <span class="cp">}}{{</span> <span class="nv">bplan.gemeinde.vs</span> <span class="cp">}}{{</span> <span class="nv">bplan.gemeinde.gs</span> <span class="cp">}}</span><span class="x">&lt;/xplan:ags&gt;</span>
<span class="x">          &lt;xplan:gemeindeName&gt;</span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.name</span> <span class="cp">}}</span><span class="x">&lt;/xplan:gemeindeName&gt;</span>
<span class="x">        &lt;/xplan:XP_Gemeinde&gt;</span>
<span class="x">      &lt;/xplan:gemeinde&gt;</span>
<span class="x">      &lt;xplan:planArt&gt;</span><span class="cp">{{</span> <span class="nv">bplan.planart</span> <span class="cp">}}</span><span class="x">&lt;/xplan:planArt&gt;</span>
<span class="x">      &lt;xplan:staedtebaulicherVertrag&gt;false&lt;/xplan:staedtebaulicherVertrag&gt;</span>
<span class="x">      &lt;xplan:erschliessungsVertrag&gt;false&lt;/xplan:erschliessungsVertrag&gt;</span>
<span class="x">      &lt;xplan:durchfuehrungsVertrag&gt;false&lt;/xplan:durchfuehrungsVertrag&gt;</span>
<span class="x">      &lt;xplan:gruenordnungsplan&gt;false&lt;/xplan:gruenordnungsplan&gt;</span>
<span class="x">    &lt;/xplan:BP_Plan&gt;</span>
<span class="x">  &lt;/gml:featureMember&gt;</span>
<span class="x">&lt;/xplan:XPlanAuszug&gt;</span>
</pre>
           </div>
          </div>
         </section>
         <section id="neue-spalte-fur-export-in-tabelle">
          <h3>
           Neue Spalte f&uuml;r Export in Tabelle
           <a class="headerlink" href="#neue-spalte-fur-export-in-tabelle" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/bplan/">
            http://127.0.0.1:8000/bplan/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/bplan_list_tables2_xml_export.png">
           <img alt="Neue Spalte f&uuml;r Export in Tabelle" class="bg-primary align-center" src="_images/bplan_list_tables2_xml_export.png" style="width: 800px;"/>
          </a>
         </section>
         <section id="xml-export">
          <h3>
           XML Export
           <a class="headerlink" href="#xml-export" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/bplan/1/xplan/">
            http://127.0.0.1:8000/bplan/1/xplan/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/xplan_export_1.png">
           <img alt="XML Export" class="bg-primary align-center" src="_images/xplan_export_1.png" style="width: 800px;"/>
          </a>
         </section>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-map_view">
        </span>
        <section id="kartenansicht">
         <h2>
          Kartenansicht
          <a class="headerlink" href="#kartenansicht" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="konfiguration">
          <h3>
           Konfiguration
           <a class="headerlink" href="#konfiguration" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Bei der Liste der Bebauungspl&auml;ne macht es Sinn sich die Lage der Pl&auml;ne auch auf einer dynamischen &Uuml;bersichtskarte anzeigen zu lassen. Hierzu kann django-leaflet genutzt werden.
Im ersten Schritt muss man aber die Geodaten mit in den View &uuml;bernehmen. Theoretisch w&auml;re es ausreichend das Geometrie Feld
           <strong>
            geltungsbereich
           </strong>
           zu nutzen. Wenn man aber etwas Interaktion haben will, z.B. eine Selektierbarkeit einzelner Objekte im Viewer, dann ist es besser, ein gesamtes Geometrieobjekt mit ausgew&auml;hlten Attributen zu verwenden.
Hierzu &uuml;berschreiben wir den die get_context_data Funktion der ListView um eine Serialisierung der Geoemtrien der aktuellen Seite und nennen sie
           <strong>
            markers
           </strong>
          </p>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.core.serializers</span><span class="w"> </span><span class="kn">import</span> <span class="n">serialize</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="c1"># ...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanListView</span><span class="p">(</span><span class="n">SingleTableView</span><span class="p">):</span>
<span class="c1"># ...</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">"markers"</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
            <span class="n">serialize</span><span class="p">(</span><span class="s2">"geojson"</span><span class="p">,</span> <span class="n">context</span><span class="p">[</span><span class="s1">'table'</span><span class="p">]</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">object_list</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">geometry_field</span><span class="o">=</span><span class="s1">'geltungsbereich'</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">context</span>
</pre>
           </div>
          </div>
          <p>
           komserv2/settings.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1"># ...</span>
<span class="n">SERIALIZATION_MODULES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"geojson"</span><span class="p">:</span> <span class="s2">"django.contrib.gis.serializers.geojson"</span><span class="p">,</span> 
<span class="p">}</span>
<span class="c1"># ...</span>
</pre>
           </div>
          </div>
          <p>
           Die Marker wollen wir in einem LeafletViewer darstellen. Hierzu m&uuml;ssen wir das Template bearbeiten. Aber zun&auml;chst brauchen wir noch die js-lib
           <strong>
            turf
           </strong>
           , die geometrische Operationen zur Verf&uuml;gung stellt.
          </p>
          <p>
           komserv/xplanung_light/templates/layout.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;!-- ... --&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">  &lt;!-- ... --&gt;</span>
<span class="x">  &lt;script src="https://cdn.jsdelivr.net/npm/@turf/turf@7/turf.min.js"&gt;&lt;/script&gt;</span>
<span class="x">  &lt;!-- ... --&gt;</span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;!-- ... --&gt;</span>
</pre>
           </div>
          </div>
          <p>
           komserv/xplanung_light/templates/xplanung_light/bplan_list.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">leaflet_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Liste der Bebauungspl&auml;ne</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">render_table</span> <span class="nv">from</span> <span class="nv">django_tables2</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="cp">{{</span> <span class="nv">markers</span><span class="o">|</span><span class="nf">json_script</span><span class="s2">:"markers-data"</span> <span class="cp">}}</span>
<span class="x">&lt;script&gt;</span>
<span class="x">&lt;!-- javascript-Part - siehe n&auml;chster Abschnitt --&gt;</span>
<span class="x">&lt;/script&gt;</span>
<span class="cp">{%</span> <span class="k">leaflet_map</span> <span class="s2">"bplan_list_map"</span> <span class="nv">callback</span><span class="o">=</span><span class="s2">"window.map_init_basic"</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;&lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-create'</span> <span class="cp">%}</span><span class="x">"&gt;BPlan anlegen&lt;/a&gt;&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">render_table</span> <span class="nv">table</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Anzahl: </span><span class="cp">{{</span> <span class="nv">object_list.count</span> <span class="cp">}}</span><span class="x">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
           </div>
          </div>
          <p>
           In dem Javascript f&uuml;r den Leaflet-Client steckt jetzt etwas mehr Logik.
          </p>
          <ul class="simple">
           <li>
            <p>
             Die marker werden in die das HTML-Element mit der id
             <strong>
              markers-data
             </strong>
             &uuml;betragen
            </p>
           </li>
           <li>
            <p>
             Leaflet parsed das Json und baut daraus features
            </p>
           </li>
           <li>
            <p>
             Die Features werden anhand von Attributen unterschiedlich gef&auml;rbt
            </p>
           </li>
           <li>
            <p>
             Es gibt ein click-Event, dass die Polygone abfragt und ein PopUp erzeugt
            </p>
           </li>
          </ul>
          <p>
           Javascript im Script-Tag des templates
komserv/xplanung_light/templates/xplanung_light/bplan_list.html
          </p>
          <div class="highlight-javascript notranslate">
           <div class="highlight">
            <pre><span></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">mapGlobal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">map_init_basic</span><span class="w"> </span><span class="p">(</span><span class="nx">map</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">mapGlobal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">map</span><span class="p">;</span>
<span class="w">        </span><span class="c1">//https://stackoverflow.com/questions/43007019/leaflet-event-how-to-propagate-to-overlapping-layers</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"markers-data"</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">markers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span>
<span class="w">        </span><span class="nx">map</span><span class="p">.</span><span class="nx">setZoom</span><span class="p">(</span><span class="mf">14</span><span class="p">);</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">feature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">L</span><span class="p">.</span><span class="nx">geoJSON</span><span class="p">(</span><span class="nx">markers</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">style</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">feature</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">planart</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">case</span><span class="w"> </span><span class="s1">'1000'</span><span class="o">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">"#ff0000"</span><span class="p">};</span>
<span class="w">                        </span><span class="k">case</span><span class="w"> </span><span class="s1">'10000'</span><span class="o">:</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="s2">"#0000ff"</span><span class="p">};</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span><span class="c1">//,</span>
<span class="w">                </span><span class="c1">//onEachFeature: onEachFeature</span>
<span class="w">                </span><span class="c1">//zoomToBounds: zoomToBounds</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">            </span><span class="cm">/*.bindPopup(function (layer) {</span>
<span class="cm">                return layer</span>
<span class="cm">                    .feature.properties.generic_id;</span>
<span class="cm">            })*/</span>
<span class="w">        </span><span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span><span class="w">       </span>
<span class="w">        </span><span class="nx">map</span><span class="p">.</span><span class="nx">fitBounds</span><span class="p">(</span><span class="nx">feature</span><span class="p">.</span><span class="nx">getBounds</span><span class="p">());</span>
<span class="w">        </span><span class="cm">/*</span>
<span class="cm">        map.on('moveend', function() { </span>
<span class="cm">            const bbox_field = document.getElementById("id_bbox");</span>
<span class="cm">            //bbox_field.value = "test";</span>
<span class="cm">            //alert(JSON.stringify(map.getBounds()));</span>
<span class="cm">            const bounds = map.getBounds();</span>
<span class="cm">            bbox_field.value = bounds._southWest.lng + "," + bounds._southWest.lat + "," + bounds._northEast.lng + "," + bounds._northEast.lat;</span>
<span class="cm">       });</span>
<span class="cm">       */</span>
<span class="w">       </span><span class="cm">/*function onEachFeature(feature, layer) {</span>
<span class="cm">            layer.on({</span>
<span class="cm">                click: zoomToFeature</span>
<span class="cm">            });</span>
<span class="cm">            //featureByName[feature.properties.name] = layer;</span>
<span class="cm">        }*/</span>
<span class="w">        </span><span class="cm">/*</span>
<span class="cm">        function zoomToBounds(bounds) {</span>
<span class="cm">            alert(JSON.stringify(bounds));</span>
<span class="cm">            //featureByName[feature.properties.name] = layer;</span>
<span class="cm">        }</span>
<span class="cm">        */</span>
<span class="w">        </span><span class="cm">/*</span>
<span class="cm">        function zoomToFeature(e) {</span>
<span class="cm">            map.fitBounds(e.target.getBounds());</span>
<span class="cm">        }</span>
<span class="cm">        */</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">popup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">L</span><span class="p">.</span><span class="nx">popup</span><span class="p">()</span>
<span class="w">        </span><span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//var thisMap = map;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">lat</span><span class="p">,</span><span class="w"> </span><span class="nx">lng</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">latlng</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">turf</span><span class="p">.</span><span class="nx">point</span><span class="p">([</span><span class="nx">lng</span><span class="p">,</span><span class="w"> </span><span class="nx">lat</span><span class="p">]);</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">            </span><span class="c1">//console.log(map._layers)</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">map</span><span class="p">.</span><span class="nx">_layers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">const</span><span class="w"> </span><span class="nx">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">map</span><span class="p">.</span><span class="nx">_layers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">layer</span><span class="p">.</span><span class="nx">feature</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s2">"undefined"</span><span class="p">){</span>
<span class="w">                    </span><span class="c1">//map._layers.forEach((p, i) =&gt; {</span>
<span class="w">                    </span><span class="c1">//const polygon= p.toGeoJSON();</span>
<span class="w">                    </span><span class="kd">const</span><span class="w"> </span><span class="nx">polygon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">layer</span><span class="p">.</span><span class="nx">feature</span><span class="p">;</span>
<span class="w">                    </span><span class="c1">//console.log(polygon)</span>
<span class="w">                    </span><span class="c1">//console.log(point)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">turf</span><span class="p">.</span><span class="nx">booleanPointInPolygon</span><span class="p">(</span><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">polygon</span><span class="p">))</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">layer</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">polygonsClicked</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">popupContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Dokument(e):&lt;br&gt;"</span><span class="p">;</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">//console.log(polygonsClicked[id]);</span>
<span class="w">                    </span><span class="nx">bounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">getBounds</span><span class="p">();</span>
<span class="w">                    </span><span class="c1">//console.log(bounds);</span>
<span class="w">                    </span><span class="nx">popupContent</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">"&lt;a onclick='mapGlobal.fitBounds([["</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bounds</span><span class="p">.</span><span class="nx">_southWest</span><span class="p">.</span><span class="nx">lat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">", "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bounds</span><span class="p">.</span><span class="nx">_southWest</span><span class="p">.</span><span class="nx">lng</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"], ["</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bounds</span><span class="p">.</span><span class="nx">_northEast</span><span class="p">.</span><span class="nx">lat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">", "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">bounds</span><span class="p">.</span><span class="nx">_northEast</span><span class="p">.</span><span class="nx">lng</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"]]);'&gt;+&lt;/a&gt; "</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">popupContent</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">"&lt;b&gt;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">title</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"&lt;/b&gt; ("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">date_of_document</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">") - "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">description</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="s1">'&lt;br&gt;'</span><span class="p">;</span>
<span class="w">                    </span><span class="nx">popupContent</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">"&lt;a href='../"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">pk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"/pdf/' target='_blank'&gt;Download: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">pk</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">" ("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">polygonsClicked</span><span class="p">[</span><span class="nx">id</span><span class="p">].</span><span class="nx">feature</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">document_class</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"&lt;/a&gt;&lt;br&gt;"</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="nx">popup</span>
<span class="w">                    </span><span class="p">.</span><span class="nx">setLatLng</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">latlng</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">popupContent</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="nx">openOn</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="cm">/*</span>
<span class="cm">                popup</span>
<span class="cm">                .setLatLng(e.latlng)</span>
<span class="cm">                .setContent("You clicked the map at " + e.latlng.toString())</span>
<span class="cm">                .openOn(map);</span>
<span class="cm">                */</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
</pre>
           </div>
          </div>
          <p>
           Anpassung der H&ouml;he im css-File
          </p>
          <p>
           komserv/xplanung_light/static/xplanung_light/site.css
          </p>
          <div class="highlight-css notranslate">
           <div class="highlight">
            <pre><span></span><span class="p">#</span><span class="nn">bplan_list_map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">180</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</pre>
           </div>
          </div>
         </section>
         <section id="kartenanzeige-im-client">
          <h3>
           Kartenanzeige im Client
           <a class="headerlink" href="#kartenanzeige-im-client" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/bplan/">
            http://127.0.0.1:8000/bplan/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/bplan_list_leaflet.png">
           <img alt="Kartenanzeige im Client" class="bg-primary align-center" src="_images/bplan_list_leaflet.png" style="width: 800px;"/>
          </a>
         </section>
        </section>
        <section id="suche">
         <h2>
          Suche
          <a class="headerlink" href="#suche" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="installation-django-filter">
          <h3>
           Installation django-filter
           <a class="headerlink" href="#installation-django-filter" title="Permalink to this heading">
            
           </a>
          </h3>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">django</span><span class="o">-</span><span class="nb">filter</span>
</pre>
           </div>
          </div>
          <p>
           komserv/settings.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1"># ...</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">'django_filters'</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
<span class="c1"># ...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="erstellen-einer-filter-klasse">
          <h3>
           Erstellen einer Filter Klasse
           <a class="headerlink" href="#erstellen-einer-filter-klasse" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           komserv/xplanung_light/filter.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django_filters</span><span class="w"> </span><span class="kn">import</span> <span class="n">FilterSet</span><span class="p">,</span> <span class="n">CharFilter</span><span class="p">,</span> <span class="n">ModelChoiceFilter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlan</span><span class="p">,</span> <span class="n">AdministrativeOrganization</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.geos</span><span class="w"> </span><span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Q</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bbox_filter</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="c1">#print("value from bbox_filter: " + value)</span>
    <span class="c1"># extract bbox from cs numerical values</span>
    <span class="n">geom</span> <span class="o">=</span> <span class="n">Polygon</span><span class="o">.</span><span class="n">from_bbox</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">))</span>
    <span class="c1">#print(geom)</span>
    <span class="c1"># 7.51461,50.31417,7.51563,50.31544</span>
    <span class="k">return</span> <span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">geltungsbereich__bboverlaps</span><span class="o">=</span><span class="n">geom</span><span class="p">)</span>


<span class="c1"># https://stackoverflow.com/questions/68592837/custom-filter-with-django-filters</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanFilter</span><span class="p">(</span><span class="n">FilterSet</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">CharFilter</span><span class="p">(</span><span class="n">lookup_expr</span><span class="o">=</span><span class="s1">'icontains'</span><span class="p">)</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">CharFilter</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'bbox_filter'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'BBOX'</span><span class="p">)</span>
    <span class="n">gemeinde</span> <span class="o">=</span> <span class="n">ModelChoiceFilter</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">AdministrativeOrganization</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s2">"pk"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">))</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">,</span> <span class="s2">"bbox"</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">bbox_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queryset</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1">#print("name from DocumentFilter.bbox_filter: " + name)</span>
        <span class="k">return</span> <span class="n">bbox_filter</span><span class="p">(</span><span class="n">queryset</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre>
           </div>
          </div>
         </section>
         <section id="anpassen-des-views">
          <h3>
           Anpassen des Views
           <a class="headerlink" href="#anpassen-des-views" title="Permalink to this heading">
            
           </a>
          </h3>
          <ul class="simple">
           <li>
            <p>
             Import der Klassen
            </p>
           </li>
           <li>
            <p>
             Erben von FilterView
            </p>
           </li>
           <li>
            <p>
             neues Attribut filterset_class
            </p>
           </li>
           <li>
            <p>
             fixe Definition des templates - sonst sucht django nach bplan_filter.html - und das existiert nicht
            </p>
           </li>
           <li>
            <p>
             &Uuml;berschreiben von
             <strong>
              get_queryset
             </strong>
            </p>
           </li>
          </ul>
          <p>
           komserv/xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.filter</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlanFilter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_filters.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">FilterView</span>
<span class="c1"># ...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanListView</span><span class="p">(</span><span class="n">FilterView</span><span class="p">,</span> <span class="n">SingleTableView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">table_class</span> <span class="o">=</span> <span class="n">BPlanTable</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'xplanung_light/bplan_list.html'</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 
    <span class="n">filterset_class</span> <span class="o">=</span> <span class="n">BPlanFilter</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">"markers"</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
            <span class="n">serialize</span><span class="p">(</span><span class="s2">"geojson"</span><span class="p">,</span> <span class="n">context</span><span class="p">[</span><span class="s1">'table'</span><span class="p">]</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">object_list</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">geometry_field</span><span class="o">=</span><span class="s1">'geltungsbereich'</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span> <span class="o">=</span> <span class="n">BPlanFilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="o">.</span><span class="n">qs</span>
<span class="c1"># ...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="konfiguration-der-filterfunktionen-im-template">
          <h3>
           Konfiguration der Filterfunktionen im template
           <a class="headerlink" href="#konfiguration-der-filterfunktionen-im-template" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           templates/xplanung_light/bplan_list.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;!-- ... --&gt;</span>
<span class="cp">{%</span> <span class="k">leaflet_map</span> <span class="s2">"bplan_list_map"</span> <span class="nv">callback</span><span class="o">=</span><span class="s2">"window.map_init_basic"</span> <span class="cp">%}</span>
<span class="x">Filter</span>
<span class="x">&lt;!-- add boostrap form css - if wished --&gt;</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">django_bootstrap5</span> <span class="cp">%}</span>
<span class="x">&lt;form method="get" action=""&gt;</span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">filter.form.as_p</span> <span class="cp">}}</span>
<span class="x">    &lt;input type="submit" /&gt;&lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-list'</span> <span class="cp">%}</span><span class="x">"&gt;Filter l&ouml;schen&lt;/a&gt;.&lt;/p&gt;</span>
<span class="x">&lt;/form&gt;</span>
<span class="x">&lt;p&gt;&lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-create'</span> <span class="cp">%}</span><span class="x">"&gt;BPlan anlegen&lt;/a&gt;&lt;/p&gt;</span>
<span class="x">&lt;!-- ... --&gt;</span>
</pre>
           </div>
          </div>
         </section>
         <section id="darstellung-der-filter">
          <h3>
           Darstellung der Filter
           <a class="headerlink" href="#darstellung-der-filter" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/bplan/">
            http://127.0.0.1:8000/bplan/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/bplan_list_filter.png">
           <img alt="Darstellung der Filter" class="bg-primary align-center" src="_images/bplan_list_filter.png" style="width: 800px;"/>
          </a>
         </section>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-result">
        </span>
        <section id="zusammenfassung">
         <h2>
          Zusammenfassung
          <a class="headerlink" href="#zusammenfassung" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Wir haben innerhalb k&uuml;rzester Zeit eine sehr einfache Verwaltungssoftware f&uuml;r Bebauungspl&auml;ne erstellt.
Die exportierbaren GML-Dateien lassen sich mit Hilfe des Validators pr&uuml;fen und sind valide.
Einen praktischen Nutzwert hat die Software in diesem Stadium aber noch nicht.
         </p>
         <a class="bg-primary reference internal image-reference" href="_images/bplan_list_1.png">
          <img alt="Liste der Bebauungspl&auml;ne" class="bg-primary align-center" src="_images/bplan_list_1.png" style="width: 800px;"/>
         </a>
        </section>
        <section id="metadatenexport">
         <h2>
          Metadatenexport
          <a class="headerlink" href="#metadatenexport" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Um zeigen zu k&ouml;nnen, wie schnell man das System anpassen kann, werden wir schnell noch ISO19193-konforme Metadaten generieren.
         </p>
         <section id="neuer-endpunkt">
          <h3>
           Neuer Endpunkt
           <a class="headerlink" href="#neuer-endpunkt" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Den View f&uuml;r XPlan GML k&ouml;nnen wir einfach beibehalten und sp&auml;ter etwas anpassen ;-)
          </p>
          <p>
           komserv2/xplanung_light/urls.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ... </span>
    <span class="c1"># iso metadata generator for each bplan</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/&lt;int:pk&gt;/iso19139/"</span><span class="p">,</span> <span class="n">BPlanDetailXmlRasterView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s2">"xplanung_light/bplan_template_iso19139.xml"</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-export-iso19139"</span><span class="p">),</span>
<span class="p">]</span>
</pre>
           </div>
          </div>
         </section>
         <section id="anpassung-des-views">
          <h3>
           Anpassung des Views
           <a class="headerlink" href="#anpassung-des-views" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Wir brauchen die Geometrien jetzt auch im EPSG:4326 - dazu schreiben wir auch eine kleine Funktion zum Qualifizieren des GMLs aus der DB.
          </p>
          <p>
           komserv2/xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse_lazy</span><span class="p">,</span> <span class="n">reverse</span>
<span class="c1"># ...</span>
<span class="k">def</span><span class="w"> </span><span class="nf">qualify_gml_geometry</span><span class="p">(</span><span class="n">gml_from_db</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="n">ET</span><span class="o">.</span><span class="n">register_namespace</span><span class="p">(</span><span class="s1">'gml'</span><span class="p">,</span><span class="s1">'http://www.opengis.net/gml/3.2'</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">"&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;snippet xmlns:gml='http://www.opengis.net/gml/3.2'&gt;"</span> <span class="o">+</span> <span class="n">gml_from_db</span> <span class="o">+</span> <span class="s2">"&lt;/snippet&gt;"</span><span class="p">)</span>
    <span class="n">ns</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'gml'</span><span class="p">:</span> <span class="s1">'http://www.opengis.net/gml/3.2'</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># print("&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;snippet xmlns:gml='http://www.opengis.net/gml/3.2'&gt;" + context['bplan'].geltungsbereich_gml_25832 + "&lt;/snippet&gt;")</span>
    <span class="c1"># Test ob ein Polygon zur&uuml;ck kommt - damit w&auml;re nur ein einziges Polygon im geometry Field</span>
    <span class="n">polygons</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">'gml:Polygon'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
    <span class="c1"># print(len(polygons))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># print("Kein Polygon auf oberer Ebene gefunden - es sind wahrscheinlich mehrere!")</span>
        <span class="n">multi_polygon_element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'gml:MultiSurface'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
        <span class="n">uuid_multisurface</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
        <span class="n">multi_polygon_element</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"gml:id"</span><span class="p">,</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_multisurface</span><span class="p">))</span>
        <span class="c1"># F&uuml;ge gml_id Attribute hinzu - besser diese als Hash aus den Geometrien zu rechnen, oder in Zukunft generic_ids der Bereiche zu verwenden </span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">'gml:MultiSurface/gml:surfaceMember/gml:Polygon'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
            <span class="n">uuid_polygon</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
            <span class="n">polygon</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"gml:id"</span><span class="p">,</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_polygon</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">multi_polygon_element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"xml"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">polygon_element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'gml:Polygon'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
        <span class="c1">#polygon_element.set("xmlns:gml", "http://www.opengis.net/gml/3.2")   </span>
        <span class="n">uuid_polygon</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
        <span class="n">polygon_element</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"gml:id"</span><span class="p">,</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_polygon</span><span class="p">))</span>
        <span class="c1"># Ausgabe der Geometrie in ein XML-Snippet - erweitert um den MultiSurface/surfaceMember Rahmen</span>
        <span class="n">ET</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">polygon_element</span><span class="p">)</span> 
        <span class="k">return</span> <span class="s1">'&lt;gml:MultiSurface srsName="EPSG:25832"&gt;&lt;gml:surfaceMember&gt;'</span> <span class="o">+</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">polygon_element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"xml"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'&lt;/gml:surfaceMember&gt;&lt;/gml:MultiSurface&gt;'</span>

<span class="c1"># ...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanDetailXmlRasterView</span><span class="p">(</span><span class="n">BPlanDetailView</span><span class="p">):</span>  

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Erweiterung der auszulesenden Objekte um eine transformierte Geomtrie im Format GML 3</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">geltungsbereich_gml_25832</span><span class="o">=</span><span class="n">AsGML</span><span class="p">(</span><span class="n">Transform</span><span class="p">(</span><span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="mi">25832</span><span class="p">),</span> <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">geltungsbereich_gml_4326</span><span class="o">=</span><span class="n">AsGML</span><span class="p">(</span><span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">queryset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Um einen XPlanung-konformen Auszug zu bekommen, werden gml_id(s) verwendet.</span>
        <span class="c1"># Es handelt sich um uuids, die noch das Prefix "GML_" bekommen. Grunds&auml;tzlich sollten die </span>
        <span class="c1"># aus den Daten in der DB stammen und dort vergeben werden. </span>
        <span class="c1"># Im ersten Schritt synthetisieren wir sie einfach ;-)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'auszug_uuid'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'bplan_uuid'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="c1"># Irgendwie gibt es keine django model function um direkt den Extent der Geometrie zu erhalten. Daher nutzen wir hier gdal</span>
        <span class="c1"># und Transformieren die Daten erneut im RAM</span>
        <span class="c1"># Definition der Transformation (Daten sind immer in WGS 84 - 4326)</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">CoordTransform</span><span class="p">(</span><span class="n">SpatialReference</span><span class="p">(</span><span class="mi">4326</span><span class="p">,</span> <span class="n">srs_type</span><span class="o">=</span><span class="s1">'epsg'</span><span class="p">),</span> <span class="n">SpatialReference</span><span class="p">(</span><span class="mi">25832</span><span class="p">,</span> <span class="n">srs_type</span><span class="o">=</span><span class="s1">'epsg'</span><span class="p">))</span>
        <span class="c1"># OGRGeoemtry Objekt erstellen</span>
        <span class="n">ogr_geom</span> <span class="o">=</span> <span class="n">OGRGeometry</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">'bplan'</span><span class="p">]</span><span class="o">.</span><span class="n">geltungsbereich</span><span class="p">),</span> <span class="n">srs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'wgs84_extent'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ogr_geom</span><span class="o">.</span><span class="n">extent</span>
        <span class="c1"># Transformation nach EPSG:25832</span>
        <span class="n">ogr_geom</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
        <span class="c1"># Speichern des Extents in den Context</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'extent'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ogr_geom</span><span class="o">.</span><span class="n">extent</span>
        <span class="c1"># Ausgabe der GML Variante zu Testzwecken </span>
        <span class="c1"># print(context['bplan'].geltungsbereich_gml_25832)</span>
        <span class="c1"># Da die GML Daten nicht alle Attribute beinhalten, die XPlanung fordert, m&uuml;ssen wir sie anpassen, bzw. umschreiben</span>
        <span class="c1"># Hierzu nutzen wir die Funktion qualify_gml_geometry</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'multisurface_geometry_25832'</span><span class="p">]</span> <span class="o">=</span> <span class="n">qualify_gml_geometry</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">'bplan'</span><span class="p">]</span><span class="o">.</span><span class="n">geltungsbereich_gml_25832</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'multisurface_geometry_4326'</span><span class="p">]</span> <span class="o">=</span> <span class="n">qualify_gml_geometry</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">'bplan'</span><span class="p">]</span><span class="o">.</span><span class="n">geltungsbereich_gml_4326</span><span class="p">)</span>

        <span class="n">relative_url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">'bplan-export-xplan-raster-6'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">'pk'</span><span class="p">:</span> <span class="n">context</span><span class="p">[</span><span class="s1">'bplan'</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'iso19139_url'</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">build_absolute_uri</span><span class="p">(</span><span class="n">relative_url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">'Content-type'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"application/xml"</span>  <span class="c1"># set header</span>
        <span class="k">return</span> <span class="n">response</span>
    <span class="c1"># ...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="erstellen-des-xml-templates">
          <h3>
           Erstellen des XML-Templates
           <a class="headerlink" href="#erstellen-des-xml-templates" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           komserv2/xplanung_light/templates/xplanung_light/bplan_template_iso19139.xml
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="x">&lt;gmd:MD_Metadata xmlns:gmd="http://www.isotc211.org/2005/gmd" xmlns:gmx="http://www.isotc211.org/2005/gmx" xmlns:gco="http://www.isotc211.org/2005/gco" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gml="http://www.opengis.net/gml" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.isotc211.org/2005/gmd http://schemas.opengis.net/iso/19139/20060504/gmd/gmd.xsd"&gt;</span>
<span class="x">  &lt;gmd:fileIdentifier&gt;</span>
<span class="x">    &lt;gco:CharacterString&gt;</span><span class="cp">{{</span> <span class="nv">bplan.generic_id</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">  &lt;/gmd:fileIdentifier&gt;</span>
<span class="x">  &lt;gmd:language&gt;</span>
<span class="x">    &lt;gmd:LanguageCode codeList="http://www.loc.gov/standards/iso639-2" codeListValue="ger"&gt;Deutsch&lt;/gmd:LanguageCode&gt;</span>
<span class="x">  &lt;/gmd:language&gt;</span>
<span class="x">  &lt;gmd:characterSet&gt;</span>
<span class="x">    &lt;gmd:MD_CharacterSetCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_CharacterSetCode" codeListValue="utf8"/&gt;</span>
<span class="x">  &lt;/gmd:characterSet&gt;</span>
<span class="x">  &lt;gmd:hierarchyLevel&gt;</span>
<span class="x">    &lt;gmd:MD_ScopeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_ScopeCode" codeListValue="dataset"&gt;dataset&lt;/gmd:MD_ScopeCode&gt;</span>
<span class="x">  &lt;/gmd:hierarchyLevel&gt;</span>
<span class="x">  &lt;gmd:contact&gt;</span>
<span class="x">    &lt;gmd:CI_ResponsibleParty&gt;</span>
<span class="x">      &lt;gmd:organisationName&gt;</span>
<span class="x">        &lt;gco:CharacterString&gt;</span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.name</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">      &lt;/gmd:organisationName&gt;</span>
<span class="x">      &lt;gmd:contactInfo&gt;</span>
<span class="x">        &lt;gmd:CI_Contact&gt;</span>
<span class="x">          &lt;gmd:address&gt;</span>
<span class="x">            &lt;gmd:CI_Address&gt;</span>
<span class="x">              &lt;gmd:administrativeArea&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;Rheinland-Pfalz&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:administrativeArea&gt;</span>
<span class="x">              &lt;gmd:country&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;DE&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:country&gt;</span>
<span class="x">              &lt;gmd:electronicMailAddress&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;</span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.address_email</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:electronicMailAddress&gt;</span>
<span class="x">            &lt;/gmd:CI_Address&gt;</span>
<span class="x">          &lt;/gmd:address&gt;</span>
<span class="x">        &lt;/gmd:CI_Contact&gt;</span>
<span class="x">      &lt;/gmd:contactInfo&gt;</span>
<span class="x">      &lt;gmd:role&gt;</span>
<span class="x">        &lt;gmd:CI_RoleCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#CI_RoleCode" codeListValue="pointOfContact"&gt;pointOfContact&lt;/gmd:CI_RoleCode&gt;</span>
<span class="x">      &lt;/gmd:role&gt;</span>
<span class="x">    &lt;/gmd:CI_ResponsibleParty&gt;</span>
<span class="x">  &lt;/gmd:contact&gt;</span>
<span class="x">  &lt;gmd:dateStamp&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">bplan.history.date</span> <span class="cp">%}</span>
<span class="x">    &lt;gco:Date&gt;</span><span class="cp">{{</span> <span class="nv">bplan.history.date</span> <span class="cp">}}</span><span class="x">&lt;/gco:Date&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">    &lt;gco:Date&gt;2025-05-07&lt;/gco:Date&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">  &lt;/gmd:dateStamp&gt;</span>
<span class="x">  &lt;gmd:metadataStandardName&gt;</span>
<span class="x">    &lt;gco:CharacterString&gt;ISO19115&lt;/gco:CharacterString&gt;</span>
<span class="x">  &lt;/gmd:metadataStandardName&gt;</span>
<span class="x">  &lt;gmd:metadataStandardVersion&gt;</span>
<span class="x">    &lt;gco:CharacterString&gt;2003/Cor.1:2006&lt;/gco:CharacterString&gt;</span>
<span class="x">  &lt;/gmd:metadataStandardVersion&gt;</span>
<span class="x">  &lt;gmd:referenceSystemInfo&gt;</span>
<span class="x">    &lt;gmd:MD_ReferenceSystem&gt;</span>
<span class="x">      &lt;gmd:referenceSystemIdentifier&gt;</span>
<span class="x">        &lt;gmd:RS_Identifier&gt;</span>
<span class="x">          &lt;gmd:authority&gt;</span>
<span class="x">            &lt;gmd:CI_Citation&gt;</span>
<span class="x">              &lt;gmd:title&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;European Petroleum Survey Group (EPSG) Geodetic Parameter Registry&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:title&gt;</span>
<span class="x">              &lt;gmd:date&gt;</span>
<span class="x">                &lt;gmd:CI_Date&gt;</span>
<span class="x">                  &lt;gmd:date&gt;</span>
<span class="x">                    &lt;gco:Date&gt;2008-11-12&lt;/gco:Date&gt;</span>
<span class="x">                  &lt;/gmd:date&gt;</span>
<span class="x">                  &lt;gmd:dateType&gt;</span>
<span class="x">                    &lt;gmd:CI_DateTypeCode codeList="http://www.isotc211.org/2005/resources/codelist/gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication"&gt;publication&lt;/gmd:CI_DateTypeCode&gt;</span>
<span class="x">                  &lt;/gmd:dateType&gt;</span>
<span class="x">                &lt;/gmd:CI_Date&gt;</span>
<span class="x">              &lt;/gmd:date&gt;</span>
<span class="x">              &lt;gmd:citedResponsibleParty&gt;</span>
<span class="x">                &lt;gmd:CI_ResponsibleParty&gt;</span>
<span class="x">                  &lt;gmd:organisationName&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;European Petroleum Survey Group&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:organisationName&gt;</span>
<span class="x">                  &lt;gmd:contactInfo&gt;</span>
<span class="x">                    &lt;gmd:CI_Contact&gt;</span>
<span class="x">                      &lt;gmd:onlineResource&gt;</span>
<span class="x">                        &lt;gmd:CI_OnlineResource&gt;</span>
<span class="x">                          &lt;gmd:linkage&gt;</span>
<span class="x">                            &lt;gmd:URL&gt;http://www.epsg-registry.org/&lt;/gmd:URL&gt;</span>
<span class="x">                          &lt;/gmd:linkage&gt;</span>
<span class="x">                        &lt;/gmd:CI_OnlineResource&gt;</span>
<span class="x">                      &lt;/gmd:onlineResource&gt;</span>
<span class="x">                    &lt;/gmd:CI_Contact&gt;</span>
<span class="x">                  &lt;/gmd:contactInfo&gt;</span>
<span class="x">                  &lt;gmd:role gco:nilReason="missing"/&gt;</span>
<span class="x">                &lt;/gmd:CI_ResponsibleParty&gt;</span>
<span class="x">              &lt;/gmd:citedResponsibleParty&gt;</span>
<span class="x">            &lt;/gmd:CI_Citation&gt;</span>
<span class="x">          &lt;/gmd:authority&gt;</span>
<span class="x">          &lt;gmd:code&gt;</span>
<span class="x">            &lt;gco:CharacterString&gt;http://www.opengis.net/def/crs/EPSG/0/4326&lt;/gco:CharacterString&gt;</span>
<span class="x">          &lt;/gmd:code&gt;</span>
<span class="x">          &lt;gmd:version&gt;</span>
<span class="x">            &lt;gco:CharacterString&gt;6.18.3&lt;/gco:CharacterString&gt;</span>
<span class="x">          &lt;/gmd:version&gt;</span>
<span class="x">        &lt;/gmd:RS_Identifier&gt;</span>
<span class="x">      &lt;/gmd:referenceSystemIdentifier&gt;</span>
<span class="x">    &lt;/gmd:MD_ReferenceSystem&gt;</span>
<span class="x">  &lt;/gmd:referenceSystemInfo&gt;</span>
<span class="x">  &lt;gmd:identificationInfo&gt;</span>
<span class="x">    &lt;gmd:MD_DataIdentification&gt;</span>
<span class="x">      &lt;gmd:citation&gt;</span>
<span class="x">        &lt;gmd:CI_Citation&gt;</span>
<span class="x">          &lt;gmd:title&gt;</span>
<span class="x">            &lt;gco:CharacterString&gt;Bebauungsplan </span><span class="cp">{{</span> <span class="nv">bplan.name</span> <span class="cp">}}</span><span class="x"> von </span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.name</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">          &lt;/gmd:title&gt;</span>
<span class="x">          &lt;gmd:date&gt;</span>
<span class="x">            &lt;gmd:CI_Date&gt;</span>
<span class="x">              &lt;gmd:date&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">bplan.history.date</span> <span class="cp">%}</span>
<span class="x">                &lt;gco:Date&gt;</span><span class="cp">{{</span> <span class="nv">bplan.history.date</span> <span class="cp">}}</span><span class="x">&lt;/gco:Date&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">                &lt;gco:Date&gt;2025-05-07&lt;/gco:Date&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">              &lt;/gmd:date&gt;</span>
<span class="x">              &lt;gmd:dateType&gt;</span>
<span class="x">                &lt;gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#CI_DateTypeCode" codeListValue="revision"&gt;revision&lt;/gmd:CI_DateTypeCode&gt;</span>
<span class="x">              &lt;/gmd:dateType&gt;</span>
<span class="x">            &lt;/gmd:CI_Date&gt;</span>
<span class="x">          &lt;/gmd:date&gt;</span>
<span class="x">          &lt;gmd:identifier&gt;</span>
<span class="x">            &lt;gmd:MD_Identifier&gt;</span>
<span class="x">              &lt;gmd:code&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;https://komserv4gdi.service24.rlp.de/</span><span class="cp">{{</span> <span class="nv">bplan.generic_id</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:code&gt;</span>
<span class="x">            &lt;/gmd:MD_Identifier&gt;</span>
<span class="x">          &lt;/gmd:identifier&gt;</span>
<span class="x">        &lt;/gmd:CI_Citation&gt;</span>
<span class="x">      &lt;/gmd:citation&gt;</span>
<span class="x">      &lt;gmd:abstract&gt;</span>
<span class="x">        &lt;gco:CharacterString&gt;Bebauungsplan </span><span class="cp">{{</span> <span class="nv">bplan.name</span> <span class="cp">}}</span><span class="x"> von </span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.name</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">      &lt;/gmd:abstract&gt;</span>
<span class="x">      &lt;gmd:pointOfContact&gt;</span>
<span class="x">        &lt;gmd:CI_ResponsibleParty&gt;</span>
<span class="x">          &lt;gmd:organisationName&gt;</span>
<span class="x">            &lt;gco:CharacterString&gt;</span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.address_street</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">          &lt;/gmd:organisationName&gt;</span>
<span class="x">          &lt;gmd:contactInfo&gt;</span>
<span class="x">            &lt;gmd:CI_Contact&gt;</span>
<span class="x">              &lt;gmd:address&gt;</span>
<span class="x">                &lt;gmd:CI_Address&gt;</span>
<span class="x">                  &lt;gmd:administrativeArea&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;Rheinland-Pfalz&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:administrativeArea&gt;</span>
<span class="x">                  &lt;gmd:country&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;DE&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:country&gt;</span>
<span class="x">                  &lt;gmd:electronicMailAddress&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;</span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.address_email</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:electronicMailAddress&gt;</span>
<span class="x">                &lt;/gmd:CI_Address&gt;</span>
<span class="x">              &lt;/gmd:address&gt;</span>
<span class="x">            &lt;/gmd:CI_Contact&gt;</span>
<span class="x">          &lt;/gmd:contactInfo&gt;</span>
<span class="x">          &lt;gmd:role&gt;</span>
<span class="x">            &lt;gmd:CI_RoleCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#CI_RoleCode" codeListValue="publisher"&gt;publisher&lt;/gmd:CI_RoleCode&gt;</span>
<span class="x">          &lt;/gmd:role&gt;</span>
<span class="x">        &lt;/gmd:CI_ResponsibleParty&gt;</span>
<span class="x">      &lt;/gmd:pointOfContact&gt;</span>
<span class="x">      &lt;gmd:resourceMaintenance&gt;</span>
<span class="x">        &lt;gmd:MD_MaintenanceInformation&gt;</span>
<span class="x">          &lt;gmd:maintenanceAndUpdateFrequency&gt;</span>
<span class="x">            &lt;gmd:MD_MaintenanceFrequencyCode codeListValue="irregular" codeList="http://www.isotc211.org/2005/resources/codeList.xml#MD_MaintenanceFrequencyCode"/&gt;</span>
<span class="x">          &lt;/gmd:maintenanceAndUpdateFrequency&gt;</span>
<span class="x">        &lt;/gmd:MD_MaintenanceInformation&gt;</span>
<span class="x">      &lt;/gmd:resourceMaintenance&gt;</span>
<span class="x">      &lt;gmd:descriptiveKeywords&gt;</span>
<span class="x">        &lt;gmd:MD_Keywords&gt;</span>
<span class="x">          &lt;gmd:keyword&gt;</span>
<span class="x">            &lt;gco:CharacterString&gt;Regional&lt;/gco:CharacterString&gt;</span>
<span class="x">          &lt;/gmd:keyword&gt;</span>
<span class="x">          &lt;gmd:thesaurusName&gt;</span>
<span class="x">            &lt;gmd:CI_Citation&gt;</span>
<span class="x">              &lt;gmd:title&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;Spatial scope&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:title&gt;</span>
<span class="x">              &lt;gmd:date&gt;</span>
<span class="x">                &lt;gmd:CI_Date&gt;</span>
<span class="x">                  &lt;gmd:date&gt;</span>
<span class="x">                    &lt;gco:Date&gt;2019-05-22&lt;/gco:Date&gt;</span>
<span class="x">                  &lt;/gmd:date&gt;</span>
<span class="x">                  &lt;gmd:dateType&gt;</span>
<span class="x">                    &lt;gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication"&gt;publication&lt;/gmd:CI_DateTypeCode&gt;</span>
<span class="x">                  &lt;/gmd:dateType&gt;</span>
<span class="x">                &lt;/gmd:CI_Date&gt;</span>
<span class="x">              &lt;/gmd:date&gt;</span>
<span class="x">            &lt;/gmd:CI_Citation&gt;</span>
<span class="x">          &lt;/gmd:thesaurusName&gt;</span>
<span class="x">        &lt;/gmd:MD_Keywords&gt;</span>
<span class="x">      &lt;/gmd:descriptiveKeywords&gt;</span>
<span class="x">      &lt;gmd:resourceConstraints&gt;</span>
<span class="x">&lt;!-- TODO: pull license information from user defined license information --&gt;</span>
<span class="x">&lt;gmd:MD_LegalConstraints&gt;</span>
<span class="x">&lt;gmd:accessConstraints&gt;</span>
<span class="x">&lt;gmd:MD_RestrictionCode codeList="http://standards.iso.org/iso/19139/resources/gmxCodelists.xml#MD_RestrictionCode" codeListValue="otherRestrictions"/&gt;</span>
<span class="x">&lt;/gmd:accessConstraints&gt;</span>
<span class="x">&lt;gmd:otherConstraints&gt;</span>
<span class="x">&lt;gmx:Anchor xlink:href="http://inspire.ec.europa.eu/metadata-codelist/LimitationsOnPublicAccess/noLimitations"&gt;Es gelten keine Zugriffsbeschr&auml;nkungen&lt;/gmx:Anchor&gt;</span>
<span class="x">&lt;/gmd:otherConstraints&gt;</span>
<span class="x">&lt;/gmd:MD_LegalConstraints&gt;</span>
<span class="x">&lt;/gmd:resourceConstraints&gt;</span>
<span class="x">&lt;gmd:resourceConstraints&gt;</span>
<span class="x">&lt;gmd:MD_LegalConstraints&gt;</span>
<span class="x">&lt;gmd:useConstraints&gt;</span>
<span class="x">&lt;gmd:MD_RestrictionCode codeList="http://standards.iso.org/iso/19139/resources/gmxCodelists.xml#MD_RestrictionCode" codeListValue="otherRestrictions"/&gt;</span>
<span class="x">&lt;/gmd:useConstraints&gt;</span>
<span class="x">&lt;gmd:otherConstraints&gt;</span>
<span class="x">&lt;gco:CharacterString&gt;</span>
<span class="x">Lizenz: cc-by-3.0 - Creative Commons: Namensnennung 3.0 Deutschland - http://creativecommons.org/licenses/by/3.0/de/ - Quellenvermerk: Source note required by license, but not given!</span>
<span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">&lt;/gmd:otherConstraints&gt;</span>
<span class="x">&lt;gmd:otherConstraints&gt;</span>
<span class="x">&lt;gco:CharacterString&gt;</span>
<span class="x">{"id":"cc-by-3.0","name":"Creative Commons: Namensnennung 3.0 Deutschland","url":"http:\/\/creativecommons.org\/licenses\/by\/3.0\/de\/","quelle":"Source note required by license, but not given!"}</span>
<span class="x">&lt;/gco:CharacterString&gt;</span>
<span class="x">&lt;/gmd:otherConstraints&gt;</span>
<span class="x">&lt;/gmd:MD_LegalConstraints&gt;</span>
<span class="x">&lt;/gmd:resourceConstraints&gt;</span>
<span class="x">&lt;gmd:spatialRepresentationType&gt;</span>
<span class="x">&lt;gmd:MD_SpatialRepresentationTypeCode codeList="https://standards.iso.org/iso/19139/resources/gmxCodelists.xml#MD_SpatialRepresentationTypeCode" codeListValue="vector"&gt;vector&lt;/gmd:MD_SpatialRepresentationTypeCode&gt;</span>
<span class="x">&lt;/gmd:spatialRepresentationType&gt;</span>
<span class="x">      &lt;gmd:spatialResolution&gt;</span>
<span class="x">        &lt;gmd:MD_Resolution&gt;</span>
<span class="x">          &lt;gmd:equivalentScale&gt;</span>
<span class="x">            &lt;gmd:MD_RepresentativeFraction&gt;</span>
<span class="x">              &lt;gmd:denominator&gt;</span>
<span class="x">                &lt;gco:Integer&gt;1000&lt;/gco:Integer&gt;</span>
<span class="x">              &lt;/gmd:denominator&gt;</span>
<span class="x">            &lt;/gmd:MD_RepresentativeFraction&gt;</span>
<span class="x">          &lt;/gmd:equivalentScale&gt;</span>
<span class="x">        &lt;/gmd:MD_Resolution&gt;</span>
<span class="x">      &lt;/gmd:spatialResolution&gt;</span>
<span class="x">      &lt;gmd:language&gt;</span>
<span class="x">        &lt;gmd:LanguageCode codeListValue="ger" codeList="http://www.loc.gov/standards/iso639-2"&gt;Deutsch&lt;/gmd:LanguageCode&gt;</span>
<span class="x">      &lt;/gmd:language&gt;</span>

<span class="x">      &lt;gmd:characterSet&gt;</span>
<span class="x">        &lt;gmd:MD_CharacterSetCode codeListValue="utf8" codeList="http://www.isotc211.org/2005/resources/codeList.xml#MD_CharacterSetCode"/&gt;</span>
<span class="x">      &lt;/gmd:characterSet&gt;</span>
<span class="x">      &lt;gmd:topicCategory&gt;</span>
<span class="x">        &lt;gmd:MD_TopicCategoryCode&gt;location&lt;/gmd:MD_TopicCategoryCode&gt;</span>
<span class="x">      &lt;/gmd:topicCategory&gt;</span>
<span class="x">      &lt;gmd:extent&gt;</span>
<span class="x">        &lt;gmd:EX_Extent&gt;</span>
<span class="x">          &lt;gmd:geographicElement&gt;</span>
<span class="x">            &lt;gmd:EX_GeographicBoundingBox&gt;</span>
<span class="x">              &lt;gmd:westBoundLongitude&gt;</span>
<span class="x">                &lt;gco:Decimal&gt;</span><span class="cp">{{</span> <span class="nv">wgs84_extent.0</span> <span class="cp">}}</span><span class="x">&lt;/gco:Decimal&gt;</span>
<span class="x">              &lt;/gmd:westBoundLongitude&gt;</span>
<span class="x">              &lt;gmd:eastBoundLongitude&gt;</span>
<span class="x">                &lt;gco:Decimal&gt;</span><span class="cp">{{</span> <span class="nv">wgs84_extent.1</span> <span class="cp">}}</span><span class="x">&lt;/gco:Decimal&gt;</span>
<span class="x">              &lt;/gmd:eastBoundLongitude&gt;</span>
<span class="x">              &lt;gmd:southBoundLatitude&gt;</span>
<span class="x">                &lt;gco:Decimal&gt;</span><span class="cp">{{</span> <span class="nv">wgs84_extent.2</span> <span class="cp">}}</span><span class="x">&lt;/gco:Decimal&gt;</span>
<span class="x">              &lt;/gmd:southBoundLatitude&gt;</span>
<span class="x">              &lt;gmd:northBoundLatitude&gt;</span>
<span class="x">                &lt;gco:Decimal&gt;</span><span class="cp">{{</span> <span class="nv">wgs84_extent.3</span> <span class="cp">}}</span><span class="x">&lt;/gco:Decimal&gt;</span>
<span class="x">              &lt;/gmd:northBoundLatitude&gt;</span>
<span class="x">            &lt;/gmd:EX_GeographicBoundingBox&gt;</span>
<span class="x">          &lt;/gmd:geographicElement&gt;</span>
<span class="x">        &lt;/gmd:EX_Extent&gt;</span>
<span class="x">      &lt;/gmd:extent&gt;</span>
<span class="x">      </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">multisurface_geometry_4326</span> <span class="cp">%}</span>
<span class="x">      &lt;gmd:extent&gt;</span>
<span class="x">        &lt;gmd:EX_Extent&gt;</span>
<span class="x">          &lt;gmd:geographicElement&gt;</span>
<span class="x">            &lt;gmd:EX_BoundingPolygon&gt;</span>
<span class="x">              &lt;gmd:polygon&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">autoescape</span> <span class="nv">off</span> <span class="cp">%}</span>
<span class="x">                </span><span class="cp">{{</span> <span class="nv">multisurface_geometry_4326</span> <span class="cp">}}</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span>
<span class="x">              &lt;/gmd:polygon&gt;</span>
<span class="x">            &lt;/gmd:EX_BoundingPolygon&gt;</span>
<span class="x">          &lt;/gmd:geographicElement&gt;</span>
<span class="x">        &lt;/gmd:EX_Extent&gt;</span>
<span class="x">      &lt;/gmd:extent&gt;</span>
<span class="x">      </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">      &lt;!--&lt;gmd:extent&gt;</span>
<span class="x">        &lt;gmd:EX_Extent&gt;</span>
<span class="x">          &lt;gmd:temporalElement&gt;</span>
<span class="x">            &lt;gmd:EX_TemporalExtent&gt;</span>
<span class="x">              &lt;gmd:extent&gt;</span>
<span class="x">                &lt;gml:TimePeriod gml:id="temporalextent"&gt;</span>
<span class="x">                  &lt;gml:beginPosition&gt;2024-11-08&lt;/gml:beginPosition&gt;</span>
<span class="x">                  &lt;gml:endPosition&gt;2024-11-09&lt;/gml:endPosition&gt;</span>
<span class="x">                &lt;/gml:TimePeriod&gt;</span>
<span class="x">              &lt;/gmd:extent&gt;</span>
<span class="x">            &lt;/gmd:EX_TemporalExtent&gt;</span>
<span class="x">          &lt;/gmd:temporalElement&gt;</span>
<span class="x">        &lt;/gmd:EX_Extent&gt;</span>
<span class="x">      &lt;/gmd:extent&gt;--&gt;</span>
<span class="x">    &lt;/gmd:MD_DataIdentification&gt;</span>
<span class="x">  &lt;/gmd:identificationInfo&gt;</span>
<span class="x">  &lt;gmd:distributionInfo&gt;</span>
<span class="x">    &lt;gmd:MD_Distribution&gt;</span>
<span class="x">      &lt;gmd:distributionFormat&gt;</span>
<span class="x">        &lt;gmd:MD_Format&gt;</span>
<span class="x">          &lt;gmd:name&gt;</span>
<span class="x">            &lt;gco:CharacterString&gt;GML&lt;/gco:CharacterString&gt;</span>
<span class="x">          &lt;/gmd:name&gt;</span>
<span class="x">          &lt;gmd:version&gt;</span>
<span class="x">            &lt;gco:CharacterString&gt;3.2&lt;/gco:CharacterString&gt;</span>
<span class="x">          &lt;/gmd:version&gt;</span>
<span class="x">        &lt;/gmd:MD_Format&gt;</span>
<span class="x">      &lt;/gmd:distributionFormat&gt;</span>
<span class="x">      &lt;gmd:distributor&gt;</span>
<span class="x">        &lt;gmd:MD_Distributor&gt;</span>
<span class="x">          &lt;gmd:distributorContact&gt;</span>
<span class="x">            &lt;gmd:CI_ResponsibleParty&gt;</span>
<span class="x">              &lt;gmd:organisationName&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">responsible_party_address</span> <span class="cp">%}</span>
<span class="x">                &lt;gco:CharacterString&gt;</span><span class="cp">{{</span> <span class="nv">responsible_party_address</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt; </span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">                &lt;gco:CharacterString&gt;Musterstra&szlig;e 10&lt;/gco:CharacterString&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">              &lt;/gmd:organisationName&gt;</span>
<span class="x">              &lt;gmd:contactInfo&gt;</span>
<span class="x">                &lt;gmd:CI_Contact&gt;</span>
<span class="x">                  &lt;gmd:address&gt;</span>
<span class="x">                    &lt;gmd:CI_Address&gt;</span>
<span class="x">                      &lt;gmd:administrativeArea&gt;</span>
<span class="x">                        &lt;gco:CharacterString&gt;Rheinland-Pfalz&lt;/gco:CharacterString&gt;</span>
<span class="x">                      &lt;/gmd:administrativeArea&gt;</span>
<span class="x">                      &lt;gmd:country&gt;</span>
<span class="x">                        &lt;gco:CharacterString&gt;DE&lt;/gco:CharacterString&gt;</span>
<span class="x">                      &lt;/gmd:country&gt;</span>
<span class="x">                      &lt;gmd:electronicMailAddress&gt;</span>
<span class="x">                        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">responsible_party_email</span> <span class="cp">%}</span>
<span class="x">                        &lt;gco:CharacterString&gt;</span><span class="cp">{{</span> <span class="nv">responsible_party_email</span> <span class="cp">}}</span><span class="x">&lt;/gco:CharacterString&gt; </span>
<span class="x">                        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">                        &lt;gco:CharacterString&gt;test@example.com&lt;/gco:CharacterString&gt;</span>
<span class="x">                        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">                      &lt;/gmd:electronicMailAddress&gt;</span>
<span class="x">                    &lt;/gmd:CI_Address&gt;</span>
<span class="x">                  &lt;/gmd:address&gt;</span>
<span class="x">                &lt;/gmd:CI_Contact&gt;</span>
<span class="x">              &lt;/gmd:contactInfo&gt;</span>
<span class="x">              &lt;gmd:role&gt;</span>
<span class="x">                &lt;gmd:CI_RoleCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#CI_RoleCode" codeListValue="pointOfContact"&gt;pointOfContact&lt;/gmd:CI_RoleCode&gt;</span>
<span class="x">              &lt;/gmd:role&gt;</span>
<span class="x">            &lt;/gmd:CI_ResponsibleParty&gt;</span>
<span class="x">          &lt;/gmd:distributorContact&gt;</span>
<span class="x">        &lt;/gmd:MD_Distributor&gt;</span>
<span class="x">      &lt;/gmd:distributor&gt;</span>
<span class="x">      &lt;gmd:transferOptions&gt;</span>
<span class="x">        &lt;gmd:MD_DigitalTransferOptions&gt;</span>
<span class="x">          &lt;gmd:onLine&gt;</span>
<span class="x">            &lt;gmd:CI_OnlineResource&gt;</span>
<span class="x">              &lt;gmd:linkage&gt;</span>
<span class="x">                &lt;gmd:URL&gt;</span><span class="cp">{{</span> <span class="nv">iso19139_url</span> <span class="cp">}}</span><span class="x">&lt;/gmd:URL&gt;</span>
<span class="x">              &lt;/gmd:linkage&gt;</span>
<span class="x">              &lt;gmd:function&gt;</span>
<span class="x">                &lt;gmd:CI_OnLineFunctionCode codeList="http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml" codeListValue="download"&gt;download&lt;/gmd:CI_OnLineFunctionCode&gt;</span>
<span class="x">              &lt;/gmd:function&gt;</span>
<span class="x">            &lt;/gmd:CI_OnlineResource&gt;</span>
<span class="x">          &lt;/gmd:onLine&gt;</span>
<span class="x">        &lt;/gmd:MD_DigitalTransferOptions&gt;</span>
<span class="x">      &lt;/gmd:transferOptions&gt;</span>
<span class="x">    &lt;/gmd:MD_Distribution&gt;</span>
<span class="x">  &lt;/gmd:distributionInfo&gt;</span>
<span class="x">  &lt;gmd:dataQualityInfo&gt;</span>
<span class="x">    &lt;!-- Fix --&gt;</span>
<span class="x">    &lt;gmd:DQ_DataQuality&gt;</span>
<span class="x">      &lt;gmd:scope&gt;</span>
<span class="x">        &lt;gmd:DQ_Scope&gt;</span>
<span class="x">          &lt;gmd:level&gt;</span>
<span class="x">            &lt;gmd:MD_ScopeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/codelist/ML_gmxCodelists.xml#MD_ScopeCode" codeListValue="dataset"&gt;dataset&lt;/gmd:MD_ScopeCode&gt;</span>
<span class="x">          &lt;/gmd:level&gt;</span>
<span class="x">        &lt;/gmd:DQ_Scope&gt;</span>
<span class="x">      &lt;/gmd:scope&gt;</span>

<span class="x">      &lt;gmd:report xmlns:gmd="http://www.isotc211.org/2005/gmd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gco="http://www.isotc211.org/2005/gco"&gt;</span>
<span class="x">        &lt;gmd:DQ_DomainConsistency xsi:type="gmd:DQ_DomainConsistency_Type"&gt;</span>
<span class="x">          &lt;gmd:result&gt;</span>
<span class="x">            &lt;gmd:DQ_ConformanceResult xsi:type="gmd:DQ_ConformanceResult_Type"&gt;</span>
<span class="x">              &lt;gmd:specification&gt;</span>
<span class="x">                &lt;gmd:CI_Citation&gt;</span>
<span class="x">                  &lt;gmd:title&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;VERORDNUNG (EG) Nr. 1205/2008 DER KOMMISSION vom 3. Dezember 2008 zur Durchf&uuml;hrung der Richtlinie 2007/2/EG des Europ&auml;ischen Parlaments und des Rates hinsichtlich Metadaten&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:title&gt;</span>
<span class="x">                  &lt;gmd:date&gt;</span>
<span class="x">                    &lt;gmd:CI_Date&gt;</span>
<span class="x">                      &lt;gmd:date&gt;</span>
<span class="x">                        &lt;gco:Date&gt;2008-12-04&lt;/gco:Date&gt;</span>
<span class="x">                      &lt;/gmd:date&gt;</span>
<span class="x">                      &lt;gmd:dateType&gt;</span>
<span class="x">                        &lt;gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/Codelist/ML_gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication"&gt;publication&lt;/gmd:CI_DateTypeCode&gt;</span>
<span class="x">                      &lt;/gmd:dateType&gt;</span>
<span class="x">                    &lt;/gmd:CI_Date&gt;</span>
<span class="x">                  &lt;/gmd:date&gt;</span>
<span class="x">                  &lt;gmd:edition&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;1.0&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:edition&gt;</span>
<span class="x">                &lt;/gmd:CI_Citation&gt;</span>
<span class="x">              &lt;/gmd:specification&gt;</span>
<span class="x">              &lt;gmd:explanation&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;No explanation available&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:explanation&gt;</span>
<span class="x">              &lt;gmd:pass&gt;</span>
<span class="x">                &lt;gco:Boolean&gt;true&lt;/gco:Boolean&gt;</span>
<span class="x">              &lt;/gmd:pass&gt;</span>
<span class="x">            &lt;/gmd:DQ_ConformanceResult&gt;</span>
<span class="x">          &lt;/gmd:result&gt;</span>
<span class="x">        &lt;/gmd:DQ_DomainConsistency&gt;</span>
<span class="x">      &lt;/gmd:report&gt;</span>
<span class="x">      &lt;gmd:report xmlns:gmd="http://www.isotc211.org/2005/gmd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gco="http://www.isotc211.org/2005/gco"&gt;</span>
<span class="x">        &lt;gmd:DQ_DomainConsistency xsi:type="gmd:DQ_DomainConsistency_Type"&gt;</span>
<span class="x">          &lt;gmd:result&gt;</span>
<span class="x">            &lt;gmd:DQ_ConformanceResult xsi:type="gmd:DQ_ConformanceResult_Type"&gt;</span>
<span class="x">              &lt;gmd:specification&gt;</span>
<span class="x">                &lt;gmd:CI_Citation&gt;</span>
<span class="x">                  &lt;gmd:title&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;VERORDNUNG (EU) Nr. 1253/2013 DER KOMMISSION vom 21. Oktober 2013 zur &Auml;nderung der Verordnung (EU) Nr. 1089/2010 zur Durchf&uuml;hrung der Richtlinie 2007/2/EG hinsichtlich der Interoperabilit&auml;t von Geodatens&auml;tzen und -diensten&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:title&gt;</span>
<span class="x">                  &lt;gmd:date&gt;</span>
<span class="x">                    &lt;gmd:CI_Date&gt;</span>
<span class="x">                      &lt;gmd:date&gt;</span>
<span class="x">                        &lt;gco:Date&gt;2013-12-10&lt;/gco:Date&gt;</span>
<span class="x">                      &lt;/gmd:date&gt;</span>
<span class="x">                      &lt;gmd:dateType&gt;</span>
<span class="x">                        &lt;gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/Codelist/ML_gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication"&gt;publication&lt;/gmd:CI_DateTypeCode&gt;</span>
<span class="x">                      &lt;/gmd:dateType&gt;</span>
<span class="x">                    &lt;/gmd:CI_Date&gt;</span>
<span class="x">                  &lt;/gmd:date&gt;</span>
<span class="x">                  &lt;gmd:edition&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;1.0&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:edition&gt;</span>
<span class="x">                &lt;/gmd:CI_Citation&gt;</span>
<span class="x">              &lt;/gmd:specification&gt;</span>
<span class="x">              &lt;gmd:explanation&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;No explanation available&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:explanation&gt;</span>
<span class="x">              &lt;gmd:pass&gt;</span>
<span class="x">                &lt;gco:Boolean&gt;false&lt;/gco:Boolean&gt;</span>
<span class="x">              &lt;/gmd:pass&gt;</span>
<span class="x">            &lt;/gmd:DQ_ConformanceResult&gt;</span>
<span class="x">          &lt;/gmd:result&gt;</span>
<span class="x">        &lt;/gmd:DQ_DomainConsistency&gt;</span>
<span class="x">      &lt;/gmd:report&gt;</span>
<span class="x">      &lt;gmd:report xmlns:gmd="http://www.isotc211.org/2005/gmd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gco="http://www.isotc211.org/2005/gco"&gt;</span>
<span class="x">        &lt;gmd:DQ_DomainConsistency xsi:type="gmd:DQ_DomainConsistency_Type"&gt;</span>
<span class="x">          &lt;gmd:result&gt;</span>
<span class="x">            &lt;gmd:DQ_ConformanceResult xsi:type="gmd:DQ_ConformanceResult_Type"&gt;</span>
<span class="x">              &lt;gmd:specification&gt;</span>
<span class="x">                &lt;gmd:CI_Citation&gt;</span>
<span class="x">                  &lt;gmd:title&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;VERORDNUNG (EU) Nr. 102/2011 DER KOMMISSION vom 4. Februar 2011 zur &Auml;nderung der Verordnung (EU) Nr. 1089/2010 zur Durchf&uuml;hrung der Richtlinie 2007/2/EG des Europ&auml;ischen Parlaments und des Rates hinsichtlich der Interoperabilit&auml;t von Geodatens&auml;tzen und -diensten&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:title&gt;</span>
<span class="x">                  &lt;gmd:date&gt;</span>
<span class="x">                    &lt;gmd:CI_Date&gt;</span>
<span class="x">                      &lt;gmd:date&gt;</span>
<span class="x">                        &lt;gco:Date&gt;2011-02-05&lt;/gco:Date&gt;</span>
<span class="x">                      &lt;/gmd:date&gt;</span>
<span class="x">                      &lt;gmd:dateType&gt;</span>
<span class="x">                        &lt;gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/Codelist/ML_gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication"&gt;publication&lt;/gmd:CI_DateTypeCode&gt;</span>
<span class="x">                      &lt;/gmd:dateType&gt;</span>
<span class="x">                    &lt;/gmd:CI_Date&gt;</span>
<span class="x">                  &lt;/gmd:date&gt;</span>
<span class="x">                  &lt;gmd:edition&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;1.0&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:edition&gt;</span>
<span class="x">                &lt;/gmd:CI_Citation&gt;</span>
<span class="x">              &lt;/gmd:specification&gt;</span>
<span class="x">              &lt;gmd:explanation&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;No explanation available&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:explanation&gt;</span>
<span class="x">              &lt;gmd:pass&gt;</span>
<span class="x">                &lt;gco:Boolean&gt;false&lt;/gco:Boolean&gt;</span>
<span class="x">              &lt;/gmd:pass&gt;</span>
<span class="x">            &lt;/gmd:DQ_ConformanceResult&gt;</span>
<span class="x">          &lt;/gmd:result&gt;</span>
<span class="x">        &lt;/gmd:DQ_DomainConsistency&gt;</span>
<span class="x">      &lt;/gmd:report&gt;</span>
<span class="x">      &lt;gmd:report xmlns:gmd="http://www.isotc211.org/2005/gmd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:gco="http://www.isotc211.org/2005/gco"&gt;</span>
<span class="x">        &lt;gmd:DQ_DomainConsistency xsi:type="gmd:DQ_DomainConsistency_Type"&gt;</span>
<span class="x">          &lt;gmd:result&gt;</span>
<span class="x">            &lt;gmd:DQ_ConformanceResult xsi:type="gmd:DQ_ConformanceResult_Type"&gt;</span>
<span class="x">              &lt;gmd:specification&gt;</span>
<span class="x">                &lt;gmd:CI_Citation&gt;</span>
<span class="x">                  &lt;gmd:title&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;VERORDNUNG (EG) Nr. 1089/2010 DER KOMMISSION vom 23. November 2010 zur Durchf&uuml;hrung der Richtlinie 2007/2/EG des Europ&auml;ischen Parlaments und des Rates hinsichtlich der Interoperabilit&auml;t von Geodatens&auml;tzen und -diensten&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:title&gt;</span>
<span class="x">                  &lt;gmd:date&gt;</span>
<span class="x">                    &lt;gmd:CI_Date&gt;</span>
<span class="x">                      &lt;gmd:date&gt;</span>
<span class="x">                        &lt;gco:Date&gt;2010-12-08&lt;/gco:Date&gt;</span>
<span class="x">                      &lt;/gmd:date&gt;</span>
<span class="x">                      &lt;gmd:dateType&gt;</span>
<span class="x">                        &lt;gmd:CI_DateTypeCode codeList="http://standards.iso.org/ittf/PubliclyAvailableStandards/ISO_19139_Schemas/resources/Codelist/ML_gmxCodelists.xml#CI_DateTypeCode" codeListValue="publication"&gt;publication&lt;/gmd:CI_DateTypeCode&gt;</span>
<span class="x">                      &lt;/gmd:dateType&gt;</span>
<span class="x">                    &lt;/gmd:CI_Date&gt;</span>
<span class="x">                  &lt;/gmd:date&gt;</span>
<span class="x">                  &lt;gmd:edition&gt;</span>
<span class="x">                    &lt;gco:CharacterString&gt;1.0&lt;/gco:CharacterString&gt;</span>
<span class="x">                  &lt;/gmd:edition&gt;</span>
<span class="x">                &lt;/gmd:CI_Citation&gt;</span>
<span class="x">              &lt;/gmd:specification&gt;</span>
<span class="x">              &lt;gmd:explanation&gt;</span>
<span class="x">                &lt;gco:CharacterString&gt;No explanation available&lt;/gco:CharacterString&gt;</span>
<span class="x">              &lt;/gmd:explanation&gt;</span>
<span class="x">              &lt;gmd:pass&gt;</span>
<span class="x">                &lt;gco:Boolean&gt;false&lt;/gco:Boolean&gt;</span>
<span class="x">              &lt;/gmd:pass&gt;</span>
<span class="x">            &lt;/gmd:DQ_ConformanceResult&gt;</span>
<span class="x">          &lt;/gmd:result&gt;</span>
<span class="x">        &lt;/gmd:DQ_DomainConsistency&gt;</span>
<span class="x">      &lt;/gmd:report&gt;</span>
<span class="x">      &lt;gmd:lineage&gt;</span>
<span class="x">        &lt;gmd:LI_Lineage&gt;</span>
<span class="x">          &lt;gmd:statement&gt;</span>
<span class="x">            &lt;gco:CharacterString&gt;Geodaten basieren auf den generalisierten amtlichen Grenzen der Gebietsk&ouml;rperschaften.&lt;/gco:CharacterString&gt;</span>
<span class="x">          &lt;/gmd:statement&gt;</span>
<span class="x">        &lt;/gmd:LI_Lineage&gt;</span>
<span class="x">      &lt;/gmd:lineage&gt;</span>
<span class="x">    &lt;/gmd:DQ_DataQuality&gt;</span>
<span class="x">  &lt;/gmd:dataQualityInfo&gt;</span>
<span class="x">&lt;/gmd:MD_Metadata&gt;</span>
</pre>
           </div>
          </div>
         </section>
         <section id="anpassung-der-tabelle">
          <h3>
           Anpassung der Tabelle
           <a class="headerlink" href="#anpassung-der-tabelle" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           komserv2/xplanung_light/tables.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tables</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlan</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">A</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BPlanTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
    <span class="c1">#download = tables.LinkColumn('gedis-document-pdf', text='Download', args=[A('pk')], \</span>
    <span class="c1">#                     orderable=False, empty_values=())</span>
    <span class="n">xplan_gml</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-export-xplan-raster-6'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'Exportieren'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">iso_metadata</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-export-iso19139'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'Exportieren'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">edit</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-update'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'Bearbeiten'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">delete</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-delete'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'L&ouml;schen'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    geojson = Column(</span>
<span class="sd">        accessor=A('geojson'),</span>
<span class="sd">        orderable=False,</span>
<span class="sd">        # ...</span>
<span class="sd">    )</span>
<span class="sd">    """</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s2">"django_tables2/bootstrap5.html"</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">,</span> <span class="s2">"xplan_gml"</span><span class="p">,</span> <span class="s2">"iso_metadata"</span><span class="p">,</span> <span class="s2">"edit"</span><span class="p">,</span> <span class="s2">"delete"</span><span class="p">)</span>
</pre>
           </div>
          </div>
         </section>
        </section>
        <section id="ergebnis-des-iso-metadaten-exports">
         <h2>
          Ergebnis des ISO-Metadaten Exports
          <a class="headerlink" href="#ergebnis-des-iso-metadaten-exports" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Die Bebauungsplantabelle hat jetzt eine Spalte mit dem jeweiligen Link zu einem konformen
          <strong>
           ISO-19139 dataset Metadatensatz
          </strong>
          .
Den k&ouml;nnen wir sp&auml;ter verwenden um die Serverkomponenten damit anzureichen -
          <strong>
           GDI very easy  ;-)
          </strong>
          .
         </p>
         <section id="neue-spalte-fur-export-in-tabelle">
          <h3>
           Neue Spalte f&uuml;r Export in Tabelle
           <a class="headerlink" href="#neue-spalte-fur-export-in-tabelle" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/bplan/">
            http://127.0.0.1:8000/bplan/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/bplan_list_tables2_iso_export.png">
           <img alt="Neue Spalte f&uuml;r Export in Tabelle" class="bg-primary align-center" src="_images/bplan_list_tables2_iso_export.png" style="width: 800px;"/>
          </a>
         </section>
         <section id="iso19139-export">
          <h3>
           ISO19139 Export
           <a class="headerlink" href="#iso19139-export" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           <a class="reference external" href="http://127.0.0.1:8000/bplan/1/iso19139/">
            http://127.0.0.1:8000/bplan/1/iso19139/
           </a>
          </p>
          <a class="bg-primary reference internal image-reference" href="_images/iso19139_export_1.png">
           <img alt="ISO19139 Export" class="bg-primary align-center" src="_images/iso19139_export_1.png" style="width: 800px;"/>
          </a>
         </section>
        </section>
        <section id="todos">
         <h2>
          TODOs
          <a class="headerlink" href="#todos" title="Permalink to this heading">
           
          </a>
         </h2>
         <p>
          Um die Software zur Produktionsreife zu bringen, m&uuml;ssen noch ein paar Dinge entwickelt werden.
         </p>
         <ul class="simple">
          <li>
           <p>
            Ersetzen des Felds
            <strong>
             geltungsbereich
            </strong>
            durch eine m2m Relation zu einem neuen Modell
            <strong>
             bereich
            </strong>
           </p>
          </li>
          <li>
           <p>
            Aktivieren der Pflichtfelder entprechend der Vorgaben in RLP
           </p>
          </li>
          <li>
           <p>
            Entwickeln notwendiger Validierungsfunktionen
           </p>
          </li>
          <li>
           <p>
            Erstellung eines Mapfile-Generators zur Publikation von WMS- und WFS-Interfaces
           </p>
          </li>
          <li>
           <p>
            Schaffung der Ablagem&ouml;glichkeit f&uuml;r Dokumente
           </p>
          </li>
          <li>
           <p>
            Importm&ouml;glichkeit f&uuml;r BPlan-GML Dokumente
           </p>
          </li>
          <li>
           <p>
            &hellip;
           </p>
          </li>
         </ul>
         <div class="admonition note">
          <p class="admonition-title">
           Bemerkung
          </p>
          <p>
           Auf geht&rsquo;s ;-) &hellip;
          </p>
         </div>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-addons">
        </span>
        <section id="zusatzliche-funktionen">
         <h2>
          Zus&auml;tzliche Funktionen
          <a class="headerlink" href="#zusatzliche-funktionen" title="Permalink to this heading">
           
          </a>
         </h2>
         <section id="import-von-xplan-gml-files">
          <h3>
           Import von XPlan-GML Files
           <a class="headerlink" href="#import-von-xplan-gml-files" title="Permalink to this heading">
            
           </a>
          </h3>
          <section id="vorbereitung">
           <h4>
            Vorbereitung
            <a class="headerlink" href="#vorbereitung" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            Wir nutzen ab hier crispy-forms um die Formulare zu optimieren.
           </p>
           <p>
            Installation der packages
           </p>
           <div class="highlight-shell notranslate">
            <div class="highlight">
             <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-crispy-forms
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>crispy-bootstrap5
</pre>
            </div>
           </div>
           <p>
            Aktivierung in komserv/settings.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#...</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">'crispy_forms'</span><span class="p">,</span>
    <span class="s1">'crispy_bootstrap5'</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1">#...</span>
<span class="n">CRISPY_ALLOWED_TEMPLATE_PACKS</span> <span class="o">=</span> <span class="s2">"bootstrap5"</span>
<span class="n">CRISPY_TEMPLATE_PACK</span> <span class="o">=</span> <span class="s2">"bootstrap5"</span>
<span class="c1">#...</span>
</pre>
            </div>
           </div>
          </section>
          <section id="formular-und-validator">
           <h4>
            Formular und Validator
            <a class="headerlink" href="#formular-und-validator" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            F&uuml;r den Import von GML-Dateien bauen wir uns eine spezielles Formular. Dazu schreiben wir eine neue Form-Klasse.
Die Klasse wird nicht von einem Model abgeleitet und hat einen eigenen Validator, der in der validators.py abgelegt ist.
Der Validator pr&uuml;ft zun&auml;chst, ob es sich um eine unterst&uuml;tzte XPlan-GML-Datei handelt. Ausserdem werden die Plichtfelder gecheckt, sowie
der AGS. Der muss einer im System vorhandenen Organisation zugeordnet werden k&ouml;nnen.
           </p>
           <p>
            komserv2/xplanung_light/forms.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.validators</span><span class="w"> </span><span class="kn">import</span> <span class="n">xplan_content_validator</span>
<span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">crispy_forms.helper</span><span class="w"> </span><span class="kn">import</span> <span class="n">FormHelper</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">crispy_forms.layout</span><span class="w"> </span><span class="kn">import</span> <span class="n">Layout</span><span class="p">,</span> <span class="n">Fieldset</span><span class="p">,</span> <span class="n">Submit</span>
<span class="c1"># ...</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BPlanImportForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">confirm</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">"Vorhandenen Plan &uuml;berschreiben"</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"BPlan GML"</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">xplan_content_validator</span><span class="p">])</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    for crispy-forms</span>
<span class="sd">    """</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BPlanImportForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">FormHelper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">Fieldset</span><span class="p">(</span><span class="s2">"Bebauungsplan importieren"</span><span class="p">,</span> <span class="s2">"file"</span><span class="p">,</span> <span class="s2">"confirm"</span><span class="p">),</span> <span class="n">Submit</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span> <span class="s2">"Hochladen"</span><span class="p">))</span>
</pre>
            </div>
           </div>
           <p>
            komserv2/xplanung_light/validators.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django</span><span class="w"> </span><span class="kn">import</span> <span class="n">forms</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xml.etree.ElementTree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ET</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.geos</span><span class="w"> </span><span class="kn">import</span> <span class="n">GEOSGeometry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdministrativeOrganization</span>
<span class="c1">#https://www.tommygeorge.com/blog/validating-content-of-django-file-uploads/</span>


<span class="sd">"""</span>
<span class="sd">Funktion zur Validierung der zu importierenden XPlan-GML Datei.</span>

<span class="sd">Validierungen:</span>

<span class="sd">* Datei ist XML</span>
<span class="sd">* Namespace ist http://www.xplanung.de/xplangml/6/0 und Element ist XPlanAuszug</span>
<span class="sd">* XPlan-Pflichtfelder</span>
<span class="sd">* Spezielle Pflichtfelder</span>
<span class="sd">"""</span>
<span class="k">def</span><span class="w"> </span><span class="nf">xplan_content_validator</span><span class="p">(</span><span class="n">xplan_file</span><span class="p">):</span>
    <span class="n">xml_string</span> <span class="o">=</span> <span class="n">xplan_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'UTF-8'</span><span class="p">)</span>
    <span class="n">validation_error_messages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ET</span><span class="o">.</span><span class="n">register_namespace</span><span class="p">(</span><span class="s2">"gml"</span><span class="p">,</span> <span class="s2">"http://www.opengis.net/gml/3.2"</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml_string</span><span class="p">)</span>
        <span class="n">root_element_name</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="n">supported_element_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"{http://www.xplanung.de/xplangml/6/0}XPlanAuszug"</span><span class="p">,</span> <span class="p">]</span>
        <span class="k">if</span> <span class="n">root_element_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_element_names</span><span class="p">:</span>
            <span class="n">validation_error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"XML-Dokument mit root-Element *"</span> <span class="o">+</span> <span class="n">root_element_name</span> <span class="o">+</span> <span class="s2">"* wird nicht unterst&uuml;tzt!"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check Pflichtfelder</span>
            <span class="c1"># check zus&auml;tzliche Pflichtfelder aus eigenem Standard - nummer, rechtsstand, ...</span>
            <span class="n">ns</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">'xplan'</span><span class="p">:</span> <span class="s1">'http://www.xplanung.de/xplangml/6/0'</span><span class="p">,</span>
                <span class="s1">'gml'</span><span class="p">:</span> <span class="s1">'http://www.opengis.net/gml/3.2'</span><span class="p">,</span>
                <span class="s1">'xlink'</span><span class="p">:</span> <span class="s1">'http://www.w3.org/1999/xlink'</span><span class="p">,</span>
                <span class="s1">'xsi'</span><span class="p">:</span> <span class="s1">'http://www.w3.org/2001/XMLSchema-instance'</span><span class="p">,</span>
                <span class="s1">'wfs'</span><span class="p">:</span> <span class="s1">'http://www.opengis.net/wfs'</span><span class="p">,</span>
                <span class="s1">'xsd'</span><span class="p">:</span> <span class="s1">'http://www.w3.org/2001/XMLSchema'</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="c1"># check Pflichtfelder aus XPlannung Standard - name, geltungsbereich, gemeinde, planart</span>
            <span class="n">mandatory_fields</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">'name'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'xpath'</span><span class="p">:</span> <span class="s1">'gml:featureMember/xplan:BP_Plan/'</span><span class="p">,</span> <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'text'</span><span class="p">,</span> <span class="s1">'xplan_element'</span><span class="p">:</span> <span class="s1">'xplan:name'</span><span class="p">},</span>
                <span class="s1">'planart'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'xpath'</span><span class="p">:</span> <span class="s1">'gml:featureMember/xplan:BP_Plan/'</span><span class="p">,</span> <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'text'</span><span class="p">,</span> <span class="s1">'xplan_element'</span><span class="p">:</span> <span class="s1">'xplan:planArt'</span><span class="p">},</span>
                <span class="s1">'gemeinde_name'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'xpath'</span><span class="p">:</span> <span class="s1">'gml:featureMember/xplan:BP_Plan/xplan:gemeinde/xplan:XP_Gemeinde/'</span><span class="p">,</span> <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'text'</span><span class="p">,</span> <span class="s1">'xplan_element'</span><span class="p">:</span> <span class="s1">'xplan:gemeindeName'</span><span class="p">},</span>
                <span class="s1">'gemeinde_ags'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'xpath'</span><span class="p">:</span> <span class="s1">'gml:featureMember/xplan:BP_Plan/xplan:gemeinde/xplan:XP_Gemeinde/'</span><span class="p">,</span> <span class="s1">'type'</span><span class="p">:</span> <span class="s1">'text'</span><span class="p">,</span> <span class="s1">'xplan_element'</span><span class="p">:</span> <span class="s1">'xplan:ags'</span><span class="p">},</span>
            <span class="p">}</span>
            <span class="c1"># Auslesen der Information zur Gemeinde - hier wird aktuell von nur einem XP_Gemeinde-Objekt ausgegangen!</span>
            <span class="n">gemeinde_ags</span> <span class="o">=</span> <span class="s2">"000000000000"</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mandatory_fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'text'</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span> 
                        <span class="n">test</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">'xpath'</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span><span class="p">[</span><span class="s1">'xplan_element'</span><span class="p">],</span> <span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                        <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="s1">'xplan_element'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'xplan:ags'</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                                <span class="n">gemeinde_ags</span> <span class="o">=</span> <span class="n">test</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">"Die gefundene AGS im Dokument hat keine 10 Stellen - es werden nur 10-stellige AGS akzeptiert!"</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                       <span class="n">validation_error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"Das Pflichtelement *"</span> <span class="o">+</span> <span class="n">value</span><span class="p">[</span><span class="s1">'xplan_element'</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"* wurde nicht gefunden!"</span><span class="p">)</span> 
            
            <span class="n">geltungsbereich_element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"gml:featureMember/xplan:BP_Plan/xplan:raeumlicherGeltungsbereich/gml:MultiSurface"</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>        
            <span class="n">geltungsbereich_text</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">geltungsbereich_element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>  
            <span class="c1"># Bauen eines GEOS-Geometrie Objektes aus dem GML</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">GEOSGeometry</span><span class="o">.</span><span class="n">from_gml</span><span class="p">(</span><span class="n">geltungsbereich_text</span><span class="p">)</span>
            <span class="c1"># Definition des Koordinatenreferenzsystems</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">srid</span> <span class="o">=</span> <span class="mi">25832</span>
            <span class="c1"># Transformation in WGS84 f&uuml;r die Ablage im System</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
            <span class="c1"># DEBUG Ausgaben</span>
            <span class="c1">#print("Name des BPlans: " + name)</span>
            <span class="c1">#print("Gemeinde des BPlans: " + gemeinde_name)</span>
            <span class="c1">#print("AGS der Gemeinde: " + gemeinde_ags)</span>
            <span class="c1">#print("Geltungsbereich: " + geltungsbereich_text)</span>
            <span class="c1">#print("geometry: " + geometry.wkt)</span>
            <span class="c1">#0723507001</span>
            <span class="c1">#print(gemeinde_ags[:2] + " - " + gemeinde_ags[2:5] + " - " + gemeinde_ags[5:7] + " - " + gemeinde_ags[7:10])</span>
            <span class="c1"># check zus&auml;tzliche Pflichtfelder aus eigenem Standard - nummer, rechtsstand, ...</span>

            <span class="c1"># Zuordnung einer Organisation aus den vorhandenen AdministrativeOrganizations &uuml;ber AGS</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">orga</span> <span class="o">=</span> <span class="n">AdministrativeOrganization</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="n">gemeinde_ags</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">ks</span><span class="o">=</span><span class="n">gemeinde_ags</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">vs</span><span class="o">=</span><span class="n">gemeinde_ags</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span> <span class="n">gs</span><span class="o">=</span><span class="n">gemeinde_ags</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">validation_error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"Es wurde keine Organisation mit dem AGS *"</span> <span class="o">+</span> <span class="n">gemeinde_ags</span> <span class="o">+</span> <span class="s2">"* im System gefunden!"</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">validation_error_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"XML-Dokument konnte nicht geparsed werden!"</span><span class="p">)</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">validation_error_messages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">validation_error_messages</span><span class="p">))</span>
</pre>
            </div>
           </div>
          </section>
          <section id="importfunktion">
           <h4>
            Importfunktion
            <a class="headerlink" href="#importfunktion" title="Permalink to this heading">
             
            </a>
           </h4>
           <section id="konfiguration">
            <h5>
             Konfiguration
             <a class="headerlink" href="#konfiguration" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             F&uuml;r die Importfunktion wird ein Verzeichnis
             <strong>
              helper
             </strong>
             angelegt.
            </p>
            <div class="highlight-shell notranslate">
             <div class="highlight">
              <pre><span></span>mkdir<span class="w"> </span>komserv2/xplanung_light/helper
</pre>
             </div>
            </div>
            <p>
             Dort erstellen wir eine Datei xplanung.py
            </p>
            <p>
             komserv2/xplanung_light/helper/xplanung.py
            </p>
            <div class="highlight-python notranslate">
             <div class="highlight">
              <pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xml.etree.ElementTree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ET</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django</span><span class="w"> </span><span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.geos</span><span class="w"> </span><span class="kn">import</span> <span class="n">GEOSGeometry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlan</span><span class="p">,</span> <span class="n">AdministrativeOrganization</span>

<span class="k">class</span><span class="w"> </span><span class="nc">XPlanung</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Klasse mit Hilfsfunktionen f&uuml;r den Import von XPlan-GML Dokumenten. </span>

<span class="sd">    """</span>
    <span class="n">xml_string</span><span class="p">:</span><span class="nb">str</span>
    <span class="n">xplan_version</span> <span class="o">=</span> <span class="s2">"6.0"</span>
    <span class="n">xplan_name</span><span class="p">:</span><span class="nb">str</span>
    <span class="n">xplan_orga</span><span class="p">:</span><span class="n">AdministrativeOrganization</span>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Constructor method</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xml_string</span> <span class="o">=</span> <span class="n">xml_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'UTF-8'</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">import_bplan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># for exporting gml with right namespace</span>
        <span class="n">ET</span><span class="o">.</span><span class="n">register_namespace</span><span class="p">(</span><span class="s2">"gml"</span><span class="p">,</span> <span class="s2">"http://www.opengis.net/gml/3.2"</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xml_string</span><span class="p">)</span>
        <span class="c1"># check for version</span>
        <span class="c1">#&lt;xplan:XPlanAuszug xmlns:xplan="http://www.xplanung.de/xplangml/6/0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.xplanung.de/xplangml/6/0 http://repository.gdi-de.org/schemas/de.xleitstelle.xplanung/6.0/XPlanung-Operationen.xsd" gml:id="GML_080e46d4-9a9f-4f1d-8f3b-f17f79228417"&gt;</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'xplan'</span><span class="p">:</span> <span class="s1">'http://www.xplanung.de/xplangml/6/0'</span><span class="p">,</span>
            <span class="s1">'gml'</span><span class="p">:</span> <span class="s1">'http://www.opengis.net/gml/3.2'</span><span class="p">,</span>
            <span class="s1">'xlink'</span><span class="p">:</span> <span class="s1">'http://www.w3.org/1999/xlink'</span><span class="p">,</span>
            <span class="s1">'xsi'</span><span class="p">:</span> <span class="s1">'http://www.w3.org/2001/XMLSchema-instance'</span><span class="p">,</span>
            <span class="s1">'wfs'</span><span class="p">:</span> <span class="s1">'http://www.opengis.net/wfs'</span><span class="p">,</span>
            <span class="s1">'xsd'</span><span class="p">:</span> <span class="s1">'http://www.w3.org/2001/XMLSchema'</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Auslesen der Pflichtelemente aus der GML-Datei - Pr&uuml;fung erfolgte bereits im Formular</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"gml:featureMember/xplan:BP_Plan/xplan:name"</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">planart</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"gml:featureMember/xplan:BP_Plan/xplan:planArt"</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">geltungsbereich_element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"gml:featureMember/xplan:BP_Plan/xplan:raeumlicherGeltungsbereich/gml:MultiSurface"</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>        
        <span class="n">geltungsbereich_text</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">geltungsbereich_element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>  
        <span class="c1"># Bauen eines GEOS-Geometrie Objektes aus dem GML</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">GEOSGeometry</span><span class="o">.</span><span class="n">from_gml</span><span class="p">(</span><span class="n">geltungsbereich_text</span><span class="p">)</span>
        <span class="c1"># Definition des Koordinatenreferenzsystems</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">srid</span> <span class="o">=</span> <span class="mi">25832</span>
        <span class="c1">#print(geometry.wkt)</span>
        <span class="c1"># Transformation in WGS84 f&uuml;r die Ablage im System</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
        <span class="c1"># Auslesen der Information zur Gemeinde - hier wird aktuell von nur einem XP_Gemeinde-Objekt ausgegangen!</span>
        <span class="n">gemeinde_name</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"gml:featureMember/xplan:BP_Plan/xplan:gemeinde/xplan:XP_Gemeinde/xplan:gemeindeName"</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">gemeinde_ags</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"gml:featureMember/xplan:BP_Plan/xplan:gemeinde/xplan:XP_Gemeinde/xplan:ags"</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="c1"># DEBUG Ausgaben</span>
        <span class="c1">#print("Name des BPlans: " + name)</span>
        <span class="c1">#print("Gemeinde des BPlans: " + gemeinde_name)</span>
        <span class="c1">#print("AGS der Gemeinde: " + gemeinde_ags)</span>
        <span class="c1">#print("Geltungsbereich: " + geltungsbereich_text)</span>
        <span class="c1">#print("geometry: " + geometry.wkt)</span>
        <span class="c1">#0723507001</span>
        <span class="c1">#print(gemeinde_ags[:2] + " - " + gemeinde_ags[2:5] + " - " + gemeinde_ags[5:7] + " - " + gemeinde_ags[7:10])</span>
        <span class="c1"># Selektion einer Organisation anhand des AGS - Existenz wurde vorher schon durch Validierung gepr&uuml;ft</span>
        <span class="n">orga</span> <span class="o">=</span> <span class="n">AdministrativeOrganization</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="n">gemeinde_ags</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">ks</span><span class="o">=</span><span class="n">gemeinde_ags</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">vs</span><span class="o">=</span><span class="n">gemeinde_ags</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span> <span class="n">gs</span><span class="o">=</span><span class="n">gemeinde_ags</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
        <span class="c1"># Test, ob ein BPlan mit gleichem name und gemeinde schon existiert</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">existing_bplan</span> <span class="o">=</span> <span class="n">BPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">gemeinde</span><span class="o">=</span><span class="n">orga</span><span class="p">)</span>
            <span class="c1">#print(existing_bplan)</span>
            <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">existing_bplan</span><span class="o">.</span><span class="n">planart</span> <span class="o">=</span> <span class="n">planart</span>
                <span class="n">existing_bplan</span><span class="o">.</span><span class="n">geltungsbereich</span> <span class="o">=</span> <span class="n">geometry</span>
                <span class="n">existing_bplan</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="c1">#raise forms.ValidationError("Plan existiert bereits - bitte &Uuml;berschreiben w&auml;hlen!")</span>
            <span class="k">return</span> <span class="kc">False</span>
            <span class="c1">#return False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1">#print("BPlan not found - will be created!")</span>
            <span class="k">pass</span>
        <span class="c1"># Erstellen eines neuen BPlan-Objektes</span>
        <span class="n">bplan</span> <span class="o">=</span> <span class="n">BPlan</span><span class="p">()</span>
        <span class="n">bplan</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">bplan</span><span class="o">.</span><span class="n">planart</span> <span class="o">=</span> <span class="n">planart</span>
        <span class="n">bplan</span><span class="o">.</span><span class="n">geltungsbereich</span> <span class="o">=</span> <span class="n">geometry</span>
        <span class="n">bplan</span><span class="o">.</span><span class="n">gemeinde</span> <span class="o">=</span> <span class="n">orga</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bplan</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s2">"Fehler beim Abspeichern des BPlan-Objekts"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
</pre>
             </div>
            </div>
            <p>
             Es fehlt noch die View - diesmal &uuml;ber eine Function-based view umgesetzt, das html-Template und der zugeh&ouml;rige Eintrag in der urls.py
            </p>
            <p>
             komserv2/xplanung_light/views.py
            </p>
            <div class="highlight-python notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.helper.xplanung</span><span class="w"> </span><span class="kn">import</span> <span class="n">XPlanung</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">messages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">RegistrationForm</span><span class="p">,</span> <span class="n">BPlanImportForm</span>
<span class="c1"># ...</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bplan_import</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"POST"</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BPlanImportForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>
        <span class="c1">#print("bplan_import: form rendered")</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1">#print("bplan_import: form valid")</span>
            <span class="c1"># https://stackoverflow.com/questions/44722885/reading-inmemoryuploadedfile-twice</span>
            <span class="c1"># pointer muss auf Dateianfang gesetzt sein!</span>
            <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">xplanung</span> <span class="o">=</span> <span class="n">XPlanung</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">[</span><span class="s2">"file"</span><span class="p">])</span>
            <span class="c1"># import xml file after prevalidation - check is done, if object already exists</span>
            <span class="n">overwrite</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">'confirm'</span><span class="p">]</span>
            <span class="c1">#print(overwrite)</span>
            <span class="n">bplan_created</span> <span class="o">=</span> <span class="n">xplanung</span><span class="o">.</span><span class="n">import_bplan</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bplan_created</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'Bebauungsplan ist schon vorhanden - bitte selektieren sie explizit </span><span class="se">\"</span><span class="s1">Vorhandenen Plan &uuml;berschreiben</span><span class="se">\"</span><span class="s1">!'</span><span class="p">)</span>
                <span class="c1"># extent form  with confirmation field!</span>
                <span class="c1"># https://amgcomputing.blogspot.com/2015/11/django-form-confirm-before-saving.html</span>
                <span class="c1"># reload form</span>
                <span class="n">form</span> <span class="o">=</span> <span class="n">BPlanImportForm</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">"xplanung_light/bplan_import.html"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"form"</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'Bebauungsplan wurde erfolgreich aktualisiert!'</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'Bebauungsplan wurde erfolgreich importiert!'</span><span class="p">)</span>
            <span class="c1">#print("bplan_import: import done")</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">'bplan-list'</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"bplan_import: form invalid"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#print("bplan_import: no post")</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BPlanImportForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">"xplanung_light/bplan_import.html"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"form"</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
<span class="c1"># ...</span>
</pre>
             </div>
            </div>
            <p>
             komserv2/xplanung_light/templates/xplanung_light/bplan_import.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">crispy_forms_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Bebauungsplan importieren</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;form method="post" enctype="multipart/form-data"&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">crispy</span> <span class="nv">form</span> <span class="cp">%}</span>
<span class="x">&lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
             </div>
            </div>
            <p>
             komserv2/xplanung_light/urls.py
            </p>
            <div class="highlight-python notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># ...</span>
<span class="n">path</span><span class="p">(</span><span class="s2">"bplan/import/"</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">bplan_import</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-import"</span><span class="p">),</span>
<span class="c1"># ...</span>
</pre>
             </div>
            </div>
            <p>
             komserv2/xplanung_light/templates/xplanung_light/bplan_list.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="x">&lt;!-- Neuer Link f&uuml;r den Import --&gt;</span>
<span class="x">&lt;p&gt;&lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-create'</span> <span class="cp">%}</span><span class="x">"&gt;BPlan anlegen&lt;/a&gt;&lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-import'</span> <span class="cp">%}</span><span class="x">"&gt;BPlan importieren&lt;/a&gt;&lt;/p&gt;</span>
<span class="x">&lt;!--  --&gt;</span>
</pre>
             </div>
            </div>
           </section>
           <section id="import-eines-zuvor-exportierten-xplan-gmls">
            <h5>
             Import eines zuvor exportierten XPlan-GMLs
             <a class="headerlink" href="#import-eines-zuvor-exportierten-xplan-gmls" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             Die Bebauungspl&auml;ne m&uuml;ssen irgendwie anhand ihrer Attribute identifiziert werden. Da es nur sehr wenige Pflichtfelder gibt, pr&uuml;fen wir zun&auml;chst einfach
ob ein Bebauungsplan mit dem gleichen Namen aus der abgegebenen Kommune schon existiert! Wenn also Namen und AGS der Gemeinde identisch sind, handelt es sich um denselben Plan.
            </p>
            <p>
             <a class="reference external" href="http://127.0.0.1:8000/bplan/import/">
              http://127.0.0.1:8000/bplan/import/
             </a>
            </p>
            <a class="bg-primary reference internal image-reference" href="_images/bplan_import_existing.png">
             <img alt="Import eines zuvor exportierten XPlan-GMLs" class="bg-primary align-center" src="_images/bplan_import_existing.png" style="width: 800px;"/>
            </a>
            <p>
             Wenn explizit
             <strong>
              &uuml;berschreiben
             </strong>
             selektiert wurde, wird der vorhandene Plan aktualisiert.
            </p>
            <a class="bg-primary reference internal image-reference" href="_images/bplan_overwrite_existing.png">
             <img alt="Import eines zuvor exportierten XPlan-GMLs mit &Uuml;berschreiben" class="bg-primary align-center" src="_images/bplan_overwrite_existing.png" style="width: 800px;"/>
            </a>
            <p>
             Im sqlite-Client sieht man wie sich das auf die History auswirkt
            </p>
            <a class="bg-primary reference internal image-reference" href="_images/bplan_history_sqldb.png">
             <img alt="History Tabelle im sqlite-Client" class="bg-primary align-center" src="_images/bplan_history_sqldb.png" style="width: 800px;"/>
            </a>
           </section>
          </section>
         </section>
         <section id="integration-mapserver">
          <h3>
           Integration Mapserver
           <a class="headerlink" href="#integration-mapserver" title="Permalink to this heading">
            
           </a>
          </h3>
          <section id="installation-der-benotigten-libraries">
           <h4>
            Installation der ben&ouml;tigten Libraries
            <a class="headerlink" href="#installation-der-benotigten-libraries" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            Zur Bereitstellung der Planungsdaten &uuml;ber WMS- und WFS-Schnittstellen ben&ouml;tigen wir eine Kartenserverkomponente.
Aus Gr&uuml;nden der Einfachheit werden wir hier den
            <strong>
             UMN-Mapserver
            </strong>
            einsetzen. Die Serverkomponente ben&ouml;tigt Konfigurationsdateien,
die jeweils pro bereitstellender Organisation generiert werden. Die Konfigurationsdatein k&ouml;nnen entweder statisch abgelegt, oder zur Laufzeit
erstellt und eingelesen werden. Der Einfachheit halber, setzen wir zun&auml;chst den dynamischen Ansatz um.
           </p>
           <p>
            F&uuml;r die Mapserver Integration ben&ouml;tigen wir zwei zus&auml;tzliche python Pakete:
           </p>
           <ul class="simple">
            <li>
             <p>
              <a class="reference external" href="https://mappyfile.readthedocs.io/en/latest/">
               mappyfile
              </a>
              : Bibliothek zum Parsen, Validieren und erstellen von Mapserver Konfiguretaionsdateien (mapfiles)
             </p>
            </li>
            <li>
             <p>
              <a class="reference external" href="https://pypi.org/project/mapscript/">
               mapscript
              </a>
              : Interface zu den Mapserver Klassen vis SWIG (Python 3.8+)
             </p>
            </li>
           </ul>
           <p>
            Installation in venv:
           </p>
           <div class="highlight-shell notranslate">
            <div class="highlight">
             <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">mapscript</span><span class="o">==</span><span class="m">7</span>.6.0
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>mappyfile
</pre>
            </div>
           </div>
           <p>
            Aufgrund eines Fehlers wird die C-lib nicht in die venv kopiert - wir m&uuml;ssen das also per Hand nachziehen
           </p>
           <p>
            Als root
           </p>
           <div class="highlight-shell notranslate">
            <div class="highlight">
             <pre><span></span>apt<span class="w"> </span>install<span class="w"> </span>python3-mapscript
</pre>
            </div>
           </div>
           <p>
            Als normaler User
           </p>
           <div class="highlight-shell notranslate">
            <div class="highlight">
             <pre><span></span><span class="nb">cd</span><span class="w"> </span>komserv2/.venv/lib/python3.9/site-packages/mapscript
cp<span class="w"> </span>/usr/lib/python3/dist-packages/mapscript/_mapscript.cpython-39-x86_64-linux-gnu.so<span class="w"> </span>_mapscript.so
</pre>
            </div>
           </div>
          </section>
          <section id="mapfile-generator">
           <h4>
            Mapfile Generator
            <a class="headerlink" href="#mapfile-generator" title="Permalink to this heading">
             
            </a>
           </h4>
           <section id="ordnerstruktur">
            <h5>
             Ordnerstruktur
             <a class="headerlink" href="#ordnerstruktur" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             Der Mapfile Generator baut sich die initiale Konfigurationsdateien aus Templates auf. Die werden
in einer eigenen Ordnerstruktur unterhalb von komserv2/xplanung_light/ abgelegt.
            </p>
            <div class="highlight-shell notranslate">
             <div class="highlight">
              <pre><span></span>mkdir<span class="w"> </span>mapserver
mkdir<span class="w"> </span>mapserver/mapfile_templates
mkdir<span class="w"> </span>mapserver/templates
mkdir<span class="w"> </span>mapserver/mapfiles
</pre>
             </div>
            </div>
           </section>
           <section id="templates">
            <h5>
             Templates
             <a class="headerlink" href="#templates" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             komserv2/xplanung_light/mapserver/mapfile_templates/map_obj.map
            </p>
            <div class="highlight-text notranslate">
             <div class="highlight">
              <pre><span></span>MAP
    #NAME       "not needed"
    STATUS      ON
    SIZE        450 400
    EXTENT      7.293677 50.325436 7.303848 50.331546
    UNITS       METERS
    IMAGECOLOR  255 255 255
    #FONTSET     "/data/umn/fonts/fonts.txt"
    OUTPUTFORMAT
        NAME            "SHAPEZIP"
        DRIVER          "OGR/ESRI Shapefile"
        MIMETYPE        "application/zip"
        FORMATOPTION    "DSCO:SHAPEFILE=YES"
        FORMATOPTION    "FORM=zip"
        FORMATOPTION    "FILENAME=result.zip"
    END
    OUTPUTFORMAT
        NAME            "geojson"
        DRIVER          "OGR/GEOJSON"
        MIMETYPE        "application/json; subtype=geojson"
        FORMATOPTION    "STORAGE=memory"
        FORMATOPTION    "FORM=simple"
        FORMATOPTION    "FILENAME=result.geojson"
        FORMATOPTION    "LCO:COORDINATE_PRECISION=5"
    END
    OUTPUTFORMAT
        NAME            "CSV"
        DRIVER          "OGR/CSV"
        MIMETYPE        "text/csv"
        FORMATOPTION    "LCO:GEOMETRY=AS_WKT"
        FORMATOPTION    "STORAGE=filesystem"
        FORMATOPTION    "FORM=simple"
        FORMATOPTION    "FILENAME=result.csv"
    END
    WEB
        IMAGEPATH   "/tmp/"
        IMAGEURL    "/tmp/"
        METADATA
            "wms_feature_info_mime_type"        "text/html"
            "ows_name"                          "OWS.0723507001"
            "ows_title"                         "Kommunale Pl&auml;ne von Aach"
            "ows_onlineresource"                "http://127.0.0.1:8000/organization/1/ows/"
            "ows_srs"                           "EPSG:31466 EPSG:31467 EPSG:25832 EPSG:4326 EPSG:3857"
            "ows_enable_request"                "*"
            "ows_abstract"                      "Kommunale Pl&auml;ne von Aach ..."
            "ows_keywordlist"                   ""
            "ows_addresstype"                   "postal"
            "ows_contactorganization"           "Gemeinde/Stadt Aach"
            "ows_contactperson"                 ""
            "ows_address"                       ""
            "ows_city"                          ""
            "ows_stateorprovince"               "DE-RP"
            "ows_postcode"                      ""
            "ows_country"                       "DE"
            "ows_contactvoicetelephone"         ""
            "ows_contactfacsimiletelephone"     ""
            "ows_contactelectronicmailaddress"  ""
            "ows_encoding"                      "UTF-8"
            "ows_fees"                          "NONE"
            "wfs_getfeature_formatlist"         "OGRGML,SHAPEZIP,CSV,geojson"
        END
    END
    PROJECTION
        "init=epsg:4326"
    END
    LEGEND
        STATUS      ON
        KEYSIZE     12 12
        IMAGECOLOR  255 255 255
        LABEL
            TYPE    TRUETYPE
            #FONT    "Arial"
            SIZE    9
        END
    END
END
</pre>
             </div>
            </div>
            <p>
             komserv2/xplanung_light/mapserver/mapfile_templates/layer_obj.map
            </p>
            <div class="highlight-text notranslate">
             <div class="highlight">
              <pre><span></span>    LAYER
    	STATUS      ON
        NAME        "BPlan.0723507001.12"
        METADATA
            "wms_layer_group"           "/Bebauungspl&auml;ne"
            "wms_include_items"         "all"
            "ows_title"                 "testplan ohne rechtsstand"
            "ows_srs"                   "EPSG:31466 EPSG:31467 EPSG:25832 EPSG:4326 EPSG:3857"
            "ows_abstract"              "testplan ohne rechtsstand ..."
            "ows_keywordlist"           ""
            "ows_extent"                "7.293677 50.325436 7.303848 50.331546"
            "gml_include_items"         "all"
            "ows_metadataurl_href"      "https://geodaten.statistik.rlp.de/metadata/bev4_BEV4L1KREIS.xml"
            "ows_metadataurl_format"    "text/xml"
            "ows_metadataurl_type"      "TC211"
        END
        DUMP TRUE
        TEMPLATE        "xplanung_light/mapserver/templates/bplan.html"
        TYPE            POLYGON
        CONNECTIONTYPE 	OGR
   	    CONNECTION 	"db.sqlite3"
   	    DATA 		"xplanung_light_bplan"
   	    FILTER 		('[id]' = '10')
   	    PROCESSING 	"CLOSE_CONNECTION=DEFER" # for maximum performance
        PROJECTION
            "init=epsg:4326"
        END
        CLASSGROUP  "default"
    END
</pre>
             </div>
            </div>
            <p>
             komserv2/xplanung_light/mapserver/mapfile_templates/class_obj.map
            </p>
            <div class="highlight-text notranslate">
             <div class="highlight">
              <pre><span></span>        CLASS
			NAME 'Bebauungsplan'
			GROUP "default"
 			#EXPRESSION ([planart] = 1000)
			STYLE
				WIDTH 3
                COLOR 155 155 155
				OUTLINECOLOR 0 0 255
			END
		END
</pre>
             </div>
            </div>
            <p>
             Template f&uuml;r die GetFeatureInfo Operation:
            </p>
            <p>
             komserv2/xplanung_light/mapserver/templates/bplan.html
            </p>
            <div class="highlight-html notranslate">
             <div class="highlight">
              <pre><span></span><span class="cm">&lt;!-- MapServer Template --&gt;</span>
<span class="cp">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"</span>
<span class="cp">       "http://www.w3.org/TR/html4/transitional.dtd"&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>BPlan template<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    Name: [name]
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre>
             </div>
            </div>
           </section>
           <section id="generator-klasse">
            <h5>
             Generator Klasse
             <a class="headerlink" href="#generator-klasse" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             Um aus den Templates zur Laufzeit ein Mapfile zu bauen, ben&ouml;tigen wir eine kleine Klasse, die wir im helper-Verzeichnis ablegen.
            </p>
            <p>
             komserv2/xplanung_light/helper/mapfile.py
            </p>
            <div class="highlight-python notranslate">
             <div class="highlight">
              <pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">mappyfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdministrativeOrganization</span><span class="p">,</span> <span class="n">BPlan</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.gdal</span><span class="w"> </span><span class="kn">import</span> <span class="n">OGRGeometry</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">uuid</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MapfileGenerator</span><span class="p">():</span>

<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    https://github.com/geographika/mappyfile</span>
<span class="sd">    TODOs:</span>
<span class="sd">    * use database selection from settings.py instead hardcodes db.sqlite3</span>
<span class="sd">    """</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_mapfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">admin_orga_pk</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">ows_uri</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">metadata_uri</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">orga</span> <span class="o">=</span> <span class="n">AdministrativeOrganization</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">admin_orga_pk</span><span class="p">)</span>
        <span class="n">bplaene</span> <span class="o">=</span> <span class="n">BPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">gemeinde</span><span class="o">=</span><span class="n">admin_orga_pk</span><span class="p">)</span>
        <span class="c1"># open template</span>
        <span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="n">mappyfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">"../mapserver/mapfile_templates/map_obj.map"</span><span class="p">))</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Anpassen der Metadaten auf Service Level</span>
<span class="sd">        """</span>
        <span class="nb">map</span><span class="p">[</span><span class="s2">"web"</span><span class="p">][</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"ows_name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"OWS."</span> <span class="o">+</span> <span class="n">orga</span><span class="o">.</span><span class="n">ags</span>
        <span class="nb">map</span><span class="p">[</span><span class="s2">"web"</span><span class="p">][</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"ows_title"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Kommunale Pl&auml;ne von "</span> <span class="o">+</span> <span class="n">orga</span><span class="o">.</span><span class="n">name</span>
        <span class="nb">map</span><span class="p">[</span><span class="s2">"web"</span><span class="p">][</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"ows_onlineresource"</span><span class="p">]</span> <span class="o">=</span> <span class="n">ows_uri</span>
        <span class="c1"># load layer string from template</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">"../mapserver/mapfile_templates/layer_obj.map"</span><span class="p">))</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">layer_file_string</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">layer_from_template</span> <span class="o">=</span> <span class="n">mappyfile</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">layer_file_string</span><span class="p">)</span>
        <span class="c1"># load class for layer from template</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">"../mapserver/mapfile_templates/class_obj.map"</span><span class="p">))</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">class_file_string</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">class_from_template</span> <span class="o">=</span> <span class="n">mappyfile</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">class_file_string</span><span class="p">)</span>
        <span class="n">layer_class</span> <span class="o">=</span> <span class="n">class_from_template</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="nb">map</span><span class="p">[</span><span class="s1">'layers'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">layer_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">bplan</span> <span class="ow">in</span> <span class="n">bplaene</span><span class="p">:</span>
            <span class="n">layer_count</span> <span class="o">=</span> <span class="n">layer_count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="n">layer_from_template</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">bplan</span><span class="o">.</span><span class="n">nummer</span><span class="p">:</span>
                <span class="n">bplan_nummer</span> <span class="o">=</span> <span class="n">bplan</span><span class="o">.</span><span class="n">nummer</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bplan_nummer</span> <span class="o">=</span> <span class="s2">"lc_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">layer_count</span><span class="p">)</span>
                <span class="c1">#dynamic layer names are not so good ;-)</span>
                <span class="c1">#bplan_nummer = str(uuid.uuid4())</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BPlan."</span> <span class="o">+</span> <span class="n">orga</span><span class="o">.</span><span class="n">ags</span> <span class="o">+</span> <span class="s2">"."</span> <span class="o">+</span> <span class="n">bplan_nummer</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">layer_from_template</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s2">"ows_title"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Bebauungsplan "</span> <span class="o">+</span> <span class="n">bplan</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">" von "</span> <span class="o">+</span> <span class="n">orga</span><span class="o">.</span><span class="n">name</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s2">"ows_abstract"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Bebauungsplan "</span> <span class="o">+</span> <span class="n">bplan</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">" von "</span> <span class="o">+</span> <span class="n">orga</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">" ..."</span>
            <span class="c1">#layer["metadata"]["wms_extent"] = " ".join([str(i) for i in OGRGeometry(str(bplan.geltungsbereich), srs=4326).extent])</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s2">"ows_extent"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">OGRGeometry</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bplan</span><span class="o">.</span><span class="n">geltungsbereich</span><span class="p">),</span> <span class="n">srs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span><span class="o">.</span><span class="n">extent</span><span class="p">])</span>
            <span class="n">metadata</span><span class="p">[</span><span class="s2">"ows_metadataurl_href"</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata_uri</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"/1000000/"</span><span class="p">,</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bplan</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"/"</span><span class="p">)</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">"filter"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"( '[id]' = '"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bplan</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"' )"</span>
            <span class="n">layer</span><span class="p">[</span><span class="s2">"classes"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1">#print(str(layer_count) + ": " + bplan.geltungsbereich)</span>
            <span class="c1"># filter planart cause the others are not defined </span>
            <span class="c1">#if bplan.geltungsbereich and bplan.planart=="1000":</span>
            <span class="k">if</span> <span class="n">bplan</span><span class="o">.</span><span class="n">geltungsbereich</span><span class="p">:</span>
                <span class="n">layer</span><span class="p">[</span><span class="s2">"classes"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer_class</span><span class="p">)</span>
                <span class="nb">map</span><span class="p">[</span><span class="s2">"layers"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mappyfile</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </section>
          </section>
          <section id="ows-proxy">
           <h4>
            OWS Proxy
            <a class="headerlink" href="#ows-proxy" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            Mit Django bauen wir einen einfachen OWS-Proxy f&uuml;r den Mapserver in Form eines Function-based Views.
Die Generierung mit mappyfile dauert extrem lange, so dass es besser ist, den mapfile automatisch zu Cachen.
Hierzu verwenden wir djangos internes Cache Tool.
           </p>
           <section id="erweiterung-des-organisationsmodells-um-attribut-ags">
            <h5>
             Erweiterung des Organisationsmodells um Attribut
             <strong>
              ags
             </strong>
             <a class="headerlink" href="#erweiterung-des-organisationsmodells-um-attribut-ags" title="Permalink to this heading">
              
             </a>
            </h5>
            <div class="highlight-python notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># ...</span>
<span class="c1"># administrative organizations</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AdministrativeOrganization</span><span class="p">(</span><span class="n">GenericMetadata</span><span class="p">):</span>

    <span class="c1"># ...</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ls</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ks</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gs</span>
<span class="c1"># ...</span>

</pre>
             </div>
            </div>
           </section>
           <section id="view">
            <h5>
             View
             <a class="headerlink" href="#view" title="Permalink to this heading">
              
             </a>
            </h5>
            <p>
             komserv2/xplanung_light/views.py
            </p>
            <div class="highlight-python notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mapscript</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_qs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.helper.mapfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">MapfileGenerator</span>
<span class="c1"># for caching mapfiles ;-)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.core.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">cache</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>
<span class="c1"># ...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">ows</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
    <span class="n">orga</span> <span class="o">=</span> <span class="n">AdministrativeOrganization</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
    <span class="n">req</span> <span class="o">=</span>  <span class="n">mapscript</span><span class="o">.</span><span class="n">OWSRequest</span><span class="p">()</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    req.setParameter( 'SERVICE', 'WMS' )</span>
<span class="sd">    req.setParameter( 'VERSION', '1.1.0' )</span>
<span class="sd">    req.setParameter( 'REQUEST', 'GetCapabilities' )</span>
<span class="sd">    """</span>
    <span class="c1">#print(request.META['QUERY_STRING'])</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="p">[</span><span class="s1">'QUERY_STRING'</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">qs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1">#print(k)</span>
        <span class="c1">#print(v)</span>
        <span class="n">req</span><span class="o">.</span><span class="n">setParameter</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="c1">#print(req)</span>

    <span class="c1"># test wfs http://127.0.0.1:8000/organization/1/ows/?REQUEST=GetFeature&amp;VERSION=1.1.0&amp;SERVICE=wfs&amp;typename=BPlan.0723507001.12</span>
    <span class="c1">## first variant - fast - 0.07 seconds</span>
    
    <span class="c1">#map = mapscript.mapObj( '/home/armin/devel/django/komserv2/test.map' )</span>
    
    <span class="c1">## alternative approach - read from file into string and then from string with special path - also fast - 0.1 seconds</span>
    
    <span class="c1">#with open('/home/armin/devel/django/komserv2/test.map') as file:</span>
        <span class="c1">#map_file_string = file.read()</span>
    <span class="c1">#map = mapscript.msLoadMapFromString(map_file_string, '/home/armin/devel/django/komserv2/')</span>
    
    <span class="c1">## next alternative - slowest - 1.1 seconds</span>
    <span class="c1">#mapfile = mappyfile.open("/home/armin/devel/django/komserv2/test.map")</span>
    <span class="c1">#map = mapscript.msLoadMapFromString(mappyfile.dumps(mapfile), '/home/armin/devel/django/komserv2/')</span>

    <span class="c1">## next alternative - load from dynamically generated mapfile ;-)</span>
    <span class="n">mapfile_generator</span> <span class="o">=</span> <span class="n">MapfileGenerator</span><span class="p">()</span>
    <span class="n">metadata_uri</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">build_absolute_uri</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">'bplan-export-iso19139'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">"pk"</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">}))</span>
    <span class="c1"># test to read mapfile from cache</span>
    <span class="k">if</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"mapfile_"</span> <span class="o">+</span> <span class="n">orga</span><span class="o">.</span><span class="n">ags</span><span class="p">):</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">touch</span><span class="p">(</span><span class="s2">"mapfile_"</span> <span class="o">+</span> <span class="n">orga</span><span class="o">.</span><span class="n">ags</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">mapfile</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"mapfile_"</span> <span class="o">+</span> <span class="n">orga</span><span class="o">.</span><span class="n">ags</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mapfile</span> <span class="o">=</span> <span class="n">mapfile_generator</span><span class="o">.</span><span class="n">generate_mapfile</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">build_absolute_uri</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">'ows'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">"pk"</span><span class="p">:</span> <span class="n">pk</span><span class="p">})),</span> <span class="n">metadata_uri</span><span class="p">)</span>
        <span class="n">cache</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"mapfile_"</span> <span class="o">+</span> <span class="n">orga</span><span class="o">.</span><span class="n">ags</span><span class="p">,</span> <span class="n">mapfile</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="c1">#print(mapfile)</span>
    <span class="nb">map</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">msLoadMapFromString</span><span class="p">(</span><span class="n">mapfile</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">BASE_DIR</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"/"</span><span class="p">)</span> 
    <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_installStdoutToBuffer</span><span class="p">()</span>
    <span class="n">dispatch_status</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">OWSDispatch</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dispatch_status</span> <span class="o">!=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">MS_SUCCESS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dispatch_status</span> <span class="o">==</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">MS_DONE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">"No valid OWS Request!"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dispatch_status</span> <span class="o">==</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">MS_FAILURE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">"No valid OWS Request not successfully processed!"</span><span class="p">)</span>
    
    <span class="n">content_type</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_stripStdoutBufferContentType</span><span class="p">()</span>
    <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_stripStdoutBufferContentHeaders</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">mapscript</span><span class="o">.</span><span class="n">msIO_getStdoutBufferBytes</span><span class="p">()</span>
    <span class="c1"># [('Content-Type', 'application/vnd.ogc.wms_xml; charset=UTF-8'), ('Content-Length', '11385')]</span>
    <span class="n">response_headers</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">'Content-Type'</span><span class="p">,</span> <span class="n">content_type</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">'Content-Length'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))]</span>

    <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">response_headers</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="n">http_response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">http_response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Content-Type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_type</span>
    <span class="n">http_response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">'Content-Length'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">http_response</span>
</pre>
             </div>
            </div>
           </section>
          </section>
          <section id="uri">
           <h4>
            URI
            <a class="headerlink" href="#uri" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            Die URL zum OWS-Proxy muss noch in die urls.py - hier wird ein Dienst pro Organisation erstellt.
           </p>
           <p>
            komserv2/xplanung_light/urls.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># ows proxy for organization</span>
    <span class="c1"># ....</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"organization/&lt;int:pk&gt;/ows/"</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ows</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ows"</span><span class="p">),</span>
    <span class="c1"># ...</span>
</pre>
            </div>
           </div>
          </section>
         </section>
         <section id="anzeige-der-getcapabilities-urls">
          <h3>
           Anzeige der GetCapabilities URLs
           <a class="headerlink" href="#anzeige-der-getcapabilities-urls" title="Permalink to this heading">
            
           </a>
          </h3>
          <section id="uris">
           <h4>
            URIs
            <a class="headerlink" href="#uris" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            Anlegen der Endpunkte f&uuml;r die OGC-Dienste und einer &Uuml;bersichtsseite um die Endpunkte anzuzeigen.
           </p>
           <p>
            komserv2/xplanung_light/urls.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdministrativeOrganizationPublishingListView</span>
<span class="c1"># ...</span>
    <span class="c1"># urls for administrativeorganization</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"organization/publishing/"</span><span class="p">,</span> <span class="n">AdministrativeOrganizationPublishingListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"organization-publishing-list"</span><span class="p">),</span>
    <span class="c1"># ows proxy for organization</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"organization/&lt;int:pk&gt;/ows/"</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ows</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ows"</span><span class="p">),</span>
    <span class="c1"># ...</span>
</pre>
            </div>
           </div>
          </section>
          <section id="template">
           <h4>
            Template
            <a class="headerlink" href="#template" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            komserv2/xplanung_light/templates/xplanung_light/orga_publishing_list.html
           </p>
           <div class="highlight-jinja notranslate">
            <div class="highlight">
             <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">leaflet_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Liste der Publizierenden Organisationen</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">render_table</span> <span class="nv">from</span> <span class="nv">django_tables2</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;!-- add boostrap form css --&gt;</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">django_bootstrap5</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">render_table</span> <span class="nv">table</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Anzahl: </span><span class="cp">{{</span> <span class="nv">object_list.count</span> <span class="cp">}}</span><span class="x">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
            </div>
           </div>
          </section>
          <section id="tabelle">
           <h4>
            Tabelle
            <a class="headerlink" href="#tabelle" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            komserv2/xplanung_light/tables.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># ...</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tables</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlan</span><span class="p">,</span> <span class="n">AdministrativeOrganization</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">A</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.html</span><span class="w"> </span><span class="kn">import</span> <span class="n">format_html</span>
<span class="c1"># ...</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AdministrativeOrganizationPublishingTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
    <span class="n">num_bplan</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s2">"Zahl BPl&auml;ne"</span><span class="p">)</span>
    <span class="n">wms</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'ows'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'WMS'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">wfs</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'ows'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'WFS'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>

    <span class="c1"># https://stackoverflow.com/questions/36698387/how-to-add-get-parameters-to-django-tables2-linkcolumn</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">render_wms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">'ows'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">'pk'</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span><span class="s1">'&lt;a href="</span><span class="si">{}</span><span class="s1">?REQUEST=GetCapabilities&amp;SERVICE=WMS"&gt;</span><span class="si">{}</span><span class="s1">&lt;/a&gt;'</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s1">'WMS GetCapabilities'</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">render_wfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">'ows'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">'pk'</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span><span class="s1">'&lt;a href="</span><span class="si">{}</span><span class="s1">?REQUEST=GetCapabilities&amp;SERVICE=WFS"&gt;</span><span class="si">{}</span><span class="s1">&lt;/a&gt;'</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s1">'WFS GetCapabilities'</span><span class="p">)</span>


    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">AdministrativeOrganization</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s2">"django_tables2/bootstrap5.html"</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"ags"</span><span class="p">,</span> <span class="s2">"num_bplan"</span><span class="p">,</span> <span class="s2">"wms"</span><span class="p">,</span> <span class="s2">"wfs"</span><span class="p">,</span> <span class="p">)</span>
</pre>
            </div>
           </div>
          </section>
          <section id="id1">
           <h4>
            View
            <a class="headerlink" href="#id1" title="Permalink to this heading">
             
            </a>
           </h4>
           <p>
            komserv2/xplanung_light/views.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.tables</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlanTable</span><span class="p">,</span> <span class="n">AdministrativeOrganizationPublishingTable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Count</span>
<span class="c1"># ...</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AdministrativeOrganizationPublishingListView</span><span class="p">(</span><span class="n">SingleTableView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">AdministrativeOrganization</span>
    <span class="n">table_class</span> <span class="o">=</span> <span class="n">AdministrativeOrganizationPublishingTable</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'xplanung_light/orga_publishing_list.html'</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"orga-publishing-list"</span><span class="p">)</span> 

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">AdministrativeOrganization</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">bplan__isnull</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">num_bplan</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">'bplan'</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">qs</span>
</pre>
            </div>
           </div>
          </section>
         </section>
         <section id="anzeige-des-links-zu-den-publizierenden-organisationen">
          <h3>
           Anzeige des Links zu den Publizierenden Organisationen
           <a class="headerlink" href="#anzeige-des-links-zu-den-publizierenden-organisationen" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           komserv2/xplanung_light/templates/xplanung_light/layout.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;!-- ... --&gt;</span>
<span class="x">            &lt;ul class="navbar-nav me-auto mb-2 mb-lg-0"&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-list'</span> <span class="cp">%}</span><span class="x">"&gt;Bebauungspl&auml;ne&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'organization-publishing-list'</span> <span class="cp">%}</span><span class="x">"&gt;Publizierende Organisationen&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'about'</span> <span class="cp">%}</span><span class="x">"&gt;&Uuml;ber&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                  &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'admin:index'</span> <span class="cp">%}</span><span class="x">"&gt;Admin Backend&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">            &lt;/ul&gt;</span>
<span class="x">&lt;!-- ... --&gt;            </span>
</pre>
           </div>
          </div>
         </section>
         <section id="sortieren-der-bplane-nach-letzte-anderung-desc">
          <h3>
           Sortieren der BPl&auml;ne nach letzte &Auml;nderung desc
           <a class="headerlink" href="#sortieren-der-bplane-nach-letzte-anderung-desc" title="Permalink to this heading">
            
           </a>
          </h3>
          <p>
           Hier wird das HistoryModel zur Hilfe genommen - thx @jonas ;-)
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1"># ...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Count</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Subquery</span><span class="p">,</span> <span class="n">OuterRef</span>
<span class="c1"># ...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanListView</span><span class="p">(</span><span class="n">FilterView</span><span class="p">,</span> <span class="n">SingleTableView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">table_class</span> <span class="o">=</span> <span class="n">BPlanTable</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'xplanung_light/bplan_list.html'</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 
    <span class="n">filterset_class</span> <span class="o">=</span> <span class="n">BPlanFilter</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">"markers"</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
            <span class="n">serialize</span><span class="p">(</span><span class="s2">"geojson"</span><span class="p">,</span> <span class="n">context</span><span class="p">[</span><span class="s1">'table'</span><span class="p">]</span><span class="o">.</span><span class="n">page</span><span class="o">.</span><span class="n">object_list</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">geometry_field</span><span class="o">=</span><span class="s1">'geltungsbereich'</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">BPlan</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s1">'gemeinde'</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">last_changed</span><span class="o">=</span><span class="n">Subquery</span><span class="p">(</span>
            <span class="n">BPlan</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">OuterRef</span><span class="p">(</span><span class="s2">"pk"</span><span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">'-history_date'</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">'history_date'</span><span class="p">)[:</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">))</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">'-last_changed'</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span> <span class="o">=</span> <span class="n">BPlanFilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">,</span> <span class="n">queryset</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_set</span><span class="o">.</span><span class="n">qs</span>
<span class="c1"># ...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="screenshots">
          <h3>
           Screenshots
           <a class="headerlink" href="#screenshots" title="Permalink to this heading">
            
           </a>
          </h3>
          <section id="liste-der-bebauungsplane">
           <h4>
            <a class="reference external" href="http://127.0.0.1:8000/bplan/">
             Liste der Bebauungspl&auml;ne
            </a>
            <a class="headerlink" href="#liste-der-bebauungsplane" title="Permalink to this heading">
             
            </a>
           </h4>
           <a class="bg-primary reference internal image-reference" href="_images/bplan_list_2.png">
            <img alt="Liste der Bebauungspl&auml;ne" class="bg-primary align-center" src="_images/bplan_list_2.png" style="width: 800px;"/>
           </a>
          </section>
          <section id="liste-der-publizierenden-orgas">
           <h4>
            <a class="reference external" href="http://127.0.0.1:8000/organization/publishing/">
             Liste der publizierenden Orgas
            </a>
            <a class="headerlink" href="#liste-der-publizierenden-orgas" title="Permalink to this heading">
             
            </a>
           </h4>
           <a class="bg-primary reference internal image-reference" href="_images/wms_list.png">
            <img alt="Liste der publizierenden Orgas" class="bg-primary align-center" src="_images/wms_list.png" style="width: 800px;"/>
           </a>
          </section>
          <section id="wms-getcapabilities">
           <h4>
            <a class="reference external" href="http://127.0.0.1:8000/organization/1/ows/?REQUEST=GetCapabilities&amp;amp;SERVICE=WMS">
             WMS GetCapabilities
            </a>
            <a class="headerlink" href="#wms-getcapabilities" title="Permalink to this heading">
             
            </a>
           </h4>
           <a class="bg-primary reference internal image-reference" href="_images/wms_capabilities.png">
            <img alt="WMS GetCapabilities" class="bg-primary align-center" src="_images/wms_capabilities.png" style="width: 800px;"/>
           </a>
          </section>
          <section id="einbindung-in-client">
           <h4>
            Einbindung in Client
            <a class="headerlink" href="#einbindung-in-client" title="Permalink to this heading">
             
            </a>
           </h4>
           <a class="bg-primary reference internal image-reference" href="_images/wms_mapbender.png">
            <img alt="WMS in Javascript-Client" class="bg-primary align-center" src="_images/wms_mapbender.png" style="width: 800px;"/>
           </a>
          </section>
         </section>
        </section>
       </div>
      </section>
      <div class="clearer">
      </div>
     </div>
    </div>
   </div>
   <div class="clearer">
   </div>
  </div>
  <article id="back-cover">
   <div class="container">
    <div class="back-cover-footer">
     <p>
      &copy; Copyright 2025, Armin Retterath.
     </p>
     <p>
      Created using
      <a href="http://sphinx-doc.org/">
       Sphinx
      </a>
      6.2.1.
     </p>
    </div>
   </div>
  </article>
 </body>
</html>

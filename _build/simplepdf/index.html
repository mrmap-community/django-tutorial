<!DOCTYPE html>
<html data-content_root="./" lang="de">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   GeoDjango Tutorial 0.1 Dokumentation
  </title>
  <link href="_static/pygments.css?v=d75fae25" rel="stylesheet" type="text/css"/>
  <link href="_static/main.css?v=0eace31b" rel="stylesheet" type="text/css"/>
  <script src="_static/jquery.js?v=5d32c60e">
  </script>
  <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c">
  </script>
  <script src="_static/documentation_options.js?v=28a7ff9f">
  </script>
  <script src="_static/doctools.js?v=9a2dae69">
  </script>
  <script src="_static/sphinx_highlight.js?v=dc90522c">
  </script>
  <script src="_static/translations.js?v=79cc9f76">
  </script>
  <link href="genindex.html" rel="index" title="Stichwortverzeichnis"/>
  <link href="search.html" rel="search" title="Suche"/>
 </head>
 <body>
  <article class="dont-break" id="cover">
   <div class="container">
    <!-- Logo -->
    <div class="logo">
     <p>
     </p>
    </div>
    <!-- Cover middle -->
    <div class="cover-middle">
     <div class="title">
      <h1 class="title-cover">
       GeoDjango Tutorial
      </h1>
      <p class="subtitle-cover">
       Version
      </p>
      <span class="meta">
      </span>
     </div>
     <!--
      <div class="client-logo">
        <img src="../data/logo_.png" alt="Logotipo">
      </div>
      -->
    </div>
    <!-- Footer -->
    <div class="cover-footer">
     <p>
     </p>
    </div>
   </div>
  </article>
  <div aria-label="Main" class="sphinxsidebar" role="navigation">
   <div class="sphinxsidebarwrapper">
    <div>
     <h3>
      <a href="#">
       Inhaltsverzeichnis
      </a>
     </h3>
     <p class="caption" role="heading">
      <span class="caption-text">
       Einf&uuml;hrung
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#einfuhrung">
        Einf&uuml;hrung
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#weitere-informationen">
        Weitere Informationen
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#beispielimplementierungen">
        Beispielimplementierungen
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#beispiel-hosting-bw-komm-one-wfs-abgabe-bplan-in-rasterform">
          Beispiel Hosting BW Komm.ONE - WFS Abgabe BPlan in Rasterform
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#netgis-mannheim">
          Netgis Mannheim
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#leitfaden">
        Leitf&auml;den
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Vorarbeiten
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#installation-der-python-umgebung">
        Installation der Python Umgebung
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#benotigte-software">
          Ben&ouml;tigte Software
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#los-geht-s-am-terminal">
          Los geht&rsquo;s am Terminal
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#vscode-einrichten-uber-oberflache">
          VSCODE einrichten &uuml;ber Oberfl&auml;che
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#weitere-infos">
          Weitere Infos
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#django-projekt-initialisieren-standard-terminal-oder-vscode-terminal">
        Django Projekt initialisieren (Standard-Terminal oder VSCODE-Terminal)
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Rahmen f&uuml;r Anwendung
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#erste-schritte">
        Erste Schritte
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#startseite-anpassen-einfache-functionbasedview">
          Startseite anpassen (einfache FunctionBasedView)
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#ausprobieren-der-admin-oberflache-und-der-startseite">
          Ausprobieren der Admin Oberfl&auml;che und der Startseite
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#erstellung-erster-versionen-der-templates">
        Erstellung erster Versionen der Templates
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#basis-template-xplanung-light-templates-xplanung-light-layout-html">
          Basis Template xplanung_light/templates/xplanung_light/layout.html
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#anpassung-der-views">
          Anpassung der views
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#template-fur-home-xplanung-light-templates-xplanung-light-home-html">
          Template f&uuml;r home - xplanung_light/templates/xplanung_light/home.html
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#template-fur-about-xplanung-light-templates-xplanung-light-about-html">
          Template f&uuml;r about - xplanung_light/templates/xplanung_light/about.html
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#nutzung-von-standardfunktionen-des-auth-packages-fur-anmeldung-und-registrierung">
        Nutzung von Standardfunktionen des auth packages f&uuml;r Anmeldung und Registrierung
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#anpassung-der-pfade-in-xplanung-light-urls-py">
          Anpassung der Pfade in xplanung_light/urls.py
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#html-templates">
          HTML-Templates
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#formular-fur-registrierung">
          Formular f&uuml;r Registrierung
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#anpassung-der-views">
          Anpassung der views
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#stylesheets-optimieren">
          Stylesheets optimieren
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#was-wir-bisher-haben">
          Was wir bisher haben
         </a>
        </li>
       </ul>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Responsive Design
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#integration-von-bootstrap5">
        Integration von bootstrap5
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Datenmodelle
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#vorbereitung">
        Vorbereitung
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#historie">
          Historie
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#spatial-data">
          Spatial Data
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#organisationsmodell">
        Organisationsmodell
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#einleitung">
          Einleitung
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#modelldefinition">
          Modelldefinition
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#datenimport">
          Datenimport
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#planmodell">
        Planmodell
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#einleitung">
          Einleitung
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#modelldefinition">
          Modelldefinition
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#verwaltungsviews">
          Verwaltungsviews
         </a>
        </li>
       </ul>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Optimieren der Views
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#geometrie-editor">
        Geometrie Editor
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#aktivieren-des-leaflet-clients-in-den-views">
          Aktivieren des Leaflet-Clients in den Views
         </a>
        </li>
       </ul>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#tabellenanzeige">
        Tabellenanzeige
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#anpassung-templates">
        Anpassung Templates
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Leaflet Konfiguration
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#zentrale-konfiguration">
        Zentrale Konfiguration
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#wms-layer-hinzufugen">
        WMS Layer hinzuf&uuml;gen
       </a>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Export XPlanung
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#xplanung-gml-export">
        XPlanung GML Export
       </a>
       <ul>
        <li class="toctree-l2">
         <a class="reference internal" href="#export-xml-view">
          Export XML View
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#url-fur-export">
          URL f&uuml;r Export
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#link-in-table-view">
          Link in Table View
         </a>
        </li>
        <li class="toctree-l2">
         <a class="reference internal" href="#xml-template">
          XML Template
         </a>
        </li>
       </ul>
      </li>
     </ul>
     <p class="caption" role="heading">
      <span class="caption-text">
       Ergebnis
      </span>
     </p>
     <ul>
      <li class="toctree-l1">
       <a class="reference internal" href="#zusammenfassung">
        Zusammenfassung
       </a>
      </li>
      <li class="toctree-l1">
       <a class="reference internal" href="#todos">
        TODOs
       </a>
      </li>
     </ul>
    </div>
   </div>
  </div>
  <div class="document">
   <div class="documentwrapper">
    <div class="bodywrapper">
     <div class="body" role="main">
      <section id="geodjango-tutorial">
       <h1>
        GeoDjango Tutorial
        <a class="headerlink" href="#geodjango-tutorial" title="Link to this heading">
         
        </a>
       </h1>
       <div class="toctree-wrapper compound">
        <span id="document-introduction">
        </span>
        <section id="einfuhrung">
         <h2>
          Einf&uuml;hrung
          <a class="headerlink" href="#einfuhrung" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          Das Tutorial soll an einem konkreten Beispiel zeigen, wie man mit Django in relativ kurzer Zeit eine einfache Anwendung zur Verwaltung von Geodaten erstellen kann. Als Beispiel werden hier kommunale Bauleitpl&auml;ne genommen.
         </p>
         <p>
          Die Anwendung verf&uuml;gt &uuml;ber folgende Funktionen/Eigenschaften:
         </p>
         <ul class="simple">
          <li>
           <p>
            Nutzung der Django-Standardbenutzerverwaltung f&uuml;r Registrierung und Authentifizierung
           </p>
          </li>
          <li>
           <p>
            Import der rheinland-pf&auml;lzischen Gebietsk&ouml;rperschaften mit deren geometrischen Abgrenzungen
           </p>
          </li>
          <li>
           <p>
            Historisierung der Gebietsk&ouml;rperschaften
           </p>
          </li>
          <li>
           <p>
            Erstellen, Editieren, L&ouml;schen von Bebauungspl&auml;nen mit Referenzen auf die Gebietsk&ouml;rperschaften
           </p>
          </li>
          <li>
           <p>
            Editieren multipolygonaler Abgrenzungen von Geltungsbereichen der Bebauungspl&auml;ne
           </p>
          </li>
          <li>
           <p>
            Layout mit bootstrap5 optimiert (responsive)
           </p>
          </li>
          <li>
           <p>
            Export von konformen XPlan-GML Dateien
           </p>
          </li>
         </ul>
         <p>
          Verwendete Django packages:
         </p>
         <ul class="simple">
          <li>
           <p>
            django-bootstrap5
           </p>
          </li>
          <li>
           <p>
            django-simple-history
           </p>
          </li>
          <li>
           <p>
            django-leaflet
           </p>
          </li>
          <li>
           <p>
            django-tables2
           </p>
          </li>
         </ul>
        </section>
        <section id="weitere-informationen">
         <h2>
          Weitere Informationen
          <a class="headerlink" href="#weitere-informationen" title="Link to this heading">
           
          </a>
         </h2>
         <ul class="simple">
          <li>
           <p>
            <a class="reference external" href="https://www.djangoproject.com/">
             django
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://xleitstelle.de/releases/objektartenkatalog_6_0">
             xplanung
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.statistik.rlp.de/publikationen/verzeichnisse-und-adressarien">
             Gebietsk&ouml;rperschaften RLP
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.geoportal.rlp.de/mediawiki/images/c/c7/Leitfaden_Bereitstellung_komm_Plaene.pdf">
             Leitfaden kommunale Pl&auml;ne GDI-RP
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://gitlab.opencode.de/xleitstelle/xplanung/testdaten">
             Testdaten xleitstelle
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://gitlab.opencode.de/diplanung/ozgxplanung/-/tree/xplanbox-7.1.3/xplan-tests/xplan-tests-resources/src/main/resources/de/latlon/xplan/xplan60?ref_type=tags">
             Beispiel Dateien XPlanung 6.0
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://github.com/kreis-viersen/xplan-reader/">
             QGIS XPlan-Reader
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://github.com/kreis-viersen/xplan-umring">
             QGIS XPlan-Umring
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.xplanungsplattform.de/xplan-validator/">
             Validator - alt
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://xleitstelle.de/validator">
             Validator -neu
            </a>
           </p>
          </li>
         </ul>
        </section>
        <section id="beispielimplementierungen">
         <h2>
          Beispielimplementierungen
          <a class="headerlink" href="#beispielimplementierungen" title="Link to this heading">
           
          </a>
         </h2>
         <section id="beispiel-hosting-bw-komm-one-wfs-abgabe-bplan-in-rasterform">
          <h3>
           Beispiel Hosting BW
           <a class="reference external" href="https://www.komm.one/wer-wir-sind">
            Komm.ONE
           </a>
           - WFS Abgabe BPlan in Rasterform
           <a class="headerlink" href="#beispiel-hosting-bw-komm-one-wfs-abgabe-bplan-in-rasterform" title="Link to this heading">
            
           </a>
          </h3>
          <table class="docutils align-default">
           <thead>
            <tr class="row-odd">
             <th class="head">
              <p>
               Link
              </p>
             </th>
             <th class="head">
              <p>
               Operation
              </p>
             </th>
             <th class="head">
              <p>
               Erl&auml;uterung
              </p>
             </th>
            </tr>
           </thead>
           <tbody>
            <tr class="row-even">
             <td>
              <p>
               <a class="reference external" href="https://geodienste.komm.one/ows/services/org.641.1b95f33f-e4f3-4898-bcba-8319409933fc_wfs/org.641.db827e93-33f7-4b4e-97ce-9772690d4b6b?SERVICE=WFS&amp;amp;Request=GetCapabilities">
                Eigenschaftsabfrage
               </a>
              </p>
             </td>
             <td>
              <p>
               GetCapabilities
              </p>
             </td>
             <td>
              <p>
               keine
              </p>
             </td>
            </tr>
            <tr class="row-odd">
             <td>
              <p>
               <a class="reference external" href="https://geodienste.komm.one/ows/services/org.641.1b95f33f-e4f3-4898-bcba-8319409933fc_wfs/org.641.db827e93-33f7-4b4e-97ce-9772690d4b6b?VERSION=2.0.0&amp;amp;SERVICE=WFS&amp;amp;typename=BP_Plan&amp;amp;Request=GetFeature">
                BP_Plan
               </a>
              </p>
             </td>
             <td>
              <p>
               GetFeature
              </p>
             </td>
             <td>
              <p>
               keine
              </p>
             </td>
            </tr>
            <tr class="row-even">
             <td>
              <p>
               <a class="reference external" href="https://geodienste.komm.one/ows/services/org.641.1b95f33f-e4f3-4898-bcba-8319409933fc_wfs/org.641.db827e93-33f7-4b4e-97ce-9772690d4b6b?VERSION=2.0.0&amp;amp;SERVICE=WFS&amp;amp;typename=XP_Rasterdarstellung&amp;amp;Request=GetFeature">
                XP_Rasterdarstellung
               </a>
              </p>
             </td>
             <td>
              <p>
               GetFeature
              </p>
             </td>
             <td>
              <p>
               keine
              </p>
             </td>
            </tr>
            <tr class="row-odd">
             <td>
              <p>
               <a class="reference external" href="https://geodienste.komm.one/ows/services/org.641.1b95f33f-e4f3-4898-bcba-8319409933fc_wfs/org.641.db827e93-33f7-4b4e-97ce-9772690d4b6b?SERVICE=WFS&amp;amp;VERSION=2.0.0&amp;amp;typename=BP_Bereich&amp;amp;Request=GetFeature">
                BP_Bereich
               </a>
              </p>
             </td>
             <td>
              <p>
               GetFeature
              </p>
             </td>
             <td>
              <p>
               keine
              </p>
             </td>
            </tr>
           </tbody>
          </table>
         </section>
         <section id="netgis-mannheim">
          <h3>
           Netgis Mannheim
           <a class="headerlink" href="#netgis-mannheim" title="Link to this heading">
            
           </a>
          </h3>
          <ul class="simple">
           <li>
            <p>
             <a class="reference external" href="https://service.gis-mannheim.de/mannheim/mod_plan_bw/">
              &Uuml;bersicht
             </a>
            </p>
           </li>
           <li>
            <p>
             <a class="reference external" href="https://service.gis-mannheim.de/mannheim/mod_plan_bw/get_xplan_gml.php?gmlid=GML_ef9a23ca-9613-d9b0-ac3e-2ff516bee276">
              Einzelner Plan
             </a>
            </p>
           </li>
          </ul>
         </section>
        </section>
        <section id="leitfaden">
         <h2>
          Leitf&auml;den
          <a class="headerlink" href="#leitfaden" title="Link to this heading">
           
          </a>
         </h2>
         <ul class="simple">
          <li>
           <p>
            <a class="reference external" href="https://www.stmb.bayern.de/assets/stmi/miniwebs/digitale_planung/xplanung_by_leitfaden_a4_pre.pdf">
             Bayern 10/2024
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.geoportal-bw.de/documents/d/guest/leitfaden_bauleitplan_v3-1">
             Baden-W&uuml;rttemberg 12/2022
            </a>
           </p>
           <ul>
            <li>
             <p>
              <a class="reference external" href="https://www.geoportal-bw.de/documents/d/guest/anlage1_v3_1_221215">
               Anlage
              </a>
             </p>
            </li>
           </ul>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://lbv.brandenburg.de/download/Raumbeobachtung/Pflichtenheft_2022.pdf">
             Brandenburg 05/2022
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://www.geoportal.rlp.de/mediawiki/images/c/c7/Leitfaden_Bereitstellung_komm_Plaene.pdf">
             Rheinland-Pfalz 10/2017
            </a>
           </p>
          </li>
          <li>
           <p>
            <a class="reference external" href="https://mid.sachsen-anhalt.de/fileadmin/Bibliothek/Politik_und_Verwaltung/MLV/MID/Ministerium/Publikationen/XPlanung-Leitfaden-Sachsen-Anhalt.pdf">
             Sachsen-Anhalt 03/2024
            </a>
           </p>
          </li>
         </ul>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-installation">
        </span>
        <section id="installation-der-python-umgebung">
         <h2>
          Installation der Python Umgebung
          <a class="headerlink" href="#installation-der-python-umgebung" title="Link to this heading">
           
          </a>
         </h2>
         <section id="benotigte-software">
          <h3>
           Ben&ouml;tigte Software
           <a class="headerlink" href="#benotigte-software" title="Link to this heading">
            
           </a>
          </h3>
          <ol class="arabic simple">
           <li>
            <p>
             VSCODE
            </p>
           </li>
           <li>
            <p>
             Virtuelle python Umgebung
            </p>
           </li>
           <li>
            <p>
             Internetzugang
            </p>
           </li>
          </ol>
         </section>
         <section id="los-geht-s-am-terminal">
          <h3>
           Los geht&rsquo;s am Terminal
           <a class="headerlink" href="#los-geht-s-am-terminal" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Verzeichnis anlegen
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>mkdir<span class="w"> </span>komserv2
</pre>
           </div>
          </div>
          <p>
           Ins Verzeichnis wechseln
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span><span class="nb">cd</span><span class="w"> </span>komserv2
</pre>
           </div>
          </div>
          <p>
           Virtuelle python-Umgebung anlegen
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
</pre>
           </div>
          </div>
          <p>
           Virtualle Umgebung aktivieren
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
</pre>
           </div>
          </div>
          <p>
           Paketmanager pip aktualisieren
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip
</pre>
           </div>
          </div>
          <p>
           Django installieren
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django
</pre>
           </div>
          </div>
          <p>
           VSCODE im Verzeichnis starten
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>code<span class="w"> </span>.
</pre>
           </div>
          </div>
         </section>
         <section id="vscode-einrichten-uber-oberflache">
          <h3>
           VSCODE einrichten &uuml;ber Oberfl&auml;che
           <a class="headerlink" href="#vscode-einrichten-uber-oberflache" title="Link to this heading">
            
           </a>
          </h3>
          <ol class="arabic simple">
           <li>
            <p>
             Python Umgebung w&auml;hlen
            </p>
           </li>
           <li>
            <p>
             Debugger konfigurieren - launch.json Datei in .vscode Ordner
            </p>
           </li>
          </ol>
          <div class="highlight-json notranslate">
           <div class="highlight">
            <pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Python Debugger: Django"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"debugpy"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">"runserver"</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">"django"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"autoStartBrowser"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">"program"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/manage.py"</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre>
           </div>
          </div>
          <ol class="arabic simple" start="3">
           <li>
            <p>
             Restart VSCODE - manchmal notwendig, um launch.json einlesen zu lassen
            </p>
           </li>
          </ol>
         </section>
         <section id="weitere-infos">
          <h3>
           Weitere Infos
           <a class="headerlink" href="#weitere-infos" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           https://code.visualstudio.com/docs/python/tutorial-django
          </p>
         </section>
        </section>
        <span id="document-initialize_project">
        </span>
        <section id="django-projekt-initialisieren-standard-terminal-oder-vscode-terminal">
         <h2>
          Django Projekt initialisieren (Standard-Terminal oder VSCODE-Terminal)
          <a class="headerlink" href="#django-projekt-initialisieren-standard-terminal-oder-vscode-terminal" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          Im Arbeitsverzeichnis komserv2 - venv aktiviert!
Django Boilerplate Code anlegen
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>django-admin<span class="w"> </span>startproject<span class="w"> </span>komserv<span class="w"> </span>.
</pre>
          </div>
         </div>
         <p>
          Erste App anlegen
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python<span class="w"> </span>manage.py<span class="w"> </span>startapp<span class="w"> </span>xplanung_light
</pre>
          </div>
         </div>
         <p>
          Datenbankschema erstellen und automatisch initiale SQLITE DB anlegen
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</pre>
          </div>
         </div>
         <p>
          Starten des Django-Servers auf lokalem Port 8000
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python<span class="w"> </span>manage.py<span class="w"> </span>runserver
</pre>
          </div>
         </div>
         <p>
          http://127.0.0.1:8000
         </p>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-first_steps">
        </span>
        <section id="erste-schritte">
         <h2>
          Erste Schritte
          <a class="headerlink" href="#erste-schritte" title="Link to this heading">
           
          </a>
         </h2>
         <section id="startseite-anpassen-einfache-functionbasedview">
          <h3>
           Startseite anpassen (einfache FunctionBasedView)
           <a class="headerlink" href="#startseite-anpassen-einfache-functionbasedview" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">"Hello, XPlanung!"</span><span class="p">)</span>
</pre>
           </div>
          </div>
          <p>
           urls.py erstellen: xplanung_light/urls.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"home"</span><span class="p">),</span>
<span class="p">]</span>
</pre>
           </div>
          </div>
          <p>
           Anpassung der Projekt urls.py: komserv/urls.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">"xplanung_light.urls"</span><span class="p">)),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)</span>
<span class="p">]</span>
</pre>
           </div>
          </div>
          <p>
           App xplanung_light zur Konfiguration in komserv/settings.py hinzuf&uuml;gen
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="c1"># Application definition</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1">#...</span>
    <span class="s1">'xplanung_light'</span><span class="p">,</span>
  <span class="c1">#...</span>
<span class="p">]</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           Erstellung der Verzeichnisse f&uuml;r staticfiles und templates - pwd: komserv2/xplanung_light/
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>mkdir<span class="w"> </span>templates
<span class="nb">cd</span><span class="w"> </span>templates
mkdir<span class="w"> </span>xplanung_light
<span class="nb">cd</span><span class="w"> </span>..
mkdir<span class="w"> </span>static
<span class="nb">cd</span><span class="w"> </span>static
mkdir<span class="w"> </span>xplanung_light
<span class="nb">cd</span><span class="w"> </span>..
</pre>
           </div>
          </div>
          <p>
           Erstellung eines minimalen stylesheets: xplanung_light/static/xplanung_light/site.css
          </p>
          <div class="highlight-css notranslate">
           <div class="highlight">
            <pre><span></span><span class="p">.</span><span class="nc">message</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">blue</span><span class="p">;</span>
<span class="p">}</span>
</pre>
           </div>
          </div>
          <p>
           Anlegen der Konfiguration f&uuml;r die Ablage der static files in komserv/settings.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'static_collected'</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           Kopieren der static files in die vorgesehenen Ordner
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>collectstatic
</pre>
           </div>
          </div>
          <p>
           Ausgabe
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span><span class="m">126</span><span class="w"> </span>static<span class="w"> </span>files<span class="w"> </span>copied<span class="w"> </span>to<span class="w"> </span><span class="s1">'XXX/komserv2/static_collected'</span>.
</pre>
           </div>
          </div>
          <p>
           Superuser anlegen
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>createsuperuser<span class="w"> </span>--username<span class="o">=</span>admin<span class="w"> </span>--email<span class="o">=</span>admin@example.com
</pre>
           </div>
          </div>
         </section>
         <section id="ausprobieren-der-admin-oberflache-und-der-startseite">
          <h3>
           Ausprobieren der Admin Oberfl&auml;che und der Startseite
           <a class="headerlink" href="#ausprobieren-der-admin-oberflache-und-der-startseite" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           dev-Server beenden (je nach Umgebung) und neu starten - jetzt am besten in VSCODE &uuml;ber F5 - Run-&gt;Start Debugging
          </p>
          <p>
           http://127.0.0.1:8000/
          </p>
          <p>
           http://127.0.0.1:8000/admin/
          </p>
         </section>
        </section>
        <span id="document-first_templates">
        </span>
        <section id="erstellung-erster-versionen-der-templates">
         <h2>
          Erstellung erster Versionen der Templates
          <a class="headerlink" href="#erstellung-erster-versionen-der-templates" title="Link to this heading">
           
          </a>
         </h2>
         <section id="basis-template-xplanung-light-templates-xplanung-light-layout-html">
          <h3>
           Basis Template xplanung_light/templates/xplanung_light/layout.html
           <a class="headerlink" href="#basis-template-xplanung-light-templates-xplanung-light-layout-html" title="Link to this heading">
            
           </a>
          </h3>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset="utf-8"/&gt;</span>
<span class="x">    &lt;meta name="description" content="Author: Armin Retterath, XPlanung, Django, Formular, Easy, kostenfrei, Open Source"/&gt;</span>
<span class="x">    &lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">&lt;/title&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>
<span class="x">    &lt;link rel="stylesheet" type="text/css" href="</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">'xplanung_light/site.css'</span> <span class="cp">%}</span><span class="x">"/&gt;</span>
<span class="x">    </span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;div class="navbar"&gt;</span>
<span class="x">    &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="x">" class="navbar-brand"&gt;XPlanung light&lt;/a&gt;</span>
<span class="x">    &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'about'</span> <span class="cp">%}</span><span class="x">" class="navbar-item"&gt;&Uuml;ber&lt;/a&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">        &lt;p&gt;</span>
<span class="x">            Angemeldeter Benutzer: </span><span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span><span class="x"> &lt;br&gt;</span>
<span class="x">            &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'logout'</span> <span class="cp">%}</span><span class="x">" class="navbar-item"&gt;Abmelden&lt;/a&gt;</span>
<span class="x">        &lt;/p&gt;</span>
<span class="x">        &lt;p&gt;&lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'admin:index'</span> <span class="cp">%}</span><span class="x">" &gt;Admin Backend&lt;/a&gt;&lt;/p&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">        &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="x">" class="navbar-item"&gt;Anmelden&lt;/a&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">&lt;/div&gt;</span>
<span class="x">&lt;div class="body-content"&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="x">    &lt;hr/&gt;</span>
<span class="x">    &lt;footer&gt;</span>
<span class="x">        &lt;p&gt;&amp;copy; 2025&lt;/p&gt;</span>
<span class="x">        &lt;p&gt;Letzte &Auml;nderung: 2025-04-04 11:40 Initiales Anlegen&lt;/p&gt;</span>
<span class="x">    &lt;/footer&gt;</span>
<span class="x">&lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre>
           </div>
          </div>
         </section>
         <section id="anpassung-der-views">
          <h3>
           Anpassung der views
           <a class="headerlink" href="#anpassung-der-views" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Function based views f&uuml;r home und about Seiten - xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>

<span class="k">def</span><span class="w"> </span><span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">"xplanung_light/home.html"</span><span class="p">)</span>
    
<span class="k">def</span><span class="w"> </span><span class="nf">about</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">"xplanung_light/about.html"</span><span class="p">)</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           url f&uuml;r about zu xplanung_light/urls.py hinzuf&uuml;gen
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="n">path</span><span class="p">(</span><span class="s2">"about/"</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">about</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"about"</span><span class="p">),</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="template-fur-home-xplanung-light-templates-xplanung-light-home-html">
          <h3>
           Template f&uuml;r home - xplanung_light/templates/xplanung_light/home.html
           <a class="headerlink" href="#template-fur-home-xplanung-light-templates-xplanung-light-home-html" title="Link to this heading">
            
           </a>
          </h3>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">Home</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Einfache Webanwendung zur Verwaltung kommunaler Pl&auml;ne gem&auml;&szlig; dem aktuellen Standard &lt;a href="https://xleitstelle.de/xplanung" target="_blank"&gt;XPlanung&lt;/a&gt;&lt;/p&gt;</span>
<span class="x">&lt;p&gt;Der Betreiber &uuml;bernimmt keinerlei Verantwortung f&uuml;r die Funktionsf&auml;higkeit und Zuverl&auml;ssigkeit der Anwendung. Es handelt sich nur um ein &lt;b&gt;Proof of Concept&lt;/b&gt;. Solange die Anwendung online ist, kann und darf sie von jedermann kostenfrei verwendet werden. F&uuml;r die Sicherheit der Daten wird ebenfalls keine Verantwortung &uuml;bernommen. Nutzer sollten nur ihre eigenen Daten sehen und editieren k&ouml;nnen. Das Projekt dient als Test zur Pr&uuml;fung von Funktionen des zugrundeliegenden Webframeworks &lt;a href="https://www.djangoproject.com/" target="_blank"&gt;Django&lt;/a&gt; und wurde innerhalb weniger Tage unter Nutzung von &lt;a href="https://docs.djangoproject.com/en/5.0/topics/class-based-views/generic-display/" target="_blank"&gt;class-based generic views&lt;/a&gt; umgesetzt ;-) .&lt;/p&gt;</span>
<span class="x">&lt;h4&gt;Funktionen&lt;/h4&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="x">    &lt;li&gt;...&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;...&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
<span class="x">&lt;h4&gt;Technische Informationen&lt;/h4&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="x">    &lt;li&gt;&lt;a href="#" target="_blank"&gt;Projekt auf GitHub&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;&lt;a href="#" target="_blank"&gt;Github Repo der ...&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;&lt;a href="#" target="_blank"&gt;Standard&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
<span class="x">&lt;h4&gt;Validatoren&lt;/h4&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="x">    &lt;li&gt;&lt;a href="#" target="_blank"&gt;...&lt;/a&gt;&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
           </div>
          </div>
         </section>
         <section id="template-fur-about-xplanung-light-templates-xplanung-light-about-html">
          <h3>
           Template f&uuml;r about - xplanung_light/templates/xplanung_light/about.html
           <a class="headerlink" href="#template-fur-about-xplanung-light-templates-xplanung-light-about-html" title="Link to this heading">
            
           </a>
          </h3>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">&Uuml;ber</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Anwendung zur einfachen Verwaltung von kommunalen Pl&auml;nen, konform zum deutschen Standard &lt;b&gt;XPlanung&lt;/b&gt;.&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
           </div>
          </div>
         </section>
        </section>
        <span id="document-add_login_register">
        </span>
        <section id="nutzung-von-standardfunktionen-des-auth-packages-fur-anmeldung-und-registrierung">
         <h2>
          Nutzung von Standardfunktionen des auth packages f&uuml;r Anmeldung und Registrierung
          <a class="headerlink" href="#nutzung-von-standardfunktionen-des-auth-packages-fur-anmeldung-und-registrierung" title="Link to this heading">
           
          </a>
         </h2>
         <section id="anpassung-der-pfade-in-xplanung-light-urls-py">
          <h3>
           Anpassung der Pfade in xplanung_light/urls.py
           <a class="headerlink" href="#anpassung-der-pfade-in-xplanung-light-urls-py" title="Link to this heading">
            
           </a>
          </h3>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
<span class="c1">#...</span>
<span class="n">path</span><span class="p">(</span><span class="s2">"accounts/login/"</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">next_page</span><span class="o">=</span><span class="s2">"home"</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"login"</span><span class="p">),</span>
<span class="n">path</span><span class="p">(</span><span class="s2">"accounts/logout/"</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LogoutView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">next_page</span><span class="o">=</span><span class="s2">"home"</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'logout'</span><span class="p">),</span>
<span class="c1"># https://dev.to/donesrom/how-to-set-up-django-built-in-registration-in-2023-41hg</span>
<span class="n">path</span><span class="p">(</span><span class="s2">"register/"</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"register"</span><span class="p">),</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="html-templates">
          <h3>
           HTML-Templates
           <a class="headerlink" href="#html-templates" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/templates/registration/login.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"../xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.errors</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Your username and password didn't match. Please try again.&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">next</span> <span class="cp">%}</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">    &lt;p&gt;Your account doesn't have access to this page. To proceed,</span>
<span class="x">    please login with an account that has access.&lt;/p&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">    &lt;p&gt;Please login to see this page.&lt;/p&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">&lt;form method="post" action="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="x">"&gt;</span>
<span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">&lt;table&gt;</span>
<span class="x">&lt;tr&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.username.label_tag</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.username</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">&lt;/tr&gt;</span>
<span class="x">&lt;tr&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.password.label_tag</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">form.password</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">&lt;/tr&gt;</span>
<span class="x">&lt;/table&gt;</span>
<span class="x">&lt;input type="submit" value="Einloggen"&gt;</span>
<span class="x">&lt;input type="hidden" name="next" value="</span><span class="cp">{{</span> <span class="nv">next</span> <span class="cp">}}</span><span class="x">"&gt;</span>
<span class="x">&lt;/form&gt;</span>
<span class="x">&lt;p&gt;Noch keinen Zugang? &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'register'</span> <span class="cp">%}</span><span class="x">" class="navbar-item"&gt;Hier Registrieren&lt;/a&gt;&lt;/p&gt;</span>
<span class="c">{# Assumes you set up the password_reset view in your URLconf #}</span>
<span class="c">{# &lt;p&gt;&lt;a href="{% url 'password_reset' %}"&gt;Lost password?&lt;/a&gt;&lt;/p&gt; #}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
           </div>
          </div>
          <p>
           xplanung_light/templates/registration/register.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"../xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">bootstrap4</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">bootstrap_css</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">bootstrap_javascript</span> <span class="nv">jquery</span><span class="o">=</span><span class="s1">'full'</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;h2&gt;Registrieren&lt;/h2&gt;</span>
<span class="x">    &lt;form method="post"&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span><span class="nv">form.as_p</span><span class="cp">}}</span>
<span class="x">        &lt;button type="submit"&gt;Registrieren&lt;/button&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
           </div>
          </div>
         </section>
         <section id="formular-fur-registrierung">
          <h3>
           Formular f&uuml;r Registrierung
           <a class="headerlink" href="#formular-fur-registrierung" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/forms.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django</span><span class="w"> </span><span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserCreationForm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RegistrationForm</span><span class="p">(</span><span class="n">UserCreationForm</span><span class="p">):</span>

    <span class="n">email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'username'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">,</span> <span class="s1">'password1'</span><span class="p">,</span> <span class="s1">'password2'</span><span class="p">]</span>
</pre>
           </div>
          </div>
         </section>
         <section id="anpassung-der-views">
          <h3>
           Anpassung der views
           <a class="headerlink" href="#anpassung-der-views" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.forms</span><span class="w"> </span><span class="kn">import</span> <span class="n">RegistrationForm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth</span><span class="w"> </span><span class="kn">import</span> <span class="n">login</span>
<span class="c1">#...</span>
<span class="c1"># https://dev.to/balt1794/registration-page-using-usercreationform-django-part-1-21j7</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">!=</span> <span class="s1">'POST'</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">RegistrationForm</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">RegistrationForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">'home'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">'form is invalid'</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'registration/register.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre>
           </div>
          </div>
         </section>
         <section id="stylesheets-optimieren">
          <h3>
           Stylesheets optimieren
           <a class="headerlink" href="#stylesheets-optimieren" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/static/xplanung_light/site.css
          </p>
          <div class="highlight-css notranslate">
           <div class="highlight">
            <pre><span></span><span class="c">/* ... */</span>
<span class="p">.</span><span class="nc">navbar</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="kc">lightslategray</span><span class="p">;</span>
<span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">em</span><span class="p">;</span>
<span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="s1">'Trebuchet MS'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Lucida Sans Unicode'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Lucida Grande'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Lucida Sans'</span><span class="p">,</span><span class="w"> </span><span class="n">Arial</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">white</span><span class="p">;</span>
<span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="w"> </span><span class="mi">8</span><span class="kt">px</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">navbar</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="kc">inherit</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">navbar-brand</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2</span><span class="kt">em</span><span class="p">;</span>
<span class="w">    </span><span class="k">font-weight</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">navbar-item</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">font-variant</span><span class="p">:</span><span class="w"> </span><span class="kc">small-caps</span><span class="p">;</span>
<span class="w">    </span><span class="k">margin-left</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">body-content</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="p">;</span>
<span class="w">    </span><span class="k">font-family</span><span class="p">:</span><span class="s1">'Segoe UI'</span><span class="p">,</span><span class="w"> </span><span class="n">Tahoma</span><span class="p">,</span><span class="w"> </span><span class="n">Geneva</span><span class="p">,</span><span class="w"> </span><span class="n">Verdana</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span>
<span class="p">}</span>
</pre>
           </div>
          </div>
         </section>
         <section id="was-wir-bisher-haben">
          <h3>
           Was wir bisher haben
           <a class="headerlink" href="#was-wir-bisher-haben" title="Link to this heading">
            
           </a>
          </h3>
          <ol class="arabic simple">
           <li>
            <p>
             Nutzung von Templates
            </p>
           </li>
           <li>
            <p>
             Einfache function based views
            </p>
           </li>
           <li>
            <p>
             Anwendnung von css
            </p>
           </li>
           <li>
            <p>
             Formulare
            </p>
           </li>
           <li>
            <p>
             Registrierung
            </p>
           </li>
           <li>
            <p>
             Authentifizierung
            </p>
           </li>
          </ol>
          <p>
           Dokumentation auf xplanung_light/templates/xplanung_light/home.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;!-- ... --&gt;</span>
<span class="x">&lt;h4&gt;Funktionen&lt;/h4&gt;</span>
<span class="x">&lt;ul&gt;</span>
<span class="x">    &lt;li&gt;Homepage&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;Authentifizierung gegen Datenbank&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;Registrierung&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;Admin-Backend&lt;/li&gt;</span>
<span class="x">    &lt;li&gt;...&lt;/li&gt;</span>
<span class="x">&lt;/ul&gt;</span>
<span class="x">&lt;!-- ... --&gt;</span>
</pre>
           </div>
          </div>
         </section>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-make_nicer">
        </span>
        <section id="integration-von-bootstrap5">
         <h2>
          Integration von bootstrap5
          <a class="headerlink" href="#integration-von-bootstrap5" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          <a class="reference external" href="https://django-bootstrap5.readthedocs.io/en/latest/">
           <strong>
            django-bootstrap5
           </strong>
          </a>
         </p>
         <p>
          Installation per pip
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python3<span class="w"> </span>-<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-bootstrap5
</pre>
          </div>
         </div>
         <p>
          Aktvieren in komserv/settings.py
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1">#...</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s1">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s1">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s1">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s1">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s1">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s1">'xplanung_light'</span><span class="p">,</span>
    <span class="s1">'django_bootstrap5'</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1">#...</span>
</pre>
          </div>
         </div>
         <p>
          Anpassen des Basis-Templates xplanung_light/templates/xplanung_light/layout.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="c">{# Load the tag library #}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">django_bootstrap5</span> <span class="cp">%}</span>

<span class="c">{# Load CSS and JavaScript #}</span>
<span class="cp">{%</span> <span class="k">bootstrap_css</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">bootstrap_javascript</span> <span class="cp">%}</span>

<span class="c">{# Display django.contrib.messages as Bootstrap alerts #}</span>
<span class="cp">{%</span> <span class="k">bootstrap_messages</span> <span class="cp">%}</span>
<span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset="utf-8"/&gt;</span>
<span class="x">    &lt;meta name="description" content="Author: Armin Retterath, XPlanung, Django, Formular, Easy, kostenfrei, Open Source"/&gt;</span>
<span class="x">    &lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x">&lt;/title&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>
<span class="x">    &lt;link rel="stylesheet" type="text/css" href="</span><span class="cp">{%</span> <span class="k">static</span> <span class="s1">'xplanung_light/site.css'</span> <span class="cp">%}</span><span class="x">"/&gt;    </span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;!-- https://getbootstrap.com/docs/5.0/components/navbar/ --&gt;</span>
<span class="x">    &lt;nav class="navbar navbar-expand-lg navbar-dark bg-dark"&gt;</span>
<span class="x">        &lt;div class="container-fluid"&gt;</span>
<span class="x">        &lt;a class="navbar-brand" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'home'</span> <span class="cp">%}</span><span class="x">"&gt;XPlanung light&lt;/a&gt;</span>
<span class="x">          &lt;button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation"&gt;</span>
<span class="x">            &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;</span>
<span class="x">          &lt;/button&gt;</span>
<span class="x">          &lt;div class="collapse navbar-collapse" id="navbarTogglerDemo01"&gt;</span>
<span class="x">            &lt;ul class="navbar-nav me-auto mb-2 mb-lg-0"&gt;</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'about'</span> <span class="cp">%}</span><span class="x">"&gt;&Uuml;ber&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                  &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'admin:index'</span> <span class="cp">%}</span><span class="x">"&gt;Admin Backend&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">            &lt;/ul&gt;</span>
<span class="x">            &lt;div class="d-flex"&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">                &lt;p&gt;</span>
<span class="x">                    Angemeldeter Benutzer: </span><span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span><span class="x"> &lt;br&gt;</span>
<span class="x">                    &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'logout'</span> <span class="cp">%}</span><span class="x">"&gt;Abmelden&lt;/a&gt;</span>
<span class="x">                &lt;/p&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">                &lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'login'</span> <span class="cp">%}</span><span class="x">"&gt;Anmelden&lt;/a&gt;</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">          &lt;/div&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/nav&gt;</span>
<span class="x">&lt;/div&gt;</span>
<span class="x">&lt;div class="body-content"&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="x">    &lt;hr/&gt;</span>
<span class="x">    &lt;footer&gt;</span>
<span class="x">        &lt;p&gt;&amp;copy; 2025&lt;/p&gt;</span>
<span class="x">        &lt;p&gt;Letzte &Auml;nderung: 2025-04-07 14:22 Bootstrap 5 Integration&lt;/p&gt;</span>
<span class="x">    &lt;/footer&gt;</span>
<span class="x">&lt;/div&gt;</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre>
          </div>
         </div>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-model_prerequisites">
        </span>
        <section id="vorbereitung">
         <h2>
          Vorbereitung
          <a class="headerlink" href="#vorbereitung" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          Neben der Verwaltung r&auml;umlicher Daten, wie z.B. den Zust&auml;ndigkeitsbereichen von Verwaltungen
und Geltungsbereichen von Pl&auml;nen beinhaltet das Modell organisatorische Zust&auml;ndigkeiten, die
einem zeitlichen Wandel unterliegen. Organisationsstrukturen k&ouml;nnne sich im Lauf von mehreren Jahren
&auml;ndern und daher ist es sinnvoll diese zu historisieren.
Man kann sich ein eigenes Historienkonzept &uuml;berlegen, oder man nutzt ein vorhandenes Package.
In diesem Fall wird
          <a class="reference external" href="https://django-simple-history.readthedocs.io/en/latest/">
           <strong>
            django-simple-history
           </strong>
          </a>
          genutzt.
         </p>
         <section id="historie">
          <h3>
           Historie
           <a class="headerlink" href="#historie" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Installation des packages
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-simple-history
</pre>
           </div>
          </div>
          <p>
           Aktivierung in komserv/settings.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">'simple_history'</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1">#...</span>
<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="s1">'simple_history.middleware.HistoryRequestMiddleware'</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           Migration des Datenmodells
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python3<span class="w"> </span>manage.py<span class="w"> </span>migrate
</pre>
           </div>
          </div>
         </section>
         <section id="spatial-data">
          <h3>
           Spatial Data
           <a class="headerlink" href="#spatial-data" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Da GeoDjango verwendet werden soll, m&uuml;ssen wir zun&auml;chst die Datenbank von SQLITE auf SPATIALITE &auml;ndern.
Hierzu reicht eine Anpassung in der globalen Konfigurationsdatei.
          </p>
          <p>
           Aktivierung in komserv/settings.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">#'ENGINE': 'django.db.backends.sqlite3',</span>
        <span class="s1">'ENGINE'</span><span class="p">:</span> <span class="s1">'django.contrib.gis.db.backends.spatialite'</span><span class="p">,</span>
        <span class="s1">'NAME'</span><span class="p">:</span> <span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s1">'db.sqlite3'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
           </div>
          </div>
          <p>
           Damit sind die Vorbreitungen auch schon abgeschlossen. Jetzt folgt die Definition der ben&ouml;tigten Datenmodelle.
          </p>
         </section>
        </section>
        <span id="document-organization_model">
        </span>
        <section id="organisationsmodell">
         <h2>
          Organisationsmodell
          <a class="headerlink" href="#organisationsmodell" title="Link to this heading">
           
          </a>
         </h2>
         <section id="einleitung">
          <h3>
           Einleitung
           <a class="headerlink" href="#einleitung" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Das initiale Modell f&uuml;r verantwortliche Organisationen soll die Gebietsk&ouml;rperschaften des Landes abbilden. Diese sind grunds&auml;tzlich hierarchisch geliedert und verf&uuml;gen &uuml;ber bundesweit einheitlich definierte Schl&uuml;ssel (AGS). Verantwortlich f&uuml;r die Bereitstellung der Struktur der Gebietsk&ouml;rperschaften ist in Rheinland-Pfalz das Statistische Landesamt. Dieses publiziert das s.g.
           <a class="reference external" href="https://www.statistik.rlp.de/fileadmin/statistik.rlp.de/Dokumente_und_Bilder/3_Produkte/3_Verzeichnisse/A1132_202201_ur_G.pdf">
            <strong>
             Amtliche Verzeichnis der Gemeinden und Gemeindeteile
            </strong>
           </a>
           in Form einer PDF-Datei. Leider l&auml;sst sich das nicht ohne weiteres automatisiert verarbeiten, es gibt jedoch auch ein
           <a class="reference external" href="https://www.statistik.rlp.de/fileadmin/statistik.rlp.de/Dokumente_und_Bilder/3_Produkte/3_Verzeichnisse/Kommunalverwaltungen_01.01_2025.xlsm">
            <strong>
             Verzeichnis der Kommunalverwaltungen, Oberb&uuml;rgermeister, Landr&auml;te und B&uuml;rgermeister
            </strong>
           </a>
           . Dieses wird als xslm Mappe publiziert und enth&auml;lt &uuml;ber verschiedene Tabellen verteilt die f&uuml;r unseren Zweck ben&ouml;tigte information.
          </p>
          <p>
           Wir ben&ouml;tigen sowohl Kontaktinformationen, als auch Adressen und Zust&auml;ndigkeitsbereiche. Die Zust&auml;ndigkeitsbereiche werden vom Landesamt f&uuml;r Vermessung und Geobasisinformation &uuml;ber eine OGC-WFS Schnittstelle publiziert und enthalten auch die jeweiligen einheitlichen AGS. Damit lassen sie sich automatisiert mit den Organisationen verkn&uuml;pfen.
Um das Modell nicht unn&ouml;tig kompliziwert zu machen, speichern wir alle Informationen zun&auml;chst in einem einfachen flachen Modell.
In Django werden Modelle pro App in einer Datei models.py abgelegt. In unserem Fall also xplanung_light/models.py. Da die Modelle python-Klassen sind, l&auml;sst sich vieles &uuml;ber Vererbung umsetzen. Wir definieren dazu einfach eine simple Klasse GenericMetadata, die zun&auml;chst einfach eine automatisch generierte UUID beinhaltet, die die davon abgeleiteteten Klassen erben.
Die Integration von django-simple-history ist sehr einfach und erfolgt durch das Attribut
           <strong>
            history = HistoricalRecords()
           </strong>
           .
          </p>
         </section>
         <section id="modelldefinition">
          <h3>
           Modelldefinition
           <a class="headerlink" href="#modelldefinition" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/models.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">simple_history.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">HistoricalRecords</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>

<span class="c1"># generic meta model</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GenericMetadata</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">generic_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">UUIDField</span><span class="p">(</span><span class="n">default</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">)</span>
    <span class="c1">#created = models.DateTimeField(null=True)</span>
    <span class="c1">#changed = models.DateTimeField(null=True)</span>
    <span class="c1">#deleted = models.DateTimeField(null=True)</span>
    <span class="c1">#active = models.BooleanField(default=True)</span>
    <span class="c1">#owned_by_user = models.ForeignKey(User, on_delete=models.CASCADE, null=True)</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>

<span class="w">    </span><span class="sd">"""def save(self, *args, **kwargs):</span>
<span class="sd">        self.owned_by_user= self.request.user</span>
<span class="sd">        super().save(*args, **kwargs)"""</span>


<span class="c1"># administrative organizations</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AdministrativeOrganization</span><span class="p">(</span><span class="n">GenericMetadata</span><span class="p">):</span>

    <span class="n">COUNTY</span> <span class="o">=</span> <span class="s2">"KR"</span>
    <span class="n">COUNTY_FREE_CITY</span> <span class="o">=</span> <span class="s2">"KFS"</span>
    <span class="n">COM_ASS</span> <span class="o">=</span> <span class="s2">"VG"</span>
    <span class="n">COM_ASS_FREE_COM</span> <span class="o">=</span> <span class="s2">"VFG"</span>
    <span class="n">COM</span> <span class="o">=</span> <span class="s2">"GE"</span>
    <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">"UK"</span>

    <span class="n">ADMIN_CLASS_CHOICES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">COUNTY</span><span class="p">,</span>  <span class="s2">"Landkreis"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">COUNTY_FREE_CITY</span><span class="p">,</span> <span class="s2">"Kreisfreie Stadt"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">COM_ASS</span><span class="p">,</span> <span class="s2">"Verbandsgemeinde"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">COM_ASS_FREE_COM</span><span class="p">,</span> <span class="s2">"Verbandsfreie Gemeinde"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">COM</span><span class="p">,</span> <span class="s2">"Gemeinde/Stadt"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">UNKNOWN</span><span class="p">,</span> <span class="s2">"unbekannt"</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">ls</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Landesschl&uuml;ssel'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Eindeutiger zweistelliger Schl&uuml;ssel f&uuml;r das Bundesland - RLP: 07'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'07'</span><span class="p">)</span>
    <span class="n">ks</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Kreisschl&uuml;ssel'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Eindeutiger dreistelliger Schl&uuml;ssel f&uuml;r den Landkreis'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'000'</span><span class="p">)</span>
    <span class="n">vs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Gemeindeverbandsschl&uuml;ssel'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Eindeutiger zweistelliger Schl&uuml;ssel f&uuml;r den Gemeindeverband'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'00'</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Gemeindeschl&uuml;ssel'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Eindeutiger dreistelliger Schl&uuml;ssel f&uuml;r die Gemeinde'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'000'</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Name der Gebietsk&ouml;rperschaft'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Offizieller Name der Gebietsk&ouml;rperschaft - z.B. Rhein-Lahn-Kreis'</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">ADMIN_CLASS_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'UK'</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Typ der Gebietsk&ouml;rperschaft'</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">address_street</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Stra&szlig;e mit Hausnummer'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Stra&szlig;e und Hausnummer'</span><span class="p">)</span>
    <span class="n">address_postcode</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Postleitzahl'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Postleitzahl'</span><span class="p">)</span>
    
    <span class="n">address_city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Stadt'</span><span class="p">)</span>
    <span class="n">address_phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Telefon'</span><span class="p">)</span>
    <span class="n">address_facsimile</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Fax'</span><span class="p">)</span>
    <span class="n">address_email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'EMail'</span><span class="p">)</span>
    <span class="n">address_homepage</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Homepage'</span><span class="p">)</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GeometryField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Gebiet'</span><span class="p">)</span>
    <span class="n">history</span> <span class="o">=</span> <span class="n">HistoricalRecords</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Returns a string representation of a administrative unit."""</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">' '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">'"</span>
</pre>
           </div>
          </div>
          <p>
           Migration
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>makemigrations
python3<span class="w"> </span>manage.py<span class="w"> </span>migrate
</pre>
           </div>
          </div>
         </section>
         <section id="datenimport">
          <h3>
           Datenimport
           <a class="headerlink" href="#datenimport" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Da die ben&ouml;tigten Daten f&uuml;r die Organisationen als xslm und in Form von Webservices bereitstehen, ben&ouml;tigen wir zwei weitere python-Bibliotheken.
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>openpyxl
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>requests
</pre>
           </div>
          </div>
          <p>
           Wir laden die xslm Datei zun&auml;chst h&auml;ndisch herunter und legen sie in unser Arbeitsverzeichnis.
          </p>
          <p>
           Die Funktionen f&uuml;r den Import speichern wir in xplanung_light/views.py. Hier ist wichtig, dass die Proxy-Einstellungen in der Datei angepasst werden. F&uuml;r produktive Zwecke ist es besser, die Proxy-Konfiguration in der zentralen Konfigurationsdatei abzulegen und zu importieren. Hierzu sp&auml;ter mehr.
          </p>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdministrativeOrganization</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.geos</span><span class="w"> </span><span class="kn">import</span> <span class="n">GEOSGeometry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">openpyxl</span><span class="w"> </span><span class="kn">import</span> <span class="n">Workbook</span><span class="p">,</span> <span class="n">load_workbook</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="c1">#...</span>

<span class="n">PROXIES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'http_proxy'</span><span class="p">:</span> <span class="s1">'http://xxx:8080'</span><span class="p">,</span>
    <span class="s1">'https_proxy'</span><span class="p">:</span> <span class="s1">'http://xxx:8080'</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_geometry</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">ags</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span><span class="s1">'KR'</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span><span class="s1">'KFS'</span><span class="p">:</span>
        <span class="n">base_uri</span> <span class="o">=</span> <span class="s2">"https://www.geoportal.rlp.de/spatial-objects/314/collections/vermkv:landkreise_rlp"</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'f'</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span> <span class="s1">'kreissch'</span><span class="p">:</span> <span class="n">ags</span><span class="p">[:</span><span class="mi">3</span><span class="p">]}</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span><span class="s1">'VG'</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span><span class="s1">'VFG'</span><span class="p">:</span>
        <span class="n">base_uri</span> <span class="o">=</span> <span class="s2">"https://www.geoportal.rlp.de/spatial-objects/314/collections/vermkv:verbandsgemeinde_rlp"</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'f'</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span> <span class="s1">'vgnr'</span><span class="p">:</span> <span class="n">ags</span><span class="p">[:</span><span class="mi">5</span><span class="p">]}</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">'GE'</span><span class="p">:</span>
        <span class="n">base_uri</span> <span class="o">=</span> <span class="s2">"https://www.geoportal.rlp.de/spatial-objects/314/collections/vermkv:gemeinde_rlp"</span>
        <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'f'</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span> <span class="s1">'ags'</span><span class="p">:</span> <span class="s2">"*7"</span> <span class="o">+</span> <span class="n">ags</span><span class="p">}</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">base_uri</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param_dict</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">PROXIES</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">base_uri</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">param_dict</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> 
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">'features'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">'geometry'</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">import_organisations</span><span class="p">():</span>
    <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="s1">'Kommunalverwaltungen_01.01_2025.xlsm'</span><span class="p">)</span>
    <span class="c1"># nuts-1 - bundeslandebene</span>
    <span class="c1"># nuts-2 - regierungsbezirke</span>
    <span class="c1"># nuts-3 - landkreisebene</span>
    <span class="c1"># lau-1 - verbandsgemeindeebene</span>
    <span class="c1"># lau-2 - gemeideebene</span>

    <span class="n">table_all_admin_units</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
    <span class="n">table_nuts_3_1</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">table_nuts_3_2</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">table_lau_1_1</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">table_lau_1_2</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
    <span class="c1"># table_lau_2 = wb.worksheets[10]</span>

    <span class="n">count_landkreise</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_kreisfreie_staedte</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_verbandsgemeinden</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_verbandsfreie_gemeinden</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_gemeinden</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># read landkreisebene</span>
    <span class="n">landkreisebene</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_nuts_3_1</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">landkreis</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'KR'</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'street'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'postcode'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'city'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'phone'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'facsimile'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
                <span class="n">landkreis</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'homepage'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"https://"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
                <span class="n">landkreisebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">landkreis</span>
                <span class="n">count_landkreise</span> <span class="o">=</span> <span class="n">count_landkreise</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>           
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_nuts_3_2</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kreisfreie_stadt</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'KFS'</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'street'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'postcode'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'city'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'phone'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'facsimile'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
                <span class="n">kreisfreie_stadt</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'homepage'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"https://"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
                <span class="n">landkreisebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">kreisfreie_stadt</span>
                <span class="n">count_kreisfreie_staedte</span> <span class="o">=</span> <span class="n">count_kreisfreie_staedte</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c1"># read verbandsgemeindeebene</span>
    <span class="n">verbandsgemeindeebene</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_lau_1_1</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vg</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'VG'</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'street'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'postcode'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'city'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'phone'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'facsimile'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'homepage'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"https://"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
                <span class="n">verbandsgemeindeebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">vg</span>
                <span class="n">count_verbandsgemeinden</span> <span class="o">=</span> <span class="n">count_verbandsgemeinden</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_lau_1_2</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vg</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'VFG'</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'street'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'postcode'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'city'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'phone'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'facsimile'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'email'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
                <span class="n">vg</span><span class="p">[</span><span class="s1">'address'</span><span class="p">][</span><span class="s1">'homepage'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"https://"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
                <span class="n">verbandsgemeindeebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">vg</span>
                <span class="n">count_verbandsfreie_gemeinden</span> <span class="o">=</span> <span class="n">count_verbandsfreie_gemeinden</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="c1">#print(json.dumps(landkreise))</span>
    <span class="n">all_admin_units</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table_all_admin_units</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">admin_unit</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'name'</span><span class="p">])</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'plz'</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'GE'</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'00'</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'000'</span><span class="p">:</span>
                    <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">landkreisebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s1">'type'</span><span class="p">]</span>
                    <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="n">landkreisebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s1">'address'</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'00'</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'000'</span><span class="p">:</span>
                    <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbandsgemeindeebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s1">'type'</span><span class="p">]</span>
                    <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'address'</span><span class="p">]</span> <span class="o">=</span> <span class="n">verbandsgemeindeebene</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="s1">'address'</span><span class="p">]</span>
                <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'geometry'</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_geometry</span><span class="p">(</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">all_admin_units</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">admin_unit</span>   
                <span class="c1">#save object to database</span>
                <span class="n">obj</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">AdministrativeOrganization</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update_or_create</span><span class="p">(</span>
                    <span class="n">ks</span><span class="o">=</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">],</span>
                    <span class="n">vs</span><span class="o">=</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">],</span>
                    <span class="n">gs</span><span class="o">=</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">],</span>
                    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">"ks"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'kr'</span><span class="p">],</span>
                        <span class="s2">"vs"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'vg'</span><span class="p">],</span>
                        <span class="s2">"gs"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'ge'</span><span class="p">],</span>
                        <span class="s2">"name"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="n">admin_unit</span><span class="p">[</span><span class="s1">'type'</span><span class="p">],</span>
                        <span class="s2">"geometry"</span><span class="p">:</span> <span class="n">GEOSGeometry</span><span class="p">(</span><span class="n">admin_unit</span><span class="p">[</span><span class="s1">'geometry'</span><span class="p">])</span>
                    <span class="p">},</span>
                <span class="p">)</span>
<span class="w">                </span><span class="sd">"""</span>
<span class="sd">                administration = AdministrativeOrganization()</span>
<span class="sd">                administration.ks = admin_unit['kr']</span>
<span class="sd">                administration.vs = admin_unit['vg']</span>
<span class="sd">                administration.gs = admin_unit['ge']</span>
<span class="sd">                administration.name = admin_unit['name']</span>
<span class="sd">                administration.type = admin_unit['type']</span>
<span class="sd">                administration.geometry = GEOSGeometry(admin_unit['geometry'])</span>
<span class="sd">                administration.save()</span>
<span class="sd">                """</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Landkreise:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count_landkreise</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Kreisfreie St&auml;dte:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count_kreisfreie_staedte</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Verbandsgemeinden:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count_verbandsgemeinden</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Verbandsfreie Gemeinden:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count_verbandsfreie_gemeinden</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre>
           </div>
          </div>
          <p>
           Der initiale Import wird einfach von der shell gestartet. Wir nutzen hier die Django shell, &uuml;ber die man direkten Zugriff auf die Funktionen im Projekt erh&auml;lt.
          </p>
          <div class="highlight-shell notranslate">
           <div class="highlight">
            <pre><span></span>python3<span class="w"> </span>manage.py<span class="w"> </span>shell
</pre>
           </div>
          </div>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">import_organisations</span>
<span class="n">import_organisations</span><span class="p">()</span>
</pre>
           </div>
          </div>
         </section>
        </section>
        <span id="document-plan_model">
        </span>
        <section id="planmodell">
         <h2>
          Planmodell
          <a class="headerlink" href="#planmodell" title="Link to this heading">
           
          </a>
         </h2>
         <section id="einleitung">
          <h3>
           Einleitung
           <a class="headerlink" href="#einleitung" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Das Modell zur Verwaltung von kommunalen Pl&auml;nen orientiert sich am deutschen Standard
           <a class="reference external" href="https://xleitstelle.de/xplanung">
            <strong>
             XPlanung
            </strong>
           </a>
           und am
           <a class="reference external" href="https://www.geoportal.rlp.de/metadata/Leitfaden_kommunale_Plaene_GDI_RP.pdf">
            <strong>
             Leitfaden f&uuml;r die Bereitstellung kommunaler Pl&auml;ne und Satzungen im Rahmen der Geodateninfrastruktur Rheinland-Pfalz (GDI-RP)
            </strong>
           </a>
           . Dieser Leitfaden wurde ab 2008 auf Basis von XPlanung 2.0 entwickelt. Neben den Vorgaben des Datenaustauschstandards wurden dabei auch Anforderungen aus der kommunalen Praxis &uuml;bernommen und eine standardisierte Bereitstellung vorgegeben. Der Standard wurde mit den kommunalen Spitzenverb&auml;nden des Landes abgestimmt und wird vom Lenkungsausschuss f&uuml;r Geodateninfrastruktur Rheinland-Pfalz herausgegeben.
          </p>
          <p>
           In einer ersten Version des Modells wird nur eine minimale Zahl von Attributen definiert. F&uuml;r den proof of concept (POC)  ist das zun&auml;chst ausreichend. Das abstrakte Grundmodell hei&szlig;t XPlan und vererbt seine Attribute auf das konkrete Modell BPlan. Der Geltungsbereich ist als Geometry-Field modelliert und kann damit auch Multipolygone aufnehmen.
          </p>
         </section>
         <section id="modelldefinition">
          <h3>
           Modelldefinition
           <a class="headerlink" href="#modelldefinition" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           xplanung_light/models.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="sd">"""</span>
<span class="sd">https://xleitstelle.de/releases/objektartenkatalog_6_0</span>
<span class="sd">"""</span>
<span class="k">class</span><span class="w"> </span><span class="nc">XPlan</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Name des Plans'</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">'Offizieller Name des raumbezogenen Plans'</span><span class="p">)</span>
    <span class="c1">#nummer [0..1]</span>
    <span class="n">nummer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">"Nummer des Plans."</span><span class="p">)</span>
    <span class="c1">#internalId [0..1]</span>
    <span class="c1">#beschreibung [0..1]</span>
    <span class="c1">#kommentar [0..1]</span>
    <span class="c1">#technHerstellDatum [0..1], Date</span>
    <span class="c1">#genehmigungsDatum [0..1], Date</span>
    <span class="c1">#untergangsDatum [0..1], Date</span>
    <span class="c1">#aendertPlan [0..*], XP_VerbundenerPlan</span>
    <span class="c1">#wurdeGeaendertVonPlan [0..*], XP_VerbundenerPlan</span>
    <span class="c1">#aendertPlanBereich [0..*], Referenz, Testphase</span>
    <span class="c1">#wurdeGeaendertVonPlanBereich [0..*], Referenz, Testphase</span>
    <span class="c1">#erstellungsMassstab [0..1], Integer</span>
    <span class="c1">#bezugshoehe [0..1], Length</span>
    <span class="c1">#hoehenbezug [0..1]</span>
    <span class="c1">#technischerPlanersteller, [0..1]</span>
    <span class="c1">#raeumlicherGeltungsbereich [1], GM_Object</span>
    <span class="n">geltungsbereich</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">GeometryField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Grenze des r&auml;umlichen Geltungsbereiches des Plans.'</span><span class="p">)</span>
    <span class="c1">#verfahrensMerkmale [0..*], XP_VerfahrensMerkmal</span>
    <span class="c1">#hatGenerAttribut [0..*], XP_GenerAttribut</span>
    <span class="c1">#externeReferenz, [0..*], XP_SpezExterneReferenz</span>
    <span class="c1">#texte [0..*], XP_TextAbschnitt</span>
    <span class="c1">#begruendungsTexte [0..*], XP_BegruendungAbschnitt</span>
    
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BPlan</span><span class="p">(</span><span class="n">XPlan</span><span class="p">):</span>

    <span class="n">BPLAN</span> <span class="o">=</span> <span class="s2">"1000"</span>
    <span class="n">EINFACHERBPLAN</span> <span class="o">=</span> <span class="s2">"10000"</span>
    <span class="n">QUALIFIZIERTERBPLAN</span> <span class="o">=</span> <span class="s2">"10001"</span>
    <span class="n">BEBAUUNGSPLANZURWOHNRAUMVERSORGUNG</span> <span class="o">=</span> <span class="s2">"10002"</span>
    <span class="n">VORHABENBEZOGENERBPLAN</span> <span class="o">=</span> <span class="s2">"3000"</span>
    <span class="n">VORHABENUNDERSCHLIESSUNGSPLAN</span> <span class="o">=</span> <span class="s2">"3100"</span>
    <span class="n">INNENBEREICHSSATZUNG</span> <span class="o">=</span> <span class="s2">"4000"</span>
    <span class="n">KLARSTELLUNGSSATZUNG</span> <span class="o">=</span> <span class="s2">"40000"</span>
    <span class="n">ENTWICKLUNGSSATZUNG</span> <span class="o">=</span> <span class="s2">"40001"</span>
    <span class="n">ERGAENZUNGSSATZUNG</span> <span class="o">=</span> <span class="s2">"40002"</span>
    <span class="n">AUSSENBEREICHSSATZUNG</span> <span class="o">=</span> <span class="s2">"5000"</span>
    <span class="n">OERTLICHEBAUVORSCHRIFT</span> <span class="o">=</span> <span class="s2">"7000"</span>
    <span class="n">SONSTIGES</span> <span class="o">=</span> <span class="s2">"9999"</span>

    <span class="n">BPLAN_TYPE_CHOICES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">BPLAN</span><span class="p">,</span>  <span class="s2">"BPlan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">EINFACHERBPLAN</span><span class="p">,</span> <span class="s2">"EinfacherBPlan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">QUALIFIZIERTERBPLAN</span><span class="p">,</span> <span class="s2">"QualifizierterBPlan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">BEBAUUNGSPLANZURWOHNRAUMVERSORGUNG</span><span class="p">,</span> <span class="s2">"BebauungsplanZurWohnraumversorgung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">VORHABENBEZOGENERBPLAN</span><span class="p">,</span> <span class="s2">"VorhabenbezogenerBPlan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">VORHABENUNDERSCHLIESSUNGSPLAN</span><span class="p">,</span> <span class="s2">"VorhabenUndErschliessungsplan"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">INNENBEREICHSSATZUNG</span><span class="p">,</span> <span class="s2">"InnenbereichsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">KLARSTELLUNGSSATZUNG</span><span class="p">,</span> <span class="s2">"KlarstellungsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ENTWICKLUNGSSATZUNG</span><span class="p">,</span> <span class="s2">"EntwicklungsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ERGAENZUNGSSATZUNG</span><span class="p">,</span> <span class="s2">"ErgaenzungsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">AUSSENBEREICHSSATZUNG</span><span class="p">,</span> <span class="s2">"AussenbereichsSatzung"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">OERTLICHEBAUVORSCHRIFT</span><span class="p">,</span> <span class="s2">"OertlicheBauvorschrift"</span><span class="p">),</span>
        <span class="p">(</span><span class="n">SONSTIGES</span><span class="p">,</span> <span class="s2">"Sonstiges"</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="c1">#gemeinde [1], XP_Gemeinde</span>
    <span class="n">gemeinde</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">AdministrativeOrganization</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">SET_NULL</span><span class="p">)</span>
    <span class="c1">#planaufstellendeGemeinde [0..*], XP_Gemeinde</span>
    <span class="c1">#plangeber [0..*], XP_Plangeber</span>
    <span class="c1">#planArt [1..*], BP_PlanArt</span>
    <span class="n">planart</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">BPLAN_TYPE_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">'1000'</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">'Typ des vorliegenden Bebauungsplans.'</span><span class="p">,</span> <span class="n">db_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
	<span class="c1">#sonstPlanArt [0..1], BP_SonstPlanArt</span>
    <span class="c1">#rechtsstand [0..1], BP_Rechtsstand</span>
    <span class="c1">#status [0..1], BP_Status</span>
    <span class="c1">#aenderungenBisDatum [0..1], Date</span>
    <span class="c1">#aufstellungsbeschlussDatum [0..1], Date</span>
    <span class="c1">#veraenderungssperre [0..1], BP_VeraenderungssperreDaten</span>
    <span class="c1">#auslegungsStartDatum [0..*], Date</span>
    <span class="c1">#auslegungsEndDatum [0..*], Date</span>
    <span class="c1">#traegerbeteiligungsStartDatum [0..*], Date</span>
    <span class="c1">#traegerbeteiligungsEndDatum [0..*], Date</span>
    <span class="c1">#satzungsbeschlussDatum [0..1], Date</span>
    <span class="c1">#rechtsverordnungsDatum [0..1], Date</span>
    <span class="c1">#inkrafttretensDatum [0..1], Date</span>
    <span class="c1">#ausfertigungsDatum [0..1], Date</span>
    <span class="c1">#staedtebaulicherVertrag [0..1], Boolean</span>
    <span class="c1">#erschliessungsVertrag [0..1], Boolean</span>
    <span class="c1">#durchfuehrungsVertrag [0..1], Boolean</span>
    <span class="c1">#gruenordnungsplan [0..1], Boolean</span>
    <span class="c1">#versionBauNVO [0..1], XP_GesetzlicheGrundlage</span>
    <span class="c1">#versionBauGB [0..1], XP_GesetzlicheGrundlage</span>
    <span class="c1">#versionSonstRechtsgrundlage [0..*], XP_GesetzlicheGrundlage</span>
    <span class="c1">#bereich [0..*], BP_Bereich</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Returns a string representation of a BPlan."""</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"'</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">planart</span><span class="si">}</span><span class="s2">': '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">'"</span>
</pre>
           </div>
          </div>
         </section>
         <section id="verwaltungsviews">
          <h3>
           Verwaltungsviews
           <a class="headerlink" href="#verwaltungsviews" title="Link to this heading">
            
           </a>
          </h3>
          <section id="vorarbeiten">
           <h4>
            Vorarbeiten
            <a class="headerlink" href="#vorarbeiten" title="Link to this heading">
             
            </a>
           </h4>
           <p>
            Um eine komfortable Verwaltung von Geometrien zu erm&ouml;glichen, bietet es sich an das Django Leaflet package (
            <a class="reference external" href="https://django-leaflet.readthedocs.io/en/latest/">
             <strong>
              django-leaflet
             </strong>
            </a>
            ) einzusetzen. Standardm&auml;&szlig;ig ist bei django noch eine &auml;lterer OpenLayers-Client (2.13) integriert.
           </p>
           <p>
            Installation des packages
           </p>
           <div class="highlight-shell notranslate">
            <div class="highlight">
             <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-leaflet
</pre>
            </div>
           </div>
           <p>
            Aktivieren des packages in komserv/settings.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#...</span>
    <span class="s1">'leaflet'</span><span class="p">,</span>
<span class="c1">#...</span>
</pre>
            </div>
           </div>
           <p>
            Ersatz des OpenLayer Client im Admin backend  - xplanung_light/admin.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">leaflet.admin</span><span class="w"> </span><span class="kn">import</span> <span class="n">LeafletGeoAdmin</span>
<span class="c1">#...</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">BPlan</span><span class="p">,</span> <span class="n">LeafletGeoAdmin</span><span class="p">)</span>
<span class="c1">#...</span>
</pre>
            </div>
           </div>
          </section>
          <section id="urls">
           <h4>
            Urls
            <a class="headerlink" href="#urls" title="Link to this heading">
             
            </a>
           </h4>
           <p>
            xplanung_light/urls.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlanCreateView</span><span class="p">,</span> <span class="n">BPlanUpdateView</span><span class="p">,</span> <span class="n">BPlanDeleteView</span><span class="p">,</span> <span class="n">BPlanListView</span>
<span class="c1">#...</span>
    <span class="c1"># urls for bplan</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/"</span><span class="p">,</span> <span class="n">BPlanListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-list"</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/create/"</span><span class="p">,</span> <span class="n">BPlanCreateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-create"</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/&lt;int:pk&gt;/update/"</span><span class="p">,</span> <span class="n">BPlanUpdateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-update"</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/&lt;int:pk&gt;/delete/"</span><span class="p">,</span> <span class="n">BPlanDeleteView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-delete"</span><span class="p">),</span>
<span class="p">]</span>
</pre>
            </div>
           </div>
          </section>
          <section id="views">
           <h4>
            Views
            <a class="headerlink" href="#views" title="Link to this heading">
             
            </a>
           </h4>
           <p>
            Nutzung von einfachen ClassBasedGenericViews
           </p>
           <p>
            xplanung_light/views.py
           </p>
           <div class="highlight-python notranslate">
            <div class="highlight">
             <pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BPlanCreateView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"nummer"</span><span class="p">,</span> <span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">]</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 


<span class="k">class</span><span class="w"> </span><span class="nc">BPlanUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"nummer"</span><span class="p">,</span> <span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">]</span> 
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 


<span class="k">class</span><span class="w"> </span><span class="nc">BPlanDeleteView</span><span class="p">(</span><span class="n">DeleteView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_success_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">BPlanListView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 
</pre>
            </div>
           </div>
           <p>
            xplanung_light/views.py
           </p>
          </section>
          <section id="templates">
           <h4>
            Templates
            <a class="headerlink" href="#templates" title="Link to this heading">
             
            </a>
           </h4>
           <p>
            xplanung_light/templates/xplanung_light/*
           </p>
           <section id="list">
            <h5>
             List
             <a class="headerlink" href="#list" title="Link to this heading">
              
             </a>
            </h5>
            <p>
             xplanung_light/templates/xplanung_light/bplan_list.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Liste der Bebauungspl&auml;ne</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;Treffer: </span><span class="cp">{{</span> <span class="nv">object_list.count</span> <span class="cp">}}</span><span class="x"> Bebauungspl&auml;ne&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
             </div>
            </div>
           </section>
           <section id="confirm-delete">
            <h5>
             Confirm Delete
             <a class="headerlink" href="#confirm-delete" title="Link to this heading">
              
             </a>
            </h5>
            <p>
             xplanung_light/templates/xplanung_light/bplan_confirm_delete.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="x">&lt;form method="post"&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">    &lt;p&gt;Wollen sie das Objekt wirklich l&ouml;schen? "</span><span class="cp">{{</span> <span class="nv">object</span> <span class="cp">}}</span><span class="x">"?&lt;/p&gt;</span>
<span class="x">    </span><span class="cp">{{</span> <span class="nv">form</span> <span class="cp">}}</span>
<span class="x">    &lt;input type="submit" value="Best&auml;tigung"&gt;</span>
<span class="x">&lt;/form&gt;</span>
</pre>
             </div>
            </div>
           </section>
           <section id="create">
            <h5>
             Create
             <a class="headerlink" href="#create" title="Link to this heading">
              
             </a>
            </h5>
            <p>
             xplanung_light/templates/xplanung_light/bplan_form.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Bebauungsplan anlegen</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;form method="post"&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
<span class="x">        &lt;input type="submit" value="Save"&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
             </div>
            </div>
           </section>
           <section id="update">
            <h5>
             Update
             <a class="headerlink" href="#update" title="Link to this heading">
              
             </a>
            </h5>
            <p>
             xplanung_light/templates/xplanung_light/bplan_form_update.html
            </p>
            <div class="highlight-jinja notranslate">
             <div class="highlight">
              <pre><span></span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Bebauungsplan editieren</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;form method="post"&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
<span class="x">        &lt;input type="submit" value="Aktualisieren"&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
             </div>
            </div>
           </section>
          </section>
         </section>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-optimize_views">
        </span>
        <section id="geometrie-editor">
         <h2>
          Geometrie Editor
          <a class="headerlink" href="#geometrie-editor" title="Link to this heading">
           
          </a>
         </h2>
         <section id="aktivieren-des-leaflet-clients-in-den-views">
          <h3>
           Aktivieren des Leaflet-Clients in den Views
           <a class="headerlink" href="#aktivieren-des-leaflet-clients-in-den-views" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Leaflet Integration im Basis-Template xplanung_light/templates/xplanung_light/layout.html
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="c">{# ... #}</span>
<span class="c">{# load leaflet specific parts #}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">leaflet_tags</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">leaflet_css</span> <span class="nv">plugins</span><span class="o">=</span><span class="s2">"ALL"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">leaflet_js</span> <span class="nv">plugins</span><span class="o">=</span><span class="s2">"ALL"</span> <span class="cp">%}</span>
<span class="c">{# ... #}</span>
</pre>
           </div>
          </div>
          <p>
           Anpassung der BPlanCreateView und BPlanUpdateView in xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">leaflet.forms.widgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">LeafletWidget</span>
<span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanCreateView</span><span class="p">(</span><span class="n">CreateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"nummer"</span><span class="p">,</span> <span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">]</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 

    <span class="k">def</span><span class="w"> </span><span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">form_class</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'gemeinde'</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'gemeinde'</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s2">"pk"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'geltungsbereich'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">LeafletWidget</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'geom_type'</span><span class="p">:</span> <span class="s1">'MultiPolygon'</span><span class="p">,</span> <span class="s1">'map_height'</span><span class="p">:</span> <span class="s1">'500px'</span><span class="p">,</span> <span class="s1">'map_width'</span><span class="p">:</span> <span class="s1">'50%'</span><span class="p">,</span><span class="s1">'MINIMAP'</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
	<span class="k">return</span> <span class="n">form</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BPlanUpdateView</span><span class="p">(</span><span class="n">UpdateView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"nummer"</span><span class="p">,</span> <span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">]</span> 
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 

    <span class="k">def</span><span class="w"> </span><span class="nf">get_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_class</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_form</span><span class="p">(</span><span class="n">form_class</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'gemeinde'</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'gemeinde'</span><span class="p">]</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">only</span><span class="p">(</span><span class="s2">"pk"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">'geltungsbereich'</span><span class="p">]</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">LeafletWidget</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'geom_type'</span><span class="p">:</span> <span class="s1">'MultiPolygon'</span><span class="p">,</span> <span class="s1">'map_height'</span><span class="p">:</span> <span class="s1">'500px'</span><span class="p">,</span> <span class="s1">'map_width'</span><span class="p">:</span> <span class="s1">'50%'</span><span class="p">,</span><span class="s1">'MINIMAP'</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">form</span>
</pre>
           </div>
          </div>
         </section>
        </section>
        <section id="tabellenanzeige">
         <h2>
          Tabellenanzeige
          <a class="headerlink" href="#tabellenanzeige" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          Um mit geringem Aufwand eine einfach zu pflegende Tabellenanzeige zu erhalten, bietet sich das package
          <a class="reference external" href="https://django-tables2.readthedocs.io/en/latest/">
           <strong>
            django-tables2
           </strong>
          </a>
          an.
         </p>
         <div class="highlight-shell notranslate">
          <div class="highlight">
           <pre><span></span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>django-tables2
</pre>
          </div>
         </div>
         <p>
          Package zu komserv/settings.py hinzuf&uuml;gen
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1">#...</span>
    <span class="s1">'django_tables2'</span><span class="p">,</span>
<span class="c1">#...</span>
</pre>
          </div>
         </div>
         <p>
          Erstellen einer Python-Datei f&uuml;r das Management von Tabellen
         </p>
         <p>
          xplanung_light/tables.py
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tables</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlan</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">A</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BPlanTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">BPlanTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
    <span class="c1">#download = tables.LinkColumn('gedis-document-pdf', text='Download', args=[A('pk')], \</span>
    <span class="c1">#                     orderable=False, empty_values=())</span>
    <span class="n">edit</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-update'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'Bearbeiten'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">delete</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-delete'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'L&ouml;schen'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    geojson = Column(</span>
<span class="sd">        accessor=A('geojson'),</span>
<span class="sd">        orderable=False,</span>
<span class="sd">        # ...</span>
<span class="sd">    )</span>
<span class="sd">    """</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s2">"django_tables2/bootstrap5.html"</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"edit"</span><span class="p">,</span> <span class="s2">"delete"</span><span class="p">)</span>
</pre>
          </div>
         </div>
         <p>
          Anpassung der Klasse BPlanListView in xplanung_light/views.py - Integration des Tabellenmoduls
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_tables2</span><span class="w"> </span><span class="kn">import</span> <span class="n">SingleTableView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.tables</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlanTable</span>
<span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanListView</span><span class="p">(</span><span class="n">SingleTableView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
    <span class="n">table_class</span> <span class="o">=</span> <span class="n">BPlanTable</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s2">"bplan-list"</span><span class="p">)</span> 
</pre>
          </div>
         </div>
        </section>
        <section id="anpassung-templates">
         <h2>
          Anpassung Templates
          <a class="headerlink" href="#anpassung-templates" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          Anpassung der Liste - Hinzuf&uuml;gen eines Create Buttons - xplanung_light/templates/xplanung_light/bplan_list.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="c">{# .... #}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;p&gt;&lt;a href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-create'</span> <span class="cp">%}</span><span class="x">"&gt;BPlan anlegen&lt;/a&gt;&lt;/p&gt;</span>
<span class="c">{# .... #}</span>
</pre>
          </div>
         </div>
         <p>
          Men&uuml;eintrag f&uuml;r Bebauungspl&auml;ne hinzuf&uuml;gen - xplanung_light/templates/xplanung_light/layout.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="c">{# .... #}</span>
<span class="x">&lt;ul class="navbar-nav me-auto mb-2 mb-lg-0"&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="x">                &lt;a class="nav-link" aria-current="page" href="</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'bplan-list'</span> <span class="cp">%}</span><span class="x">"&gt;Bebauungspl&auml;ne&lt;/a&gt;</span>
<span class="x">              &lt;/li&gt;</span>
<span class="x">              </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">              &lt;li class="nav-item"&gt;</span>
<span class="c">{# .... #}</span>
</pre>
          </div>
         </div>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-leaflet_conf">
        </span>
        <section id="zentrale-konfiguration">
         <h2>
          Zentrale Konfiguration
          <a class="headerlink" href="#zentrale-konfiguration" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          komserv/settings.py
         </p>
         <div class="highlight-python notranslate">
          <div class="highlight">
           <pre><span></span><span class="c1">#...</span>
<span class="n">LEAFLET_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># conf here</span>
    <span class="s1">'SPATIAL_EXTENT'</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">49.0</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mi">52</span><span class="p">),</span>
    <span class="s1">'DEFAULT_CENTER'</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">),</span>
    <span class="s1">'DEFAULT_ZOOM'</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="s1">'MIN_ZOOM'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">'MAX_ZOOM'</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">'DEFAULT_PRECISION'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1">#...</span>
</pre>
          </div>
         </div>
        </section>
        <section id="wms-layer-hinzufugen">
         <h2>
          WMS Layer hinzuf&uuml;gen
          <a class="headerlink" href="#wms-layer-hinzufugen" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          Muss im im jeweiligen Template erfolgen, da die zentrale Leaflet Konfiguration nur zus&auml;tzliche Tiled Layer erlaubt.
Siehe auch
          <a class="reference external" href="https://stackoverflow.com/questions/66938889/how-to-add-leaflet-extensions-marker-basemap-geocoder-to-django-leaflet">
           https://stackoverflow.com/questions/66938889/how-to-add-leaflet-extensions-marker-basemap-geocoder-to-django-leaflet
          </a>
         </p>
         <p>
          xplanung_light/templates/xplanung_light/bplan_form.html
         </p>
         <div class="highlight-jinja notranslate">
          <div class="highlight">
           <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"xplanung_light/layout.html"</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>
<span class="x">    Bebauungsplan anlegen</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">&lt;script type="text/javascript"&gt;</span>
<span class="x">    window.addEventListener("map:init", function(e) {</span>
<span class="x">            var detail = e.detail;</span>
<span class="x">            var map = detail.map;</span>
<span class="x">            /* Transparent overlay layers */</span>
<span class="x">            var wmsLayer = L.tileLayer.wms('https://geo5.service24.rlp.de/wms/liegenschaften_rp.fcgi?', {</span>
<span class="x">                layers: 'Flurstueck',</span>
<span class="x">                format: 'image/png',</span>
<span class="x">                transparent: true,</span>
<span class="x">            }).addTo(map);</span>
<span class="x">            // and many more</span>
<span class="x">        }, false</span>
<span class="x">    ); //end of window.addEventListener</span>
<span class="x">&lt;/script&gt;</span>
<span class="x">    &lt;form method="post" class="geocoding-form"&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
<span class="x">        &lt;input type="submit" value="Speichern"&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre>
          </div>
         </div>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-export_xml_1">
        </span>
        <section id="xplanung-gml-export">
         <h2>
          XPlanung GML Export
          <a class="headerlink" href="#xplanung-gml-export" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          F&uuml;r den interoperablen Datenaustausch m&uuml;ssen die Bebauungsplaninformationen in XPlan-GML exportiert werden k&ouml;nnen.
In Django lassen sich hierf&uuml;r einfache XML-Templates verwenden. Diese werden zur Laufzeit mit den Daten aus der DB gef&uuml;llt.
Das Prinzip ist das gleiche wie bei den HTML-Templates.
         </p>
         <section id="export-xml-view">
          <h3>
           Export XML View
           <a class="headerlink" href="#export-xml-view" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           F&uuml;r den Export brauchen wir einen View. Da immer nur ein einzelner Bebauungsplan exportiert wird, kann man als Grundlage den Standard Detail View nutzen.
          </p>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.views.generic</span><span class="w"> </span><span class="kn">import</span> <span class="n">DetailView</span>
<span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
          <p>
           Dieser vererbt seine Struktur an den neuen Export View. F&uuml;r ein konformes XPlan-GML sind einige Vorarbeiten n&ouml;tig. Wir brauchen die Geometrien
f&uuml;r den r&auml;umlichen Geltungsbereich im EPSG:25832 und im Format GML3. Das kann man relativ einfach mit einer Erweiterung
des querysets mit einer annotation l&ouml;sen. Zus&auml;tzlich zu den Polygonen brauchen wir noch den Extent der Geometrien. Dieser l&auml;&szlig;t sich aktuell nicht &uuml;ber eine annotation abfragen, sondern muss zur Laufzeit berechnet werden. Dazu nutzen wir die &uuml;ber Geodjango zur Verf&uuml;gung stehende GDAL Implementierung. Da wir auch das GML3 noch &auml;ndern m&uuml;ssen (Erg&auml;nzungen von gml_id Attributen), brauchen wir noch die etree-Bibliothek zum Parsen und Schreiben von XML.
          </p>
          <p>
           xplanung_light/views.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.db.models.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsGML</span><span class="p">,</span> <span class="n">Transform</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.gdal</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoordTransform</span><span class="p">,</span> <span class="n">SpatialReference</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.gis.gdal</span><span class="w"> </span><span class="kn">import</span> <span class="n">OGRGeometry</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xml.etree.ElementTree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ET</span>
<span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanDetailXmlRasterView</span><span class="p">(</span><span class="n">BPlanDetailView</span><span class="p">):</span>  

    <span class="k">def</span><span class="w"> </span><span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Erweiterung der auszulesenden Objekte um eine transformierte Geomtrie im Format GML 3</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">geltungsbereich_gml_25832</span><span class="o">=</span><span class="n">AsGML</span><span class="p">(</span><span class="n">Transform</span><span class="p">(</span><span class="s2">"geltungsbereich"</span><span class="p">,</span> <span class="mi">25832</span><span class="p">),</span> <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">queryset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Um einen XPlanung-konformen Auszug zu bekommen, werden gml_id(s) verwendet.</span>
        <span class="c1"># Es handelt sich um uuids, die noch das Prefix "GML_" bekommen. Grunds&auml;tzlich sollten die </span>
        <span class="c1"># aus den Daten in der DB stammen und dort vergeben werden. </span>
        <span class="c1"># Im ersten Schritt synthetisieren wir sie einfach ;-)</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'auszug_uuid'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'bplan_uuid'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="c1"># Irgendwie gibt es keine django model function um direkt den Extent der Geometrie zu erhalten. Daher nutzen wir hier gdal</span>
        <span class="c1"># und Transformieren die Daten erneut im RAM</span>
        <span class="c1"># Definition der Transformation (Daten sind immer in WGS 84 - 4326)</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">CoordTransform</span><span class="p">(</span><span class="n">SpatialReference</span><span class="p">(</span><span class="mi">4326</span><span class="p">,</span> <span class="n">srs_type</span><span class="o">=</span><span class="s1">'epsg'</span><span class="p">),</span> <span class="n">SpatialReference</span><span class="p">(</span><span class="mi">25832</span><span class="p">,</span> <span class="n">srs_type</span><span class="o">=</span><span class="s1">'epsg'</span><span class="p">))</span>
        <span class="c1"># OGRGeoemtry Objekt erstellen</span>
        <span class="n">ogr_geom</span> <span class="o">=</span> <span class="n">OGRGeometry</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s1">'bplan'</span><span class="p">]</span><span class="o">.</span><span class="n">geltungsbereich</span><span class="p">),</span> <span class="n">srs</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
        <span class="c1"># Transformation nach EPSG:25832</span>
        <span class="n">ogr_geom</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
        <span class="c1"># Speichern des Extents in den Context</span>
        <span class="n">context</span><span class="p">[</span><span class="s1">'extent'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ogr_geom</span><span class="o">.</span><span class="n">extent</span>
        <span class="c1"># Ausgabe der GML Variante zu Testzwecken </span>
        <span class="c1"># print(context['bplan'].geltungsbereich_gml_25832)</span>
        <span class="c1"># Da die GML Daten nicht alle Attribute beinhalten, die XPlanung fordert, m&uuml;ssen wir sie anpassen, bzw. umschreiben</span>
        <span class="c1"># Hierzu nutzen wir etree</span>
        <span class="n">ET</span><span class="o">.</span><span class="n">register_namespace</span><span class="p">(</span><span class="s1">'gml'</span><span class="p">,</span><span class="s1">'http://www.opengis.net/gml/3.2'</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">"&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;snippet xmlns:gml='http://www.opengis.net/gml/3.2'&gt;"</span> <span class="o">+</span> <span class="n">context</span><span class="p">[</span><span class="s1">'bplan'</span><span class="p">]</span><span class="o">.</span><span class="n">geltungsbereich_gml_25832</span> <span class="o">+</span> <span class="s2">"&lt;/snippet&gt;"</span><span class="p">)</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'gml'</span><span class="p">:</span> <span class="s1">'http://www.opengis.net/gml/3.2'</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># print("&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;snippet xmlns:gml='http://www.opengis.net/gml/3.2'&gt;" + context['bplan'].geltungsbereich_gml_25832 + "&lt;/snippet&gt;")</span>
        <span class="c1"># Test ob ein Polygon zur&uuml;ck kommt - damit w&auml;re nur ein einziges Polygon im geometry Field</span>
        <span class="n">polygons</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">'gml:Polygon'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
        <span class="c1"># print(len(polygons))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print("Kein Polygon auf oberer Ebene gefunden - es sind wahrscheinlich mehrere!")</span>
            <span class="n">multi_polygon_element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'gml:MultiSurface'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
            <span class="n">uuid_multisurface</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
            <span class="n">multi_polygon_element</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"gml:id"</span><span class="p">,</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_multisurface</span><span class="p">))</span>
            <span class="c1"># F&uuml;ge gml_id Attribute hinzu - besser diese als Hash aus den Geometrien zu rechnen, oder in Zukunft generic_ids der Bereiche zu verwenden </span>
            <span class="n">polygons</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">'gml:MultiSurface/gml:surfaceMember/gml:Polygon'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
                <span class="n">uuid_polygon</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
                <span class="n">polygon</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"gml:id"</span><span class="p">,</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_polygon</span><span class="p">))</span>
            <span class="n">context</span><span class="p">[</span><span class="s1">'multisurface_geometry_25832'</span><span class="p">]</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">multi_polygon_element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"xml"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">polygon_element</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'gml:Polygon'</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span>
            <span class="n">polygon_element</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"xmlns:gml"</span><span class="p">,</span> <span class="s2">"http://www.opengis.net/gml/3.2"</span><span class="p">)</span>   
            <span class="n">uuid_polygon</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
            <span class="n">polygon_element</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"gml:id"</span><span class="p">,</span> <span class="s2">"GML_"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_polygon</span><span class="p">))</span>
            <span class="c1"># Ausgabe der Geometrie in ein XML-Snippet - erweitert um den MultiSurface/surfaceMember Rahmen</span>
            <span class="n">ET</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">polygon_element</span><span class="p">)</span> 
            <span class="n">context</span><span class="p">[</span><span class="s1">'multisurface_geometry_25832'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'&lt;gml:MultiSurface srsName="EPSG:25832"&gt;&lt;gml:surfaceMember&gt;'</span> <span class="o">+</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">polygon_element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">"xml"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'&lt;/gml:surfaceMember&gt;&lt;/gml:MultiSurface&gt;'</span>
        <span class="k">return</span> <span class="n">context</span>

<span class="w">    </span><span class="sd">""""</span>
<span class="sd">    def get_object(self):</span>
<span class="sd">        single_object = super().get_object(self.get_queryset())</span>
<span class="sd">        # print(single_object.geltungsbereich)</span>
<span class="sd">        # print(single_object.geltungsbereich_gml_25832)</span>
<span class="sd">        return single_object</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">'Content-type'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"application/xml"</span>  <span class="c1"># set header</span>
        <span class="k">return</span> <span class="n">response</span>
</pre>
           </div>
          </div>
         </section>
         <section id="url-fur-export">
          <h3>
           URL f&uuml;r Export
           <a class="headerlink" href="#url-fur-export" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Um die Export Funktion nutzen zu k&ouml;nnen, brauchen wir noch einen neuen Endpunkt.
          </p>
          <p>
           xplanung_light/urls.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xplanung_light.views</span><span class="w"> </span><span class="kn">import</span> <span class="n">BPlanCreateView</span><span class="p">,</span> <span class="n">BPlanUpdateView</span><span class="p">,</span> <span class="n">BPlanDeleteView</span><span class="p">,</span> <span class="n">BPlanListView</span><span class="p">,</span> <span class="n">BPlanDetailXmlRasterView</span>
<span class="c1">#...</span>
 <span class="c1"># export xplanung gml</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">"bplan/&lt;int:pk&gt;/xplan/"</span><span class="p">,</span> <span class="n">BPlanDetailXmlRasterView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s2">"xplanung_light/bplan_template_xplanung_raster_6.xml"</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"bplan-export-xplan-raster-6"</span><span class="p">),</span>
<span class="c1">#...</span>
</pre>
           </div>
          </div>
         </section>
         <section id="link-in-table-view">
          <h3>
           Link in Table View
           <a class="headerlink" href="#link-in-table-view" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Den Link auf den Endpunkt &uuml;bernehmen wir in die Bebauungsplantabelle
          </p>
          <p>
           xplanung_light/tables.py
          </p>
          <div class="highlight-python notranslate">
           <div class="highlight">
            <pre><span></span><span class="c1">#...</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BPlanTable</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">Table</span><span class="p">):</span>
    <span class="c1">#download = tables.LinkColumn('gedis-document-pdf', text='Download', args=[A('pk')], \</span>
    <span class="c1">#                     orderable=False, empty_values=())</span>
    <span class="n">xplan_gml</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-export-xplan-raster-6'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'Exportieren'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">edit</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-update'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'Bearbeiten'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
    <span class="n">delete</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">LinkColumn</span><span class="p">(</span><span class="s1">'bplan-delete'</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">'L&ouml;schen'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">A</span><span class="p">(</span><span class="s1">'pk'</span><span class="p">)],</span> \
                         <span class="n">orderable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">empty_values</span><span class="o">=</span><span class="p">())</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    geojson = Column(</span>
<span class="sd">        accessor=A('geojson'),</span>
<span class="sd">        orderable=False,</span>
<span class="sd">        # ...</span>
<span class="sd">    )</span>
<span class="sd">    """</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BPlan</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s2">"django_tables2/bootstrap5.html"</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"gemeinde"</span><span class="p">,</span> <span class="s2">"planart"</span><span class="p">,</span> <span class="s2">"xplan_gml"</span><span class="p">,</span> <span class="s2">"edit"</span><span class="p">,</span> <span class="s2">"delete"</span><span class="p">)</span>
</pre>
           </div>
          </div>
         </section>
         <section id="xml-template">
          <h3>
           XML Template
           <a class="headerlink" href="#xml-template" title="Link to this heading">
            
           </a>
          </h3>
          <p>
           Fehlt nur noch das Template ;-)
          </p>
          <p>
           xplanung_light/bplan_template_xplanung_raster_6.xml
          </p>
          <div class="highlight-jinja notranslate">
           <div class="highlight">
            <pre><span></span><span class="x">&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;</span>
<span class="x">&lt;xplan:XPlanAuszug xmlns:xplan="http://www.xplanung.de/xplangml/6/0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:schemaLocation="http://www.xplanung.de/xplangml/6/0 http://repository.gdi-de.org/schemas/de.xleitstelle.xplanung/6.0/XPlanung-Operationen.xsd" gml:id="</span><span class="cp">{{</span> <span class="nv">auszug_uuid</span> <span class="cp">}}</span><span class="x">"&gt;</span>
<span class="x">  &lt;gml:boundedBy&gt;</span>
<span class="x">    &lt;gml:Envelope srsName="EPSG:25832"&gt;</span>
<span class="x">      &lt;gml:lowerCorner&gt;567015.8040 5937951.7580&lt;/gml:lowerCorner&gt;</span>
<span class="x">      &lt;gml:upperCorner&gt;567582.8240 5938562.2710&lt;/gml:upperCorner&gt;</span>
<span class="x">    &lt;/gml:Envelope&gt;</span>
<span class="x">  &lt;/gml:boundedBy&gt;</span>
<span class="x">  &lt;gml:featureMember&gt;</span>
<span class="x">    &lt;xplan:BP_Plan gml:id="</span><span class="cp">{{</span> <span class="nv">bplan_uuid</span> <span class="cp">}}</span><span class="x">"&gt;</span>
<span class="x">      &lt;gml:boundedBy&gt;</span>
<span class="x">        &lt;gml:Envelope srsName="EPSG:25832"&gt;</span>
<span class="x">          &lt;gml:lowerCorner&gt;</span><span class="cp">{{</span> <span class="nv">extent.0</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">extent.1</span> <span class="cp">}}</span><span class="x">&lt;/gml:lowerCorner&gt;</span>
<span class="x">          &lt;gml:upperCorner&gt;</span><span class="cp">{{</span> <span class="nv">extent.2</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">extent.3</span> <span class="cp">}}</span><span class="x">&lt;/gml:upperCorner&gt;</span>
<span class="x">        &lt;/gml:Envelope&gt;</span>
<span class="x">      &lt;/gml:boundedBy&gt;</span>
<span class="x">      &lt;xplan:name&gt;</span><span class="cp">{{</span> <span class="nv">bplan.name</span> <span class="cp">}}</span><span class="x">&lt;/xplan:name&gt;</span>
<span class="x">      &lt;xplan:erstellungsMassstab&gt;1000&lt;/xplan:erstellungsMassstab&gt;</span>
<span class="x">      &lt;xplan:raeumlicherGeltungsbereich&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">autoescape</span> <span class="nv">off</span> <span class="cp">%}</span>
<span class="x">            </span><span class="cp">{{</span> <span class="nv">multisurface_geometry_25832</span> <span class="cp">}}</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endautoescape</span> <span class="cp">%}</span>
<span class="x">      &lt;/xplan:raeumlicherGeltungsbereich&gt;</span>
<span class="x">      &lt;xplan:gemeinde&gt;</span>
<span class="x">        &lt;xplan:XP_Gemeinde&gt;</span>
<span class="x">          &lt;xplan:ags&gt;</span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.ls</span> <span class="cp">}}{{</span> <span class="nv">bplan.gemeinde.ks</span> <span class="cp">}}{{</span> <span class="nv">bplan.gemeinde.vs</span> <span class="cp">}}{{</span> <span class="nv">bplan.gemeinde.gs</span> <span class="cp">}}</span><span class="x">&lt;/xplan:ags&gt;</span>
<span class="x">          &lt;xplan:gemeindeName&gt;</span><span class="cp">{{</span> <span class="nv">bplan.gemeinde.name</span> <span class="cp">}}</span><span class="x">&lt;/xplan:gemeindeName&gt;</span>
<span class="x">        &lt;/xplan:XP_Gemeinde&gt;</span>
<span class="x">      &lt;/xplan:gemeinde&gt;</span>
<span class="x">      &lt;xplan:planArt&gt;</span><span class="cp">{{</span> <span class="nv">bplan.planart</span> <span class="cp">}}</span><span class="x">&lt;/xplan:planArt&gt;</span>
<span class="x">      &lt;xplan:staedtebaulicherVertrag&gt;false&lt;/xplan:staedtebaulicherVertrag&gt;</span>
<span class="x">      &lt;xplan:erschliessungsVertrag&gt;false&lt;/xplan:erschliessungsVertrag&gt;</span>
<span class="x">      &lt;xplan:durchfuehrungsVertrag&gt;false&lt;/xplan:durchfuehrungsVertrag&gt;</span>
<span class="x">      &lt;xplan:gruenordnungsplan&gt;false&lt;/xplan:gruenordnungsplan&gt;</span>
<span class="x">    &lt;/xplan:BP_Plan&gt;</span>
<span class="x">  &lt;/gml:featureMember&gt;</span>
<span class="x">&lt;/xplan:XPlanAuszug&gt;</span>
</pre>
           </div>
          </div>
         </section>
        </section>
       </div>
       <div class="toctree-wrapper compound">
        <span id="document-result">
        </span>
        <section id="zusammenfassung">
         <h2>
          Zusammenfassung
          <a class="headerlink" href="#zusammenfassung" title="Link to this heading">
           
          </a>
         </h2>
         <p>
          Wir haben innerhalb k&uuml;rzester Zeit eine sehr einfache Verwaltungssoftware f&uuml;r Bebauungspl&auml;ne erstellt.
Die exportierbaren GML-Dateien lassen sich mit Hilfe des Validators pr&uuml;fen und sind valide.
Einen praktischen Nutzwert hat die Software in diesem Stadium aber noch nicht.
         </p>
         <p>
          Um die Software zur Produktionsreife zu bringen, m&uuml;ssen noch ein paar Dinge entwickelt werden.
         </p>
        </section>
        <section id="todos">
         <h2>
          TODOs
          <a class="headerlink" href="#todos" title="Link to this heading">
           
          </a>
         </h2>
         <ul class="simple">
          <li>
           <p>
            Ersetzen des Felds
            <strong>
             geltungsbereich
            </strong>
            durch eine m2m Relation zu einem neuen Modell
            <strong>
             bereich
            </strong>
           </p>
          </li>
          <li>
           <p>
            Aktivieren der Pflichtfelder entprechend der Vorgaben in RLP
           </p>
          </li>
          <li>
           <p>
            Entwickeln notwendiger Validierungsfunktionen
           </p>
          </li>
          <li>
           <p>
            Erstellung eines Mapfile-Generators zur Publikation von WMS- und WFS-Interfaces
           </p>
          </li>
          <li>
           <p>
            Schaffung der Ablagem&ouml;glichkeit f&uuml;r Dokumente
           </p>
          </li>
          <li>
           <p>
            Importm&ouml;glichkeit f&uuml;r BPlan-GML Dokumente
           </p>
          </li>
          <li>
           <p>
            &hellip;
           </p>
          </li>
         </ul>
         <div class="admonition note">
          <p class="admonition-title">
           Bemerkung
          </p>
          <p>
           This text is
           <strong>
            standard
           </strong>
           <em>
            Markdown
           </em>
          </p>
         </div>
        </section>
       </div>
      </section>
      <div class="clearer">
      </div>
     </div>
    </div>
   </div>
   <div class="clearer">
   </div>
  </div>
  <article id="back-cover">
   <div class="container">
    <div class="back-cover-footer">
     <p>
      &copy; Copyright 2025, Armin Retterath.
     </p>
     <p>
      Created using
      <a href="http://sphinx-doc.org/">
       Sphinx
      </a>
      7.4.7.
     </p>
    </div>
   </div>
  </article>
 </body>
</html>
